import{c as xe,u as ue,B as o,j as e,l as pe,m as fe,A as he,n as J,f as l,U as K,D as je,T as ye,t as Ne,y as Q,F as _e}from"./index-DBe-f9EN.js";import{m as be,c as ge,u as we,b as n}from"./vendor-Bb8_f6lk.js";import{g as ve,a as Ce}from"./creditCommandeService-D3jxeOkW.js";import{f as D}from"./date-format-qL-o8H-f.js";import{W as Fe}from"./wave-orange-payment-service-DzeOiwhD.js";import{M as Pe}from"./mail-SS2mlNMI.js";import{T as Y}from"./truck-C_QiGBoO.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=xe("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);function i(m,h=0){const N=Number(m);return Number.isFinite(N)?N:h}function De(){const{id:m}=be(),h=ge(),N=we(),{user:a}=ue();console.log(a);const[_,R]=n.useState(null),[s,Z]=n.useState(null),[F,z]=n.useState(null),[j,ee]=n.useState(!0),[T,$]=n.useState(!1),[p,B]=n.useState(0),[V,b]=n.useState(""),[se,P]=n.useState(!1),I=t=>{if(!t)return"En cours";switch(String(t).toLowerCase()){case"pending":return"En cours de validation";case"validated":return"Validé";case"rejected":return"Rejeté";default:return"En cours"}},O=t=>{if(!t)return e.jsx(Y,{className:"w-5 h-5 text-blue-500"});switch(String(t).toLowerCase()){case"pending":return e.jsx(Q,{className:"w-5 h-5 text-yellow-500"});case"validated":return e.jsx(_e,{className:"w-5 h-5 text-green-500"});case"rejected":return e.jsx(Q,{className:"w-5 h-5 text-red-500"});default:return e.jsx(Y,{className:"w-5 h-5 text-blue-500"})}},k=n.useCallback(async()=>{if(m)try{$(!0);const t=await ve(a&&a.id||null,m);if(console.log("data order",t),!t||!t.order)throw new Error("Réponse invalide");const r=a?{id:a.id||a.partner_id,name:a.name||`${a.prenom||""} ${a.nom||""}`.trim()||a.email,email:a.email,phone:a.telephone||a.partner_phone,adresse:a.adresse,partner_city:a.partner_city,country_id:a.country_id,country_name:a.country_name,country_code:a.country_code,country_phone_code:a.country_phone_code,...t.partner}:null;R(r||t.partner||null),Z(t.order);const d=a?{name:a.employer_name||a.employer_partner_name,email:a.employer_partner_email,phone:a.employer_partner_phone,street:a.adresse_employeur||a.employer_partner_adresse,entreprise_code:a.institution_partner_id||a.employer_partner_id,institution_partner_id:a.institution_partner_id,employer_partner_id:a.employer_partner_id,...t.employer}:null;z(d||t.employer||null)}catch(t){console.error(t),o.error("Impossible de charger les détails de la commande")}finally{ee(!1),$(!1)}},[a,m]);n.useEffect(()=>{if(a&&!_){const t={id:a.id||a.partner_id,name:a.name||`${a.prenom||""} ${a.nom||""}`.trim()||a.email,email:a.email,phone:a.telephone||a.partner_phone,adresse:a.adresse,partner_city:a.partner_city,country_id:a.country_id,country_name:a.country_name,country_code:a.country_code,country_phone_code:a.country_phone_code};R(t)}if(a&&!F&&(a.employer_name||a.employer_partner_name)){const t={name:a.employer_name||a.employer_partner_name,email:a.employer_partner_email,phone:a.employer_partner_phone,street:a.adresse_employeur||a.employer_partner_adresse,entreprise_code:a.institution_partner_id||a.employer_partner_id,institution_partner_id:a.institution_partner_id,employer_partner_id:a.employer_partner_id};z(t)}},[a,_,F]),n.useEffect(()=>{k()},[k]);const g=n.useMemo(()=>Array.isArray(s&&s.payment_lines)?s.payment_lines:[],[s&&s.payment_lines]),y=n.useMemo(()=>g.length&&(g.find(t=>t.sequence===1)||g[0])||null,[g]),x=n.useMemo(()=>i(y&&y.amount||0,0),[y]),f=n.useMemo(()=>y?!y.state:!1,[y]),c=n.useMemo(()=>i(s&&s.amount_residual||0,0),[s&&s.amount_residual]),u=n.useMemo(()=>c<=0?0:Math.min(50,c),[c]),[U,H]=n.useState(!1),[w,te]=n.useState(null),E=n.useMemo(()=>m?`/api/creditcommandes/proforma/${m}?create_if_missing=1`:null,[m]);n.useEffect(()=>{s&&(async()=>{if(m)try{H(!0);const r=await Ce(m);console.log(r),te(r&&r.proforma||null)}catch(r){console.error(r),o.error("Impossible de charger la pro-forma.")}finally{H(!1)}})()},[m,s]),n.useEffect(()=>{!j&&s&&(B(f?x:u),b(""))},[j,s,f,x,u]);const ae=()=>{if(!f&&p<50){o.warning("Le montant doit être supérieur à 50 F CFA");return}P(!0)},re=t=>{t.preventDefault();const r=i(p,0);if(c<=0){o.info("Aucun montant restant à payer.");return}if(f){if(r<x){o.warning(`Le montant doit être au moins l'acompte requis (${l(x)}).`,{position:"top-center",autoClose:5e3});return}if(r>c){o.warning("Le montant à payer ne doit pas dépasser le montant restant à payer.",{position:"top-center",autoClose:5e3});return}}else{if(r<u){o.warning(`Le montant doit être ≥ ${l(u)}.`,{position:"top-center",autoClose:5e3});return}if(r>c){o.warning("Le montant à payer ne doit pas dépasser le montant restant à payer.",{position:"top-center",autoClose:5e3});return}}P(!0)},v=n.useCallback(async()=>{P(!1),await k(),o.success("Paiement confirmé, page mise à jour.")},[k]);n.useEffect(()=>{const t=r=>{if(r.key==="statusOrderPayment"){const d=(r.newValue||"").replace(/"/g,"");["succeeded","completed","paid","success"].includes(d)&&v()}};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[v]),n.useEffect(()=>{if(new URLSearchParams(h.search).get("payment")==="success"){const r=h.pathname;N(r,{replace:!0}),v()}},[h.search,h.pathname,N,v]);const q=String(s&&s.validation_rh_state||"").toLowerCase()==="validated"&&String(s&&s.validation_admin_state||"").toLowerCase()==="validated",M=c<=0,ne=j||!q||M||(f?i(p)<x||i(p)>c:i(p)<u||i(p)>c),le=n.useMemo(()=>i(s&&s.amount_untaxed||0,0),[s&&s.amount_untaxed]),ie=n.useMemo(()=>i(s&&s.amount_tax||0,0),[s&&s.amount_tax]),C=n.useMemo(()=>i(s&&s.amount_total||0,0),[s&&s.amount_total]),S=n.useMemo(()=>C-c,[C,c]),W=n.useMemo(()=>!s||!Array.isArray(s.order_lines)?0:s.order_lines.filter(t=>{const r=(t.product_name||"").toLowerCase();return r.includes("réduction")||r.includes("reduction")}).reduce((t,r)=>t+i(r.price_total||0,0),0),[s&&s.order_lines]);n.useMemo(()=>i(s&&s.marge_amount||0,0),[s&&s.marge_amount]),n.useMemo(()=>i(s&&s.partner_marge_percent||0,0),[s&&s.partner_marge_percent]);const X=n.useMemo(()=>!s||!Array.isArray(s.order_lines)||s.credit_type!=="banque"&&s.credit_type!=="finance"?0:s.order_lines.filter(t=>{const r=(t.product_name||"").toLowerCase();return!r.includes("réduction")&&!r.includes("reduction")}).reduce((t,r)=>{const d=i(r.discount||0,0);if(d>0&&r.price_unit){const A=i(r.price_unit)*d/100*i(r.product_uom_qty||1);return t+A}return t},0),[s&&s.order_lines,s&&s.credit_type]),ce=n.useMemo(()=>(s&&s.credit_type)==="banque",[s&&s.credit_type]),me=(t,r="application/pdf")=>{try{const d=atob(t),A=d.length,G=new Uint8Array(A);for(let L=0;L<A;L++)G[L]=d.charCodeAt(L);const oe=new Blob([G],{type:r});return URL.createObjectURL(oe)}catch{return null}},de=()=>{if(w&&w.pdf_base64){const t=me(w.pdf_base64,"application/pdf");if(!t){o.error("Erreur lors de la préparation du fichier PDF.");return}const r=document.createElement("a");r.href=t,r.download=w&&w.pdf_filename||`PROFORMA-${s&&s.name||m}.pdf`,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(t);return}E?window.open(E,"_blank"):o.error("Lien de téléchargement indisponible.")};return e.jsxs(e.Fragment,{children:[e.jsx(pe,{title:"CCBM Shop | Détails Commande à Crédit",description:"Détails et paiement d'une commande à crédit sur CCBM Shop.",keywords:"ccbm, commande à crédit, échéancier, paiement mobile"}),e.jsx(fe,{childrenClasses:"pt-0 pb-0",children:e.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full mb-5",children:e.jsx(he,{title:"Détails Commande à Crédit",breadcrumb:[{name:"Accueil",path:"/"},{name:"Commande à Crédits",path:"/profile#commandes-a-credit"},{name:"Détails Commande à crédit"}]})}),j&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(J,{className:"mr-2 h-5 w-5 animate-spin"}),e.jsx("span",{children:"Chargement..."})]}),s&&e.jsx("div",{className:"checkout-main-content w-full",children:e.jsx("div",{className:"container-x mx-auto",children:e.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["N°Commande à Crédit ",e.jsx("span",{children:s.name})]})})}),e.jsx("div",{className:"sm:w-1/3 flex-1 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["Paiement :"," ",s.advance_payment_status==="not_paid"&&e.jsx("span",{className:"text-red-500",children:"Non Payé"}),s.advance_payment_status==="paid"&&e.jsx("span",{className:"text-green-500",children:" Payé "}),s.advance_payment_status==="partial"&&e.jsx("span",{className:"text-yellow-500",children:" Partiellement Payé"})]})})}),e.jsx("div",{className:"sm:w-1/3 flex-1 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Statut : "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsxs("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:[s.state==="sale"&&e.jsx("span",{className:"text-green-500",children:"Validé"}),s.state==="draft"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de traitement"}),s.state==="cancel"&&e.jsx("span",{className:"text-yellow-500",children:"Annulée"}),s.state==="delivered"&&e.jsx("span",{className:"text-green-600",children:"Livrée"}),s.state==="to_delivered"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de livraison"}),s.state==="validation"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de validation"})]})})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Validation entreprise"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline-block",children:O(s.validation_rh_state)}),e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:I(s.validation_rh_state)})]})]})}),e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Approbation CCBM"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline-block",children:O(s.validation_admin_state)}),e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:I(s.validation_admin_state)})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Date commande "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:D(s.date_order)})})]})}),e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Date de livraison"}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:D(s.commitment_date)})})]})})]}),s&&s.credit_type!=="banque"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Type crédit  "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:s.credit_type=="direct"?"Direct":"Financé"})})]})}),e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Total Payé  "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:l(S)})})]})}),e.jsx("div",{className:"flex-1 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Total Restant   "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:l(c)})})]})})]})}),s&&s.credit_type==="banque"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx("div",{className:"sm:w-1/2 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Type crédit  "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:s.credit_type=="direct"?"Direct":"Financé"})})]})}),e.jsx("div",{className:"sm:w-1/2 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Total à Payé  "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:l(S)})})]})})]})}),ce&&F&&e.jsxs("div",{className:"w-full mb-8 p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm bg-white",children:[e.jsx("div",{className:"flex items-center mb-4 border-b pb-2",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Informations de l'employeur"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(K,{className:"w-5 h-5 text-gray-500 mr-3 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Nom de l'institution"}),e.jsx("div",{className:"text-gray-900",children:_.institution_name||"Non spécifié"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Pe,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Email Institution"}),e.jsx("div",{className:"text-gray-900",children:F.email||"Non spécifié"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(K,{className:"w-5 h-5 text-gray-500 mr-3 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Nom Employeur"}),e.jsx("div",{className:"text-gray-900",children:_.employer_name||"Non spécifié"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ke,{className:"w-5 h-5 text-gray-500 mr-3 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Adresse Employeur"}),e.jsx("div",{className:"text-gray-900",children:_.adresse_employeur||"Non spécifié"})]})]})]})})]}),e.jsx("h1",{className:"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center",children:"Récapitulatif de la commande"}),e.jsx("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-4",children:[e.jsx("p",{className:"text-sm font-medium text-qblack uppercase",children:"Produit"}),e.jsx("p",{className:"text-sm font-medium text-qblack uppercase",children:"Total"})]}),e.jsx("div",{className:"space-y-4",children:Array.isArray(s.order_lines)&&s.order_lines.filter(t=>{const r=(t.product_name||"").toLowerCase();return!r.includes("réduction")&&!r.includes("reduction")}).map(t=>{var r;return e.jsxs("div",{className:"border rounded-md p-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-sm sm:text-base text-qblack mb-1",children:[t.product_name,e.jsxs("sup",{className:"text-xs text-qgray ml-1",children:["x ",(r=t.product_uom_qty)!=null?r:0," ",t.product_uom_name||""]})]}),!!t.description&&e.jsx("p",{className:"text-xs sm:text-sm text-qgray",children:t.description})]}),e.jsx("span",{className:"text-sm sm:text-base text-qblack font-medium",children:l(t.price_total)})]}),e.jsxs("div",{className:`mt-2 grid gap-2 text-sm ${(s.credit_type==="banque"||s.credit_type==="finance")&&t.discount?"sm:grid-cols-5":"sm:grid-cols-4"}`,children:[e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-gray-500",children:"Prix unitaire"}),e.jsx("span",{className:"font-medium sm:block",children:l(t.price_unit)})]}),(s.credit_type==="banque"||s.credit_type==="finance")&&t.discount&&t.discount>0&&e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsxs("span",{className:"text-gray-500",children:["Remise (",t.discount,"%)"]}),e.jsxs("span",{className:"font-medium sm:block text-green-600",children:["-",l(i(t.price_unit)*i(t.discount)/100*i(t.product_uom_qty||1))]})]}),e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-gray-500",children:"Sous-total (HT)"}),e.jsx("span",{className:"font-medium sm:block",children:l(t.price_subtotal)})]}),e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-gray-500",children:"TVA"}),e.jsx("span",{className:"font-medium sm:block",children:t.price_tax==null?"—":l(t.price_tax)})]}),e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-gray-500",children:"Total (TTC)"}),e.jsx("span",{className:"font-semibold sm:block",children:l(t.price_total)})]})]})]},t.id)})}),s&&s.credit_type==="banque"&&e.jsx("div",{className:"w-full flex justify-center mb-4",children:e.jsx("button",{onClick:de,className:"px-4 py-2 rounded bg-[#487a43] text-white disabled:opacity-60",disabled:U||!s,title:E||"",children:U?"Préparation du PDF...":"Télécharger la Pro-Forma"})}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Sous-total (hors TVA)"}),e.jsx("dd",{className:"text-sm text-gray-900 font-medium",children:l(le)})]}),(s.credit_type==="banque"||s.credit_type==="finance")&&X>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Remise globale"}),e.jsxs("dd",{className:"text-sm text-green-600 font-medium",children:["-",l(X)]})]}),W!==0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Réduction"}),e.jsx("dd",{className:"text-sm text-red-600 font-medium",children:l(W)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"TVA (18%)"}),e.jsx("dd",{className:"text-sm text-gray-900 font-medium",children:l(ie)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Total TTC"}),e.jsx("dd",{className:"text-sm text-gray-900 font-medium",children:l(C)})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("dt",{className:"text-sm text-gray-500",children:["Mode crédit : ",i(s.creditorder_month_count,0)," paiement(s)"]}),e.jsxs("dd",{className:"text-sm text-gray-900 font-medium",children:["Total: ",l(C)]})]}),g.map((t,r)=>{var d;return e.jsxs("dl",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("dt",{className:"text-sm text-gray-500",children:[t.label||`Paiement ${r+1}`,t.due_date&&e.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:["(échéance: ",D(t.due_date),")"]})]}),e.jsxs("dd",{className:`text-sm sm:text-base font-medium ${t.state?"text-green-600":"text-gray-900"}`,children:[l(i(t.amount))," ",t.state?"✓":""]})]},(d=t.sequence)!=null?d:r)})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total à payer"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-gray-900",children:l(C)})]}),e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total Payé"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-green-600",children:l(S)})]}),s&&s.credit_type!=="banque"&&e.jsx(e.Fragment,{children:e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total Restant"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-gray-900",children:l(c)})]})})]}),q&&!M?e.jsx("div",{className:"mt-6",children:s&&s.credit_type!=="banque"&&e.jsxs(e.Fragment,{children:[e.jsx(je,{htmlFor:"montant",children:"Montant à payer"}),e.jsx(ye,{id:"montant",type:"number",value:p,disabled:!q||M,onChange:t=>{const r=Math.min(i(t.target.value,0),c);B(r),f?r<x?b(`Le montant doit être au moins l'acompte requis (${l(x)}).`):b(""):r<u?b(`Le montant doit être ≥ ${l(u)}.`):b("")},min:f?x:u,max:c,placeholder:f?`Acompte minimum: ${l(x)} (vous pouvez payer plus)`:`Minimum ${l(u)}`,className:"mt-1"}),V&&e.jsx("p",{className:"text-red-500 mt-1",children:V}),e.jsxs(Ne,{onClick:re,className:"mt-4 w-full !bg-[#487a43] !text-white hover:!bg-[#3f6d3b]  disabled:!bg-[#487a43]/50 disabled:!text-white/70 disabled:cursor-not-allowed",disabled:ne||T,children:[(j||T)&&e.jsx(J,{className:"mr-2 h-4 w-4 animate-spin"}),T?"Mise à jour...":`Passer à la caisse (${l(i(p))})`]}),f?e.jsxs("p",{className:"mt-2 text-xs text-gray-500 text-center",children:["Acompte requis :"," ",e.jsx("strong",{children:l(i(x))})," minimum. Vous pouvez payer ",e.jsx("em",{children:"au moins"})," l'acompte (et plus si vous voulez), sans dépasser le restant."]}):e.jsxs("p",{className:"mt-2 text-xs text-gray-500 text-center",children:["Paiement libre : choisissez le montant que vous souhaitez (minimum"," ",e.jsx("strong",{children:l(u)}),"), jusqu'à"," ",e.jsx("strong",{children:l(c)})," restant."]})]})}):e.jsxs(e.Fragment,{children:[!q&&e.jsx("p",{className:"text-yellow-500 mt-4 text-center text-base sm:text-xl",children:"Merci d'attendre la validation de la commande à crédit par la RH et CCBM"}),M&&e.jsx("p",{className:"text-green-600 mt-4 text-center text-base sm:text-xl",children:"Votre paiement est déjà réglé"})]})]})}),se&&s&&e.jsx(Fe,{handlePay:ae,totalAmount:i(p),onClose:()=>P(!1),order:s,idOrder:s.id,onSuccess:v})]})})}),!j&&!s&&e.jsx("div",{className:"flex justify-center items-center py-10",children:"Commande à Crédit non trouvée"})]})})]})}export{De as default};

import{u as F,I as k,D as N,B as y,j as e,L as M,i as A,k as q,y as L,f as r,W as B,z as I,T,t as b,l as g}from"./index.4298c315.js";import{j as O,r as n}from"./vendor.af94f9e3.js";import{f as R}from"./date-format.d160e78b.js";function G(){const{id:t}=O(),{user:s}=F(),[a,u]=n.useState(null),[j,m]=n.useState(!1),[p,d]=n.useState(!1),[h,w]=n.useState(null),[P,c]=n.useState(""),[o,_]=n.useState(0),[C,v]=n.useState(!0),f=n.useCallback(async()=>{try{const l=await k.getCommandeById(s.id,t);u(l);const x=await N.getPaymentDetailsByIdOrder(l.id);w(x),console.log("Payment Details: ",x)}catch(l){console.error("Erreur lors de la récupération des modèles",l),y.error("Erreur lors de la récupération des données de la commande")}},[s.id,t]);n.useEffect(()=>{f()},[f]),n.useEffect(()=>{const l=setTimeout(async()=>{a&&h&&h.payment_state==="completed"&&a.advance_payment_status==="not_paid"&&!h.token_status&&E()},1e3);return()=>clearTimeout(l)},[h,a]),n.useEffect(()=>{o<100?(c("Le montant minimum est de 100 FCFA"),v(!0)):(c(""),v(!1)),a&&a.payment_mode=="echelonne"&&(o>a.amount_residual?(c("Le montant à payer ne doit pas dépasser le montant restant à payer"),v(!0)):(c(""),v(!1)))},[o]);const E=async()=>{m(!0);try{await N.createCommandePaiment(a.id),window.location.reload(),y.success("Paiement de la commande validé avec succès")}catch(l){console.error("Erreur lors de la création du paiement :",l),y.error("Erreur lors de la création du paiement")}finally{m(!1)}},D=(l,x)=>{if(l.preventDefault(),_(x),x<100){c("Le montant minimum est de 100 FCFA");return}d(!0)},S=async l=>{console.log("Payment data: ",l),m(!1),y.success("Payment validé avec succès")};return a?e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"CCBM Shop | Détails commande",description:"Consultez les détails de votre commande sur CCBM Shop, votre destination pour l'électroménager de qualité.",keywords:"détails commande, CCBM Shop, ccbme, suivi commande, paiement électroménager"}),e.jsx(q,{childrenClasses:" pt-0 pb-0",children:e.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full mb-5",children:e.jsx(L,{title:"Détails Commande",breadcrumb:[{name:"Accueil",path:"/"},{name:"Commandes",path:"/profile#order"},{name:"Détails Commande"}]})}),e.jsx("div",{className:"checkout-main-content w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx(i,{label:"N°Commande",value:a.name}),a.payment_mode==="domicile"&&e.jsx(i,{label:"Paiement",value:a.advance_payment_status==="not_paid"?"A domicile":"Non Payé",className:a.advance_payment_status==="not_paid"?"text-red-500":"text-green-500"}),a.payment_mode==="online"&&e.jsx(i,{label:"Paiement",value:a.advance_payment_status==="not_paid"?"Non Payé":"Payé",className:a.advance_payment_status==="not_paid"?"text-red-500":"text-green-500"}),a.payment_mode==="echelonne"&&e.jsx(i,{label:"Paiement",value:a.advance_payment_status==="not_paid"?"Non Payé":a.advance_payment_status==="paid"?"Payé":"Partiellement Payé",className:a.advance_payment_status==="not_paid"?"text-red-500":a.advance_payment_status==="paid"?"text-green-500":a.advance_payment_status==="partial"?"text-yellow-500":""}),e.jsx(i,{label:"Statut",value:a.state==="sale"?"Validée":a.state==="to_delivered"?"En cours de livraison":a.state==="delivered"?"Livrée":"Non validé",className:a.state==="sale"?"text-green-500":a.state==="to_delivered"?"text-yellow-500":a.state==="delivered"?"text-green-600":"text-gray-500"})]}),a.payment_mode==="echelonne"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"sm:flex sm:space-x-[18px] mt-5",children:[e.jsx(i,{label:"Montant Restant",value:r(a.amount_residual)+" FCFA"}),e.jsx(i,{label:"Montant Total",value:["not_paid","paid"].includes(a.advance_payment_status)?e.jsx("span",{className:`text-${a.advance_payment_status==="not_paid"?"red":"green"}-500`,children:r(a.amount_total)}):e.jsxs(e.Fragment,{children:[" ",r(a.amount_total)]})}),e.jsx(i,{label:"Montant Avancé",value:r(a.amount_total-a.amount_residual)})]})}),e.jsxs("div",{className:"sm:flex sm:space-x-[18px] mt-5",children:[e.jsx(i,{label:"Mode de Paiement",value:a.payment_mode==="online"?"En ligne":a.payment_mode==="domicile"?"A domicile":"Echelonné"}),e.jsx(i,{label:"Date de livraison",value:R(a.commitment_date)})]})]}),e.jsx(z,{commande:a}),e.jsx(W,{commande:a,montantAPayer:o,setMontantAPayer:_,errorMontantAPayer:P,stateButton:C,isLoading:j,validerPaiment:D}),p&&a&&e.jsx(e.Fragment,{children:e.jsx(B,{handlePay:S,totalAmount:o,onClose:()=>d(!1),order:a,idOrder:a.id})})]})})]})})]}):e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(M,{className:"animate-spin mr-2"})," Chargement de la commande..."]})}const i=({label:t,value:s,className:a=""})=>e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:[t,"  : ",e.jsx("span",{className:a,children:s})]})})}),z=({commande:t})=>e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"sm:text-2xl text-xl text-qblack font-medium mb-5",children:"Récapitulatif de la commande"}),e.jsxs("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:[e.jsxs("div",{className:"sub-total mb-6",children:[e.jsxs("div",{className:"flex justify-between mb-5",children:[e.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Produit"}),t.type_order=="commande"&&e.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Total"})]}),e.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"})]}),e.jsx("div",{className:"product-list w-full mb-[30px]",children:e.jsx("ul",{className:"flex flex-col space-y-5",children:t.order_lines.map((s,a)=>e.jsx("li",{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-[15px] text-qblack mb-2.5",children:[s.product_name,e.jsx("sup",{className:"text-[13px] text-qgray ml-2 mt-2",children:t.type_order=="commande"&&e.jsxs("span",{children:["   = ",s.product_uom_qty," x ",s.price_total]})})]}),e.jsx("p",{className:"text-[13px] text-qgray",children:s.description})]}),e.jsx("div",{children:t.type_order=="commande"&&e.jsx("span",{className:"text-[15px] text-qblack font-medium",children:r(s.price_total)})})]})},a))})}),e.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"}),e.jsx("div",{className:"mt-[30px]",children:e.jsxs("div",{className:"flex justify-between mb-5",children:[e.jsx("p",{className:"text-2xl font-medium text-qblack",children:"Total à payer"}),e.jsxs("p",{className:"text-2xl font-medium",children:[["partial"].includes(t.advance_payment_status)&&e.jsx("span",{className:"text-yellow-500",children:r(t.amount_total)}),["paid"].includes(t.advance_payment_status)&&e.jsx("span",{className:"text-green-500",children:r(t.amount_total)}),["not_paid"].includes(t.advance_payment_status)&&e.jsx("span",{className:"text-red-500",children:r(t.amount_total)})]})]})})]})]}),W=({commande:t,montantAPayer:s,setMontantAPayer:a,errorMontantAPayer:u,stateButton:j,isLoading:m,validerPaiment:p})=>e.jsx("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8",children:t.advance_payment_status==="not_paid"||t.advance_payment_status==="partial"?e.jsxs(e.Fragment,{children:[t.payment_mode==="domicile"&&e.jsx("div",{className:"flex justify-center items-center mt-2",children:e.jsx("span",{className:"text-lg font-medium text-red-500 dark:text-white",children:"Le paiement se fera à domicile"})}),t.payment_mode==="echelonne"&&e.jsx("div",{children:(t.advance_payment_status==="not_paid"||t.advance_payment_status==="partial")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"input-item mb-5",children:[e.jsx("div",{className:"mb-2 inline-block",children:e.jsx(I,{htmlFor:"montant",value:"Montant à payer"})}),e.jsx(T,{id:"montant",placeholder:"Minimum 1000 F CFA",label:"Montant*",name:"montantAPayer",type:"number",value:s,onChange:d=>a(d.target.value),max:t.amount_residual,min:1e3,required:!0,className:"invalid:border-red-500 invalid:text-red-600 focus:invalid:border-red-500 focus:invalid:ring-red-500"}),u&&e.jsx("p",{className:"text-yellow-500",children:u})]}),e.jsxs(b,{type:"submit",onClick:d=>p(d,s),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:j,children:[m&&e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",r(s),")"]})]})}),t.payment_mode==="online"&&e.jsxs(b,{type:"submit",onClick:d=>p(d,t.amount_total),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:m,children:[m&&e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",r(t.amount_total),")"]})]}):e.jsx("div",{className:"w-full h-[50px] flex justify-center items-center",children:e.jsx("span",{className:"text-green-500",children:"Le paiement a été effectué avec succès"})})});export{G as default};

import{u as k,G as E,f as n,j as e,L as D,h as $,i as B,A as z,B as L,D as I,T as O,s as P,k as q}from"./index-uXOjFdTc.js";import{m as R,b as i}from"./vendor-EKSpuOPe.js";import{f as V}from"./date-format-qL-o8H-f.js";import{W}from"./wave-orange-payment-service-CfDtXwfW.js";function U(){const{id:s}=R(),{user:m}=k(),[t,N]=i.useState(null),[C,j]=i.useState(!1),[g,p]=i.useState(!1),[v,a]=i.useState(""),[u,b]=i.useState(0),[A,d]=i.useState(!0),M=i.useCallback(async()=>{try{const r=await E.getCommandeById(m.id,s);N(r)}catch(r){console.error("Erreur lors de la récupération des données de la commande",r)}},[m.id,s]);i.useEffect(()=>{M()},[M]);const f=i.useMemo(()=>String(t?.type_sale||"").toLowerCase()==="order",[t?.type_sale]),w=i.useMemo(()=>Array.isArray(t?.payment_lines)?t.payment_lines:null,[t]),y=i.useMemo(()=>w&&(w.find(r=>r.sequence===1)||w[0])||null,[w]),_=i.useMemo(()=>y?!y.state:!1,[y]),l=i.useMemo(()=>{const r=Number(t?.amount_residual||0);return f?r>0?50:0:t?.payment_mode==="echelonne"?_&&y?Math.max(0,Number(y.amount)||0):r<=0?0:Math.min(Math.max(1e3,0),r):1e3},[t?.amount_residual,t?.payment_mode,f,_,y]);i.useEffect(()=>{if(t){if(f){b(l),a("");return}t.payment_mode==="echelonne"?(b(l),a("")):t.payment_mode==="online"?(b(Number(t.amount_total||0)),a("")):(b(0),a(""))}},[t,l,f]);const F=(r,c)=>{r.preventDefault();const h=Number(t?.amount_residual||0),o=Number(c||0);if(f){if(h<=0){L.info("Aucun montant restant à payer.");return}if(o<=0){a("Le montant doit être > 0.");return}if(o>h){a("Le montant ne doit pas dépasser le montant restant à payer.");return}a(""),p(!0);return}if(t.payment_mode==="echelonne"){if(h<=0){L.info("Aucun montant restant à payer.");return}if(_){if(o!==Number(l)){a(`Le montant doit être exactement l'acompte requis (${n(l)}).`);return}}else if(o<Number(l)){a(`Le montant doit être ≥ ${n(l)}.`);return}if(o>h){a("Le montant à payer ne doit pas dépasser le montant restant à payer");return}a(""),p(!0);return}if(t.payment_mode==="online"){if(o<1e3){a("Le montant minimum est de 1000 FCFA");return}if(o!==Number(t.amount_total||0)){a("Le montant à payer doit correspondre au total de la commande");return}a(""),p(!0);return}if(t.payment_mode==="domicile"){L.info("Le paiement se fera à domicile.");return}},S=async r=>{j(!1),L.success("Paiement validé avec succès")};return i.useEffect(()=>{if(!t)return;const r=Number(t?.amount_residual||0),c=Number(u||0);if(f){if(r<=0){d(!0);return}if(c<=0){a("Le montant doit être > 0."),d(!0);return}if(c>r){a("Le montant ne doit pas dépasser le montant restant à payer."),d(!0);return}a(""),d(!1);return}if(t.payment_mode==="echelonne"){if(r<=0){d(!0);return}if(_){const h=c===Number(l);d(!h),a(h?"":`Le montant doit être exactement l'acompte requis (${n(l)}).`);return}else{if(c<Number(l)){a(`Le montant doit être ≥ ${n(l)}.`),d(!0);return}if(c>r){a("Le montant à payer ne doit pas dépasser le montant restant à payer"),d(!0);return}a(""),d(!1);return}}if(t.payment_mode==="online"){c<1e3?(a("Le montant minimum est de 1000 FCFA"),d(!0)):c!==Number(t.amount_total||0)?(a("Le montant à payer doit correspondre au total de la commande"),d(!0)):(a(""),d(!1));return}d(!0)},[t,u,_,l,f]),t?e.jsxs(e.Fragment,{children:[e.jsx($,{title:"CCBM Shop | Détails commande",description:"Consultez les détails de votre commande sur CCBM Shop, votre destination pour l'électroménager de qualité.",keywords:"détails commande, CCBM Shop, ccbme, suivi commande, paiement électroménager"}),e.jsx(B,{childrenClasses:" pt-0 pb-0",children:e.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full mb-5",children:e.jsx(z,{title:"Détails Commande",breadcrumb:[{name:"Accueil",path:"/"},{name:"Commandes",path:"/profile#order"},{name:"Détails Commande"}]})}),e.jsx("div",{className:"checkout-main-content w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx(x,{label:"N°Commande",value:t.name}),t.payment_mode==="domicile"&&e.jsx(x,{label:"Paiement",value:t.advance_payment_status==="not_paid"?"A domicile":"Non Payé",className:t.advance_payment_status==="not_paid"?"text-red-500":"text-green-500"}),t.payment_mode==="online"&&e.jsx(x,{label:"Paiement",value:t.advance_payment_status==="not_paid"?"Non Payé":"Payé",className:t.advance_payment_status==="not_paid"?"text-red-500":"text-green-500"}),t.payment_mode==="echelonne"&&e.jsx(x,{label:"Paiement",value:t.advance_payment_status==="not_paid"?"Non Payé":t.advance_payment_status==="paid"?"Payé":"Partiellement Payé",className:t.advance_payment_status==="not_paid"?"text-red-500":t.advance_payment_status==="paid"?"text-green-500":t.advance_payment_status==="partial"?"text-yellow-500":""}),e.jsx(x,{label:"Statut",value:t.state==="sale"?"Validée":t.state==="to_delivered"?"En cours de livraison":t.state==="delivered"?"Livrée":"Non validé",className:t.state==="sale"?"text-green-500":t.state==="to_delivered"?"text-yellow-500":t.state==="delivered"?"text-green-600":"text-gray-500"})]}),t.payment_mode==="echelonne"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"sm:flex sm:space-x-[18px] mt-5",children:[e.jsx(x,{label:"Montant Restant",value:`${n(t.amount_residual)}`}),e.jsx(x,{label:"Montant Total",value:["not_paid","paid"].includes(t.advance_payment_status)?e.jsx("span",{className:`text-${t.advance_payment_status==="not_paid"?"red":"green"}-500`,children:n(t.amount_total)}):e.jsxs(e.Fragment,{children:[" ",n(t.amount_total)]})}),e.jsx(x,{label:"Montant Avancé",value:n(t.amount_total-t.amount_residual)})]})}),e.jsxs("div",{className:"sm:flex sm:space-x-[18px] mt-5",children:[e.jsx(x,{label:"Mode de Paiement",value:t.payment_mode==="online"?"En ligne":t.payment_mode==="domicile"?"A domicile":"Echelonné"}),e.jsx(x,{label:"Date de livraison",value:V(t.commitment_date)})]})]}),e.jsx(G,{commande:t}),e.jsx(H,{commande:t,montantAPayer:u,setMontantAPayer:r=>{const c=Number(t?.amount_residual||0),h=Number(r||0),o=Math.min(h,c);if(b(o),f){o<=0?a("Le montant doit être > 0."):a("");return}t.payment_mode==="echelonne"?_?o!==Number(l)?a(`Le montant doit être exactement l'acompte requis (${n(l)}).`):a(""):o<Number(l)?a(`Le montant doit être ≥ ${n(l)}.`):a(""):t.payment_mode==="online"&&(o<1e3?a("Le montant minimum est de 1000 FCFA"):o!==Number(t.amount_total||0)?a("Le montant à payer doit correspondre au total de la commande"):a(""))},errorMontantAPayer:v,stateButton:A,isLoading:C,validerPaiment:F,minAmountToPay:l,acompteDue:_,isTypeOrder:f}),g&&t&&e.jsx(W,{handlePay:S,totalAmount:u,onClose:()=>p(!1),order:t,idOrder:t.id})]})})]})})]}):e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(D,{className:"animate-spin mr-2"})," Chargement de la commande..."]})}const x=({label:s,value:m,className:t=""})=>e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:[s,"  : ",e.jsx("span",{className:t,children:m})]})})}),G=({commande:s})=>e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"sm:text-2xl text-xl text-qblack font-medium mb-5",children:"Récapitulatif de la commande"}),e.jsxs("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:[e.jsx("div",{className:"sub-total mb-6",children:e.jsxs("div",{className:"flex justify-between mb-5",children:[e.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Produit"}),s.type_order==="commande"&&e.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Total"})]})}),e.jsx("div",{className:"product-list w-full mb-[30px]",children:e.jsx("ul",{className:"flex flex-col space-y-5",children:s.order_lines.map((m,t)=>e.jsx("li",{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-[15px] text-qblack mb-2.5",children:[m.product_name,e.jsx("sup",{className:"text-[13px] text-qgray ml-2 mt-2",children:s.type_order==="commande"&&e.jsxs("span",{children:[" = ",m.product_uom_qty," x ",n(m.price_total)]})})]}),e.jsx("p",{className:"text-[13px] text-qgray",children:m.description})]}),e.jsx("div",{children:s.type_order==="commande"&&e.jsx("span",{className:"text-[15px] text-qblack font-medium",children:n(m.price_total)})})]})},t))})}),e.jsx("div",{className:"mt-[30px]",children:e.jsxs("div",{className:"flex justify-between mb-5",children:[e.jsx("p",{className:"text-2xl font-medium text-qblack",children:"Total"}),e.jsx("p",{className:"text-2xl font-medium",children:["not_paid","paid"].includes(s.advance_payment_status)&&e.jsx("span",{className:`text-${s.advance_payment_status==="not_paid"?"red":"green"}-500`,children:n(s.amount_total)})})]})})]})]}),H=({commande:s,montantAPayer:m,setMontantAPayer:t,errorMontantAPayer:N,stateButton:C,isLoading:j,validerPaiment:g,minAmountToPay:p,acompteDue:v,isTypeOrder:a})=>e.jsx("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8",children:s.advance_payment_status==="not_paid"||s.advance_payment_status==="partial"?e.jsxs(e.Fragment,{children:[s.payment_mode==="domicile"&&e.jsx("div",{className:"flex justify-center items-center mt-2",children:e.jsx("span",{className:"text-lg font-medium text-red-500 dark:text-white",children:"Le paiement se fera à domicile"})}),(s.payment_mode==="echelonne"||a)&&e.jsxs("div",{children:[e.jsxs("div",{className:"input-item mb-5",children:[e.jsx("div",{className:"mb-2 inline-block",children:e.jsx(I,{htmlFor:"montant",value:"Montant à payer"})}),e.jsx(O,{id:"montant",placeholder:a?"Montant libre (> 0)":v?`Acompte requis: ${n(p)}`:"Minimum 1000 F CFA",label:"Montant*",name:"montantAPayer",type:"number",value:m,onChange:u=>t(u.target.value),max:s.amount_residual,min:a?1:v?Number(p):0,required:!0,className:"invalid:border-red-500 invalid:text-red-600 focus:invalid:border-red-500 focus:invalid:ring-red-500"}),N&&e.jsx("p",{className:"text-yellow-500",children:N})]}),e.jsxs(P,{type:"submit",onClick:u=>g(u,m),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:C,children:[j&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",n(m),")"]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 text-center",children:a?e.jsxs(e.Fragment,{children:["Paiement libre : choisissez le montant que vous souhaitez (strictement > 0), jusqu’à ",e.jsx("strong",{children:n(s.amount_residual)})," restant."]}):v?e.jsxs(e.Fragment,{children:["Acompte requis : ",e.jsx("strong",{children:n(p)}),". Vous devrez solder l’acompte avant de pouvoir payer librement."]}):e.jsxs(e.Fragment,{children:["Paiement libre : choisissez le montant que vous souhaitez (minimum ",e.jsx("strong",{children:n(Math.max(1e3,Number(p)||0))}),"), jusqu’à ",e.jsx("strong",{children:n(s.amount_residual)})," restant."]})})]}),s.payment_mode==="online"&&!a&&e.jsxs(P,{type:"submit",onClick:u=>g(u,s.amount_total),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:j,children:[j&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",n(s.amount_total),")"]})]}):e.jsx("div",{className:"w-full h-[50px] flex justify-center items-center",children:e.jsx("span",{className:"text-green-500",children:"Le paiement a été effectué avec succès"})})});export{U as default};

import{b as m,j as e,u as F,C as H,B as M,l as z,x as u,L,v as W,a6 as X}from"./react-CJBSR92-u_nCHxWM.js";import{k as J,u as U,f as c,t as Q,S as O,L as Y,l as Z}from"./index-7aT0jyaVKf-5uYaT.js";import{P as b}from"./paimentService-Zh_K-kXJs3Nag3D_.js";import{f as R}from"./date-format-qL-o8H-fTKutKBrM.js";import{P as A}from"./precommandeService-CdMv87mahgZfInxm.js";import{a4 as B,a5 as ee}from"./vendor-DqtG7wAGu1JuSsNW.js";import"./UserContext--wqIdXm37ff68kR_.js";import{u as V,d as te}from"./react-router-DM7lm-eIKbi5VnqZ.js";import"./react-dom-DgVs7Ap73AfOoX-q.js";import"./ui-libs-DW48STyta0ayNJBW.js";import"./redux-4EhM0GaGlm-MPJuT.js";const se=({handlePay:j,totalAmount:r,onClose:s,order:t,idOrder:i})=>{console.log(t),localStorage.setItem("idOrderPayment",null),localStorage.setItem("montant",null),localStorage.setItem("tokenOrderPayment",null),localStorage.setItem("statusOrderPayment",null);const x=V(),{payment:E,setUserPayment:q,setOrder:w,setPaymentDetails:I,setTotalAmount:P}=m.useContext(J),{user:o}=U(),[p,_]=m.useState(!1),[N,v]=m.useState(!0),[h,$]=m.useState(null),[y,k]=m.useState(null),[g,S]=m.useState(null);m.useEffect(()=>{q(o),w(t),console.log("order "+i),console.log("motant "+r),console.log("user"),console.log(o);const l=new B.Setup({masterKey:"voFGVcul-uCsd-1sw5-wfGz-ukqScIQoOyDu",privateKey:"live_private_KvbXuQU1IJ4z68hQOU9YeEtrUjW",publicKey:"live_public_wgK4JebXd3SfGDWN64sEIffD5XR",token:"cjTGi71WL8xOTCrsJisR",mode:"live"});$(l);const a=new B.Store({name:"CCBM SHOP",email:"shop@ccbm.sn",tagline:"Votre boutique pour vos matériels électroménéger",phoneNumber:"+221 70 922 17 75",postalAddress:"Avenue Lamine Gueye,x Rue Marchand,Dakar-Senegal",logoURL:"https://www.ccbmshop.com/logo_192.png",websiteURL:"https://www.ccbmshop.com/"});k(a)},[]);const C=l=>{if(console.log("arrivé"),_(!0),l.preventDefault(),h&&y&&r>0){const a=new ee(h,y);console.log(a),t.order_lines.forEach(n=>{a.addItem(n.product_name,n.product_uom_qty,n.price_unit,n.price_subtotal)}),console.log(a),a.totalAmount=Math.ceil(r),t.type_sale==="order"?t.payment_mode=="echelonne"?a.description=`Paiement d'avance de ${c(Math.ceil(r))} pour la commande ${t.name}`:t.payment_mode=="online"&&(a.description=`Paiement de ${c(Math.ceil(r))} pour la commande ${t.name}`):t.type_sale==="preorder"?t.amount_residual>0?a.description=`Paiement de ${c(Math.ceil(r))} pour la précommande ${t.name} avec un montant total restant de ${t.amount_total-r}`:a.description=`Paiement de ${c(Math.ceil(r))} pour la précommande ${t.name}`:t.type_sale==="creditorder"&&(t.amount_residual>0?a.description=`Paiement de ${c(Math.ceil(r))} pour le crédit ${t.name} avec un montant total restant de ${t.amount_total-r}`:a.description=`Paiement de ${c(Math.ceil(r))} pour le crédit ${t.name}`),a.callbackURL="https://orbitcity.odoo.com/api/facture/paydunya",t.type_sale==="order"?a.returnURL=`http://localhost:5173/commandes/${i}/détails`:t.type_sale==="creditorder"?a.returnURL=`http://localhost:5173/credit-commandes/${i}/détails`:t.type_sale==="preorder"&&(a.returnURL=`http://localhost:5173/pre-commandes/${i}/détails`),a.returnURL="http://localhost:5173/payment-state",console.log("invoice",a),console.log(t),I(a),P(a.totalAmount),console.log(a),a.create().then(async function(){S(a),console.log(a),Q(i,r,t.order_lines.map(d=>({name:d.product_name,price:d.price_unit,quantity:d.product_uom_qty})));let n=null;t.type_sale==="order"?t.payment_mode=="echelonne"?n=`${o.id}-${i}-${r}-${t.name}-${t.type_sale}-${new Date().getTime().toString()}`:n=`${o.id}-${i}-${r}-${t.name}-${t.type_sale}`:t.type_sale==="preorder"?!t.first_payment_state&&!t.second_payment_state&&!t.third_payment_state?n=`${o.id}-${i}-${r}-${t.name}-${t.type_sale}-1`:t.first_payment_state&&!t.second_payment_state&&!t.third_payment_state?n=`${o.id}-${i}-${r}-${t.name}-${t.type_sale}-2`:n=`${o.id}-${i}-${r}-${t.name}-${t.type_sale}-3`:t.type_sale==="creditorder"?!t.first_payment_state&&!t.second_payment_state&&!t.third_payment_state&&!t.fourth_payment_state?n=`${o.id}-${i}-${r}-${t.name}-${t.type_sale}-1`:t.first_payment_state&&!t.second_payment_state&&!t.third_payment_state&&!t.fourth_payment_state?n=`${o.id}-${i}-${r}-${t.name}-${t.type_sale}-2`:t.first_payment_state&&t.second_payment_state&&t.third_payment_state&&!t.fourth_payment_state?n=`${o.id}-${i}-${r}-${t.name}-${t.type_sale}-3`:n=`${o.id}-${i}-${r}-${t.name}-${t.type_sale}-4`:n=`${o.id}-${i}-${r}-${t.name}-${t.type_sale}`;const f={transaction_id:n,amount:r,order_id:i,order_type:t.type_sale,order_name:t.name,partner_id:o.id,payment_token:a.token,payment_state:a.status};console.log("data payment",f),console.log(f);try{const d=await b.setPaymentDetails(f);d.order_type==="order"?(u.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),x(`/commandes/${i}/détails`)):d.order_type==="preorder"?(console.log("precommande"),u.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),x(`/pre-commandes/${i}/détails`)):d.order_type==="creditorder"?(console.log("commande"),u.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),x(`/credit-commandes/${i}/détails`)):d.payment_state==="completed"&&(u.success("Paiement effectif",{position:"top-center",autoClose:2e3}),x(`/commandes/${i}/détails`)),localStorage.setItem("urlOrderPayment",a.url),localStorage.setItem("statusOrderPayment",a.status),localStorage.setItem("tokenOrderPayment",a.token),localStorage.setItem("idDataPayment",d.id),localStorage.setItem("idOrderPayment",i),localStorage.setItem("montant",r),localStorage.setItem("responseTextOrderPayment",a.responseText)}catch(d){console.error("erreur lors de l'enregistrement details payment"),console.error(d),u.error("Payment non effectif "+d.message,{position:"top-center",autoClose:5e3})}}).catch(function(n){console.log(n),u.error("Payment non effectif "+n,{position:"top-center",autoClose:5e3})}).finally(()=>{_(!1)})}},D=l=>{l.preventDefault(),ae(g.url),v(!1),t.type_sale==="order"?(x(`/commandes/${i}/détails`),x("/profile#order")):t.type_sale==="preorder"?x("/profile#preorder"):t.type_sale==="creditorder"&&x("/profile#commandes-a-credit")};return e.jsxs(F,{size:"xl",className:"h-auto",show:N,popup:!0,onClose:s,children:[e.jsx(F.Header,{}),e.jsx(F.Body,{children:e.jsx("div",{className:"fixed inset-0 p-4 flex flex-wrap justify-center items-center w-full h-full z-[1000] before:fixed before:inset-0 before:w-full before:h-full before:bg-[rgba(0,0,0,0.5)] overflow-auto font-[sans-serif]",children:e.jsxs("div",{className:"w-full max-w-lg bg-white shadow-lg rounded-lg p-8 relative",children:[e.jsxs("div",{className:"flex items-start border-b border-gray-300 pb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-gray-800 text-xl font-bold",children:["Paiement"," ",t.type_sale=="order"?"Commande":t.type_sale=="preorder"?"Pré Commande":"Commande à crédit"," "]}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Résumé détaillé de votre commande."})]}),e.jsx("p",{children:e.jsx(H,{onClick:s,className:"cursor-pointer hover:text-red-500 hover:scale-150 duration-300"})})]}),t&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"my-8",children:[e.jsx("table",{className:"w-full",children:e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Nom de la commande :"}),e.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:t.name})]})})}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Nom produit"}),e.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:"Prix total"})]})}),e.jsx("tbody",{children:t&&t.order_lines.map((l,a)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-left text-gray-800 text-sm py-2",children:[l.product_name," (",l.product_uom_qty,")  "]}),e.jsx("td",{className:"text-right text-gray-800 text-sm py-2 font-medium",children:c(l.price_total)})]},a))})]}),e.jsx("table",{className:"w-full",children:e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Total Commande (en FCFA) :"}),e.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:c(Math.ceil(t.amount_total))})]}),t.payment_mode=="echelonne"&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Total à payer  (en FCFA) :"}),e.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:c(Math.ceil(r))})]})})]})}),e.jsx("br",{}),e.jsxs("div",{className:"flex max-sm:flex-col items-center gap-4 mt-8",children:[h&&y&&!g&&e.jsxs(M,{onClick:C,disabled:p,pill:!0,className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",children:[" ",p&&e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx("p",{children:"Validation"})]}),!p&&"Valider"]}),h&&y&&g&&e.jsx(M,{disabled:!g,onClick:l=>D(l),color:"success",pill:!0,className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",children:"Passer au paiement"})]})]})})]})})})]})};function ae(j){const r=window.open(j,"_blank","noopener,noreferrer");r&&(r.opener=null)}function ye(){const{id:j}=te(),{user:r}=U();V();const[s,t]=m.useState(null),[i,x]=m.useState(!1),[E,q]=m.useState(0),[w,I]=m.useState(null),[P,o]=m.useState(!1),[p,_]=m.useState(0),[N,v]=m.useState(""),[h,$]=m.useState(null),[y,k]=m.useState(!1);console.log(j),m.useEffect(()=>{let l=!0;return(async()=>{x(!0);try{const n=await A.getPreCommandeById(r.id,j);if(l){t(n),console.log(n);const f=await b.getPaymentDetailsByIdOrder(n.id);$(f)}}catch(n){console.error("Erreur lors de la récupération des modèles",n)}finally{x(!1)}})(),()=>{l=!1}},[]),m.useEffect(()=>{if(s){const l=s.first_payment_state&&p<1e3||!s.first_payment_state&&p<s.first_payment_amount||i;k(l)}},[s,p,i]);const g=l=>{l&&window.open(l,"_blank","noopener,noreferrer")},S=async(l,a)=>{console.log(a);try{const n=await b.confirmInvoice(a.payment_token);if(n.response_code==="00"&&n.status==="completed"){const f=n.receipt_url;let d=n.customer.name,G=n.customer.email,K=n.customer.phone;if(await b.updatePaymentDetails(a.id,n.status,f,d,G,K,!0))try{await b.createPrecommandePaimentMontant(a.order_id,a.amount,a.payment_token)&&u.success("Paiement validé avec succès",{position:"top-center",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}catch(T){console.log(T)}finally{x(!1)}}else u.error("Vérification du paiement echouée",{position:"top-center",autoClose:5e3})}catch(n){console.error("Erreur lors de la confirmation de l'invoice :",n.message)}finally{x(!1)}},C=async(l,a)=>{l.preventDefault(),a<1e3?u.warning("Le Montant doit être strictement supérieur à 1000 F CFA",{position:"top-center",autoClose:5e3}):o(!0),console.log(a,s.id)},D=async()=>{console.log(E,w)};return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"CCBM Shop | Détails Précommande",description:"Découvrez les meilleures offres sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité. Explorez nos produits allant des réfrigérateurs aux téléviseurs intelligents, et profitez de promotions exclusives !",keywords:"électroménager, boutique en ligne d'électroménager, CCBM Shop, ccbme, appareils électroménagers à prix réduits, smart TV, réfrigérateurs modernes, climatiseurs efficaces, promotions électroménager"}),e.jsx(Y,{childrenClasses:"pt-0 pb-0",children:e.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full mb-5",children:e.jsx(Z,{title:"Détails Pré Commande",breadcrumb:[{name:"Accueil",path:"/"},{name:"Précommandes",path:"/profile#preorder"},{name:"Détails Précommande "}]})}),i&&e.jsx("div",{className:"flex justify-center items-center w-full h-full",children:e.jsx(L,{size:60,className:"animate-spin"})}),s&&e.jsx("div",{className:"checkout-main-content w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[e.jsxs("div",{className:"sm:flex sm:space-x-[18px] s",children:[e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["N°Précommande ",e.jsx("span",{children:s.name})]})})}),e.jsx("div",{className:" sm:w-1/3  flex-1 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["Paiement :"," ",s.advance_payment_status==="not_paid"&&e.jsx("span",{className:"text-red-500",children:"Non Payé"}),s.advance_payment_status==="paid"&&e.jsx("span",{className:"text-green-500",children:" Payé "}),s.advance_payment_status==="partial"&&e.jsxs("span",{className:"text-yellow-500",children:[" ","Partiellement Payé"]})]})})}),e.jsx("div",{className:"sm:w-1/3 flex-1 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["Statut :"," ",s.state=="sale"&&e.jsx("span",{className:"text-green-500",children:" Validée "}),s.state=="to_delivered"&&e.jsx("span",{className:"text-yellow-500",children:" En cours de livraison "}),s.state=="delivered"&&e.jsx("span",{className:"text-green-600",children:" Livrée "}),s.state!="delivered"&&s.state!="sale"&&s.state!="to_delivered"&&e.jsx("span",{className:"text-gray-500",children:" Non validé "})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Date Précommande "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:R(s.date_order)})})]})}),e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Date de livraison"}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:R(s.commitment_date)})})]})})]}),e.jsxs("div",{className:"sm:flex sm:space-x-[18px] s",children:[e.jsx("div",{className:"sm:w-1/2 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"  Total Payé   "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:c(s.amount_total-s.amount_residual)})})]})}),e.jsx("div",{className:"flex-1 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"     Total Restant   "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:c(s.amount_residual)})})]})})]}),h&&h.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center",children:"Récapitulatif Paiement"}),e.jsxs("div",{className:"w-full px-4 sm:px-10 py-6 sm:py-[30px] border border-[#EDEDED] rounded-lg",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm sm:text-base font-medium text-qblack uppercase mb-2",children:"Détails Paiements"}),e.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"hidden sm:table-header-group",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Prénom & Nom"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Téléphone"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Montant Payé"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider",children:"Facture"})]})}),e.jsx("tbody",{children:h.map((l,a)=>l.payment_state==="completed"&&e.jsxs("tr",{className:"sm:bg-white flex flex-col sm:table-row mb-6 sm:mb-0",children:[e.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[e.jsx("span",{className:"sm:hidden font-medium",children:"Prénom & Nom:"}),e.jsx("span",{className:"text-sm leading-5 text-gray-900",children:l.customer_name})]})}),e.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[e.jsx("span",{className:"sm:hidden font-medium",children:"Téléphone:"}),e.jsx("span",{className:"text-sm leading-5 text-gray-900",children:l.customer_phone})]})}),e.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[e.jsx("span",{className:"sm:hidden font-medium",children:"Email:"}),e.jsx("span",{className:"text-sm leading-5 text-gray-900",children:l.customer_email})]})}),e.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[e.jsx("span",{className:"sm:hidden font-medium",children:"Montant Payé:"}),e.jsx("span",{className:"text-sm leading-5 text-gray-900",children:c(l.amount)})]})}),e.jsx("td",{className:"px-4 py-3 sm:border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between sm:table-cell",children:[e.jsx("span",{className:"sm:hidden font-medium",children:"Facture:"}),l.token_status?e.jsx("button",{className:"text-sm leading-5 text-blue-600 underline",onClick:()=>g(l.url_facture),children:"Ouvrir la facture"}):e.jsx("button",{className:"text-sm leading-5 text-blue-600 underline",onClick:n=>S(n,l),children:"Vérifier le paiement"})]})})]},a))})]})})]})]})})]}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center",children:"Récapitulatif de la commande"}),e.jsxs("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:[e.jsxs("div",{className:"sub-total mb-6",children:[e.jsxs("div",{className:" flex justify-between mb-5",children:[e.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Produit"}),e.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"total"})]}),e.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"})]}),e.jsx("div",{className:"product-list w-full mb-[30px]",children:e.jsx("ul",{className:"flex flex-col space-y-5",children:s.order_lines.map((l,a)=>e.jsx(e.Fragment,{children:e.jsx("li",{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-[15px] text-qblack mb-2.5",children:[l.product_name,e.jsxs("sup",{className:"text-[13px] text-qgray ml-2 mt-2",children:["x ",l.product_uom_qty]})]}),e.jsx("p",{className:"text-[13px] text-qgray",children:l.description})]}),e.jsx("div",{children:e.jsx("span",{className:"text-[15px] text-qblack font-medium",children:c(l.price_total)})})]})},a)}))})}),e.jsx("div",{className:"w-full h-[1px] bg-[#EDEDED]"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-t pt-4 space-y-2",children:[{label:"Montant Total",value:c(s.amount_total)},{label:"Premier Tranche",value:c(s.first_payment_amount),date:s.first_payment_date,state:s.first_payment_state},{label:"Deuxieme Tranche",value:c(s.second_payment_amount),date:s.second_payment_date,state:s.second_payment_state},{label:"Troisieme Tranche",value:c(s.third_payment_amount),date:s.third_payment_date,state:s.third_payment_state}].map((l,a)=>e.jsxs("dl",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:l.label}),l.date&&e.jsx("dd",{className:`text-xs sm:text-sm font-medium ${l.state?"text-green-500":"text-red-500"}`,children:l.date}),e.jsx("dd",{className:`text-sm sm:text-base font-medium ${l.state?"text-green-500":l.date?"text-red-500":"text-gray-900"}`,children:l.value})]},a))}),e.jsxs("dl",{className:"flex items-center justify-between gap-4 border-t border-gray-200 pt-2 dark:border-gray-700",children:[e.jsx("dt",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Total à payer"}),e.jsx("dd",{className:"text-lg font-bold text-gray-900 dark:text-white",children:c(s.amount_total)})]}),s.amount_residual>=0&&e.jsxs("dl",{className:"flex items-center justify-between gap-4 border-t border-gray-200 pt-2 dark:border-gray-700",children:[e.jsx("dt",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Total Payé"}),e.jsx("dd",{className:"text-lg font-bold text-green-500 dark:text-white",children:c(s.amount_total-s.amount_residual)})]}),s.amount_residual>=0&&e.jsxs("dl",{className:"flex items-center justify-between gap-4 border-t border-gray-200 pt-2 dark:border-gray-700",children:[e.jsx("dt",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Total Restant"}),e.jsx("dd",{className:"text-lg font-bold text-gray-900 dark:text-white",children:c(s.amount_residual)})]})]}),e.jsxs("div",{className:"w-full",children:[(s.advance_payment_status==="not_paid"||s.advance_payment_status==="partial")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"input-item mb-5",children:[e.jsx("div",{className:"mb-2 inline-block",children:e.jsx(W,{htmlFor:"montant",value:"Montant à payer"})}),e.jsx(X,{id:"montant",placeholder:"1000",label:"Montant*",name:"montantAPayer",type:"number",value:p,max:s.amount_residual,min:s.first_payment_state?1e3:s.first_payment_amount,onChange:l=>{const a=l.target.value;a<=s.amount_residual&&_(a),!s.first_payment_state&&a<s.first_payment_amount?v(`Le montant entré doit être supérieur ou égal à la première tranche de ${c(s.first_payment_amount)}.`):v("")},required:!0,className:"invalid:border-red-500 invalid:text-red-600 focus:invalid:border-red-500 focus:invalid:ring-red-500"}),N&&e.jsx("p",{className:"text-red-600",children:N})]}),s&&e.jsx(e.Fragment,{children:s.state!=="sale"&&s.state!=="draft"?e.jsx("div",{className:"flex justify-center items-center mt-2",children:e.jsx("span",{className:"text-lg font-medium text-red-500 dark:text-white",children:"La précommande est annulée, vous ne pouvez pas passer à la caisse."})}):e.jsxs(M,{type:"submit",onClick:l=>C(l,p),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:y,children:[i&&e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",c(p),")"]})}),P&&s&&e.jsx(se,{handlePay:D,totalAmount:p,onClose:()=>o(!1),order:s,idOrder:s.id})]}),s.advance_payment_status==="paid"&&e.jsx("div",{className:"flex justify-center items-center mt-2",children:e.jsx("span",{className:"text-lg font-medium text-green-500 dark:text-white",children:"Votre paiement est déjà réglé"})})]})]})]})]})}),!s&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-center items-center ",children:[e.jsx(L,{className:"animate-spin"})," Précommande non trouvée"]})})]})})]})}export{ye as default};

var A=Object.defineProperty,k=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var w=(t,s,l)=>s in t?A(t,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[s]=l,f=(t,s)=>{for(var l in s||(s={}))S.call(s,l)&&w(t,l,s[l]);if(v)for(var l of v(s))T.call(s,l)&&w(t,l,s[l]);return t},b=(t,s)=>k(t,q(s));import{e as C,j as e,R as P,o as E,h as F,i as M,l as L,m as R,p as $,L as B,q as I}from"./index-D2o1u-UB.js";import{b as m,c as O,u as z}from"./vendor-DZBautpX.js";function U({className:t,filterToggle:s,updateUrlParams:l}){var h;const{filters:i,updateFilters:o}=m.useContext(C),[a,d]=m.useState([]);m.useEffect(()=>{(async()=>{try{const n=await E.getTags();d(Array.isArray(n)?n:[])}catch(n){console.error("Erreur lors de la récupération des tags",n),d([])}})()},[]);const x=c=>{const[n,p]=c,N=b(f({},i),{min:n,max:p,page:1});o(N),l(N)},j=c=>{const n=c.target.value,p=b(f({},i),{tag:n,page:1});o(p),l(p)};return e.jsxs("div",{className:`filter-widget w-full fixed lg:relative left-0 top-0 h-screen z-10 lg:h-auto overflow-y-scroll lg:overflow-y-auto bg-white px-[30px] pt-[40px] ${t||""} ${s?"block":"hidden lg:block"}`,children:[e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border mt-10",children:[e.jsx("div",{className:"subject-title mb-[20px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Filtrer par tags"})}),e.jsx("div",{className:"text-sm text-qgray",children:e.jsxs("select",{className:"w-full border border-qgray-border px-3 py-2 rounded",value:(h=i.tag)!=null?h:"All",onChange:j,children:[e.jsx("option",{value:"All",children:"Tous les tags"}),a.map(c=>e.jsx("option",{value:c.slug||c.name,children:c.name},c.id))]})})]}),e.jsxs("div",{className:"filter-subject-item pb-10 border-b border-qgray-border mt-10",children:[e.jsx("div",{className:"subject-title mb-[30px]",children:e.jsx("h1",{className:"text-black text-base font-500",children:"Échelle des prix"})}),e.jsx("div",{className:"price-range mb-5",children:e.jsx(P,{value:[i.min,i.max],onInput:x,min:1e3,max:5e6})}),e.jsxs("p",{className:"text-xs text-qblack font-400",children:["Prix (FCFA): ",i.min," - ",i.max]})]})]})}const D=({currentPage:t,totalPages:s,onPageChange:l})=>{const i=()=>{const a=[];for(let d=Math.max(2,t-2);d<=Math.min(s-1,t+2);d++)a.push(d);return t-2>2&&a.unshift("..."),t+2<s-1&&a.push("..."),a.unshift(1),s!==1&&a.push(s),a};return e.jsx("nav",{className:"flex justify-center items-center mt-8 px-4","aria-label":"Pagination",children:e.jsxs("ul",{className:"flex flex-wrap justify-center items-center space-x-1 md:space-x-2",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>l(Math.max(1,t-1)),disabled:t===1,className:"p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-qyellow disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Previous page",children:e.jsx(F,{className:"w-5 h-5"})})}),i().map((o,a)=>e.jsx("li",{children:typeof o=="number"?e.jsx("button",{onClick:()=>l(o),className:`hidden sm:block px-3 py-2 rounded ${t===o?"bg-bleu-logo text-white":"bg-gray-200 text-gray-700 hover:bg-qyellow"}`,"aria-current":t===o?"page":void 0,children:o}):e.jsx("span",{className:"hidden sm:block px-3 py-2",children:o})},a)),e.jsx("li",{className:"sm:hidden",children:e.jsxs("span",{className:"px-3 py-2 text-gray-700",children:[t," / ",s]})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>l(Math.min(s,t+1)),disabled:t===s,className:"p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-qyellow disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Next page",children:e.jsx(M,{className:"w-5 h-5"})})})]})})};function Q(){const{currentProductsPromo:t,totalProductsPromo:s,isLoadingProductPromo:l,fetchProdcutsPromo:i,updateFilters:o,filters:a,resetFilters:d}=m.useContext(C),x=O(),j=z();m.useEffect(()=>{d();const r=new URLSearchParams(x.search),u={page:Number(r.get("page"))||1,category:r.get("category")||"All",search:r.get("search")||"",min:Number(r.get("min"))||1e3,max:Number(r.get("max"))||5e6,limit:Number(r.get("limit"))||9,productType:r.get("productType")||"All",tag:r.get("tag")||"All"};o(u),window.scrollTo({top:0,left:0,behavior:"smooth"})},[x.search,x.pathname]),m.useEffect(()=>{i()},[i,a]);const h=m.useCallback(r=>{const u=new URLSearchParams(x.search);Object.entries(r).forEach(([y,g])=>{g==null||g===""||g==="All"?u.delete(y):u.set(y,String(g))}),j({search:u.toString()},{replace:!0})},[x.search,j]),c=r=>{h(b(f({},a),{page:r})),window.scrollTo({top:0,left:0,behavior:"smooth"})},n=r=>{h(b(f({},a),{category:r||"All",page:1})),window.scrollTo({top:0,left:0,behavior:"smooth"})},p=s>0?(a.page-1)*a.limit+1:0,N=Math.min(a.page*a.limit,s);return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"CCBM Shop | En Promo",description:"Découvrez les meilleures offres promotionnelles sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité à prix réduits.",keywords:"électroménager, promotions, offres spéciales, CCBM Shop, ccbme, appareils électroménagers à prix réduits"}),e.jsx(R,{children:e.jsx("div",{className:"products-page-wrapper w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsx($,{}),e.jsxs("div",{className:"w-full lg:flex lg:space-x-[30px]",children:[e.jsx("div",{className:"lg:w-[270px]",children:e.jsx(U,{updateUrlParams:h,handleCategoryChange:n})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"products-sorting w-full bg-white flex flex-col md:flex-row justify-between p-[30px] mb-[40px]",children:e.jsxs("p",{className:"font-400 text-[13px]",children:[e.jsx("span",{className:"text-qgray",children:"Affichage"})," ",s>0?`${p}–${N} sur ${s} résultats`:"0 résultat"]})}),l?e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(B,{className:"animate-spin"})," Chargement"]}):t.length===0?e.jsx("div",{className:"flex justify-center items-center",children:"Aucun produit en promotion trouvé"}):e.jsx("div",{className:"grid xl:grid-cols-3 grid-cols-2 gap-[30px]",children:t.map(r=>e.jsx(I,{datas:r},r.id))}),e.jsx(D,{currentPage:a.page,totalPages:Math.ceil(s/a.limit),onPageChange:c})]})]})]})})})]})}export{Q as default};

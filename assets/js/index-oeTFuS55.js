var fe=Object.defineProperty;var K=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var Q=(c,m,d)=>m in c?fe(c,m,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[m]=d,D=(c,m)=>{for(var d in m||(m={}))he.call(m,d)&&Q(c,d,m[d]);if(K)for(var d of K(m))je.call(m,d)&&Q(c,d,m[d]);return c};import{c as ye,u as Ne,B as u,j as e,l as _e,m as be,A as ge,n as Y,f as l,U as Z,D as we,T as ve,t as Ce,y as ee,F as Fe}from"./index-CX-qx_4j.js";import{m as Pe,c as ke,u as qe,b as n}from"./vendor-DZBautpX.js";import{g as Me,a as Ae}from"./creditCommandeService-D_JMYr5d.js";import{f as R}from"./date-format-qL-o8H-f.js";import{W as Le}from"./wave-orange-payment-service-Dni99ATk.js";import{M as Te}from"./mail-BhgrSE7J.js";import{T as se}from"./truck-kvfLCrDu.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=ye("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);function i(c,m=0){const d=Number(c);return Number.isFinite(d)?d:m}function Oe(){const{id:c}=Pe(),m=ke(),d=qe(),{user:a}=Ne();console.log(a);const[_,z]=n.useState(null),[s,te]=n.useState(null),[F,$]=n.useState(null),[y,ae]=n.useState(!0),[T,B]=n.useState(!1),[h,V]=n.useState(0),[I,b]=n.useState(""),[re,P]=n.useState(!1),O=t=>{if(!t)return"En cours";switch(String(t).toLowerCase()){case"pending":return"En cours de validation";case"validated":return"Validé";case"rejected":return"Rejeté";default:return"En cours"}},U=t=>{if(!t)return e.jsx(se,{className:"w-5 h-5 text-blue-500"});switch(String(t).toLowerCase()){case"pending":return e.jsx(ee,{className:"w-5 h-5 text-yellow-500"});case"validated":return e.jsx(Fe,{className:"w-5 h-5 text-green-500"});case"rejected":return e.jsx(ee,{className:"w-5 h-5 text-red-500"});default:return e.jsx(se,{className:"w-5 h-5 text-blue-500"})}},k=n.useCallback(async()=>{if(c)try{B(!0);const t=await Me(a&&a.id||null,c);if(console.log("data order",t),!t||!t.order)throw new Error("Réponse invalide");const r=a?D({id:a.id||a.partner_id,name:a.name||`${a.prenom||""} ${a.nom||""}`.trim()||a.email,email:a.email,phone:a.telephone||a.partner_phone,adresse:a.adresse,partner_city:a.partner_city,country_id:a.country_id,country_name:a.country_name,country_code:a.country_code,country_phone_code:a.country_phone_code},t.partner):null;z(r||t.partner||null),te(t.order);const x=a?D({name:a.employer_name||a.employer_partner_name,email:a.employer_partner_email,phone:a.employer_partner_phone,street:a.adresse_employeur||a.employer_partner_adresse,entreprise_code:a.institution_partner_id||a.employer_partner_id,institution_partner_id:a.institution_partner_id,employer_partner_id:a.employer_partner_id},t.employer):null;$(x||t.employer||null)}catch(t){console.error(t),u.error("Impossible de charger les détails de la commande")}finally{ae(!1),B(!1)}},[a,c]);n.useEffect(()=>{if(a&&!_){const t={id:a.id||a.partner_id,name:a.name||`${a.prenom||""} ${a.nom||""}`.trim()||a.email,email:a.email,phone:a.telephone||a.partner_phone,adresse:a.adresse,partner_city:a.partner_city,country_id:a.country_id,country_name:a.country_name,country_code:a.country_code,country_phone_code:a.country_phone_code};z(t)}if(a&&!F&&(a.employer_name||a.employer_partner_name)){const t={name:a.employer_name||a.employer_partner_name,email:a.employer_partner_email,phone:a.employer_partner_phone,street:a.adresse_employeur||a.employer_partner_adresse,entreprise_code:a.institution_partner_id||a.employer_partner_id,institution_partner_id:a.institution_partner_id,employer_partner_id:a.employer_partner_id};$(t)}},[a,_,F]),n.useEffect(()=>{k()},[k]);const g=n.useMemo(()=>Array.isArray(s&&s.payment_lines)?s.payment_lines:[],[s&&s.payment_lines]),N=n.useMemo(()=>g.length&&(g.find(t=>t.sequence===1)||g[0])||null,[g]),p=n.useMemo(()=>i(N&&N.amount||0,0),[N]),j=n.useMemo(()=>N?!N.state:!1,[N]),o=n.useMemo(()=>i(s&&s.amount_residual||0,0),[s&&s.amount_residual]),f=n.useMemo(()=>o<=0?0:Math.min(50,o),[o]),[H,W]=n.useState(!1),[w,ne]=n.useState(null),E=n.useMemo(()=>c?`/api/creditcommandes/proforma/${c}?create_if_missing=1`:null,[c]);n.useEffect(()=>{s&&(async()=>{if(c)try{W(!0);const r=await Ae(c);console.log(r),ne(r&&r.proforma||null)}catch(r){console.error(r),u.error("Impossible de charger la pro-forma.")}finally{W(!1)}})()},[c,s]),n.useEffect(()=>{!y&&s&&(V(j?p:f),b(""))},[y,s,j,p,f]);const le=()=>{if(!j&&h<50){u.warning("Le montant doit être supérieur à 50 F CFA");return}P(!0)},ie=t=>{t.preventDefault();const r=i(h,0);if(o<=0){u.info("Aucun montant restant à payer.");return}if(j){if(r<p){u.warning(`Le montant doit être au moins l'acompte requis (${l(p)}).`,{position:"top-center",autoClose:5e3});return}if(r>o){u.warning("Le montant à payer ne doit pas dépasser le montant restant à payer.",{position:"top-center",autoClose:5e3});return}}else{if(r<f){u.warning(`Le montant doit être ≥ ${l(f)}.`,{position:"top-center",autoClose:5e3});return}if(r>o){u.warning("Le montant à payer ne doit pas dépasser le montant restant à payer.",{position:"top-center",autoClose:5e3});return}}P(!0)},v=n.useCallback(async()=>{P(!1),await k(),u.success("Paiement confirmé, page mise à jour.")},[k]);n.useEffect(()=>{const t=r=>{if(r.key==="statusOrderPayment"){const x=(r.newValue||"").replace(/"/g,"");["succeeded","completed","paid","success"].includes(x)&&v()}};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[v]),n.useEffect(()=>{if(new URLSearchParams(m.search).get("payment")==="success"){const r=m.pathname;d(r,{replace:!0}),v()}},[m.search,m.pathname,d,v]);const q=String(s&&s.validation_rh_state||"").toLowerCase()==="validated"&&String(s&&s.validation_admin_state||"").toLowerCase()==="validated",M=o<=0,ce=y||!q||M||(j?i(h)<p||i(h)>o:i(h)<f||i(h)>o),me=n.useMemo(()=>i(s&&s.amount_untaxed||0,0),[s&&s.amount_untaxed]),de=n.useMemo(()=>i(s&&s.amount_tax||0,0),[s&&s.amount_tax]),C=n.useMemo(()=>i(s&&s.amount_total||0,0),[s&&s.amount_total]),S=n.useMemo(()=>C-o,[C,o]),X=n.useMemo(()=>!s||!Array.isArray(s.order_lines)?0:s.order_lines.filter(t=>{const r=(t.product_name||"").toLowerCase();return r.includes("réduction")||r.includes("reduction")}).reduce((t,r)=>t+i(r.price_total||0,0),0),[s&&s.order_lines]);n.useMemo(()=>i(s&&s.marge_amount||0,0),[s&&s.marge_amount]),n.useMemo(()=>i(s&&s.partner_marge_percent||0,0),[s&&s.partner_marge_percent]);const G=n.useMemo(()=>!s||!Array.isArray(s.order_lines)||s.credit_type!=="banque"&&s.credit_type!=="finance"?0:s.order_lines.filter(t=>{const r=(t.product_name||"").toLowerCase();return!r.includes("réduction")&&!r.includes("reduction")}).reduce((t,r)=>{const x=i(r.discount||0,0);if(x>0&&r.price_unit){const A=i(r.price_unit)*x/100*i(r.product_uom_qty||1);return t+A}return t},0),[s&&s.order_lines,s&&s.credit_type]),oe=n.useMemo(()=>(s&&s.credit_type)==="banque",[s&&s.credit_type]),xe=(t,r="application/pdf")=>{try{const x=atob(t),A=x.length,J=new Uint8Array(A);for(let L=0;L<A;L++)J[L]=x.charCodeAt(L);const pe=new Blob([J],{type:r});return URL.createObjectURL(pe)}catch(x){return null}},ue=()=>{if(w&&w.pdf_base64){const t=xe(w.pdf_base64,"application/pdf");if(!t){u.error("Erreur lors de la préparation du fichier PDF.");return}const r=document.createElement("a");r.href=t,r.download=w&&w.pdf_filename||`PROFORMA-${s&&s.name||c}.pdf`,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(t);return}E?window.open(E,"_blank"):u.error("Lien de téléchargement indisponible.")};return e.jsxs(e.Fragment,{children:[e.jsx(_e,{title:"CCBM Shop | Détails Commande à Crédit",description:"Détails et paiement d'une commande à crédit sur CCBM Shop.",keywords:"ccbm, commande à crédit, échéancier, paiement mobile"}),e.jsx(be,{childrenClasses:"pt-0 pb-0",children:e.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full mb-5",children:e.jsx(ge,{title:"Détails Commande à Crédit",breadcrumb:[{name:"Accueil",path:"/"},{name:"Commande à Crédits",path:"/profile#commandes-a-credit"},{name:"Détails Commande à crédit"}]})}),y&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Y,{className:"mr-2 h-5 w-5 animate-spin"}),e.jsx("span",{children:"Chargement..."})]}),s&&e.jsx("div",{className:"checkout-main-content w-full",children:e.jsx("div",{className:"container-x mx-auto",children:e.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["N°Commande à Crédit ",e.jsx("span",{children:s.name})]})})}),e.jsx("div",{className:"sm:w-1/3 flex-1 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:["Paiement :"," ",s.advance_payment_status==="not_paid"&&e.jsx("span",{className:"text-red-500",children:"Non Payé"}),s.advance_payment_status==="paid"&&e.jsx("span",{className:"text-green-500",children:" Payé "}),s.advance_payment_status==="partial"&&e.jsx("span",{className:"text-yellow-500",children:" Partiellement Payé"})]})})}),e.jsx("div",{className:"sm:w-1/3 flex-1 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Statut : "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsxs("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:[s.state==="sale"&&e.jsx("span",{className:"text-green-500",children:"Validé"}),s.state==="draft"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de traitement"}),s.state==="cancel"&&e.jsx("span",{className:"text-yellow-500",children:"Annulée"}),s.state==="delivered"&&e.jsx("span",{className:"text-green-600",children:"Livrée"}),s.state==="to_delivered"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de livraison"}),s.state==="validation"&&e.jsx("span",{className:"text-yellow-500",children:"En cours de validation"})]})})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Validation entreprise"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline-block",children:U(s.validation_rh_state)}),e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:O(s.validation_rh_state)})]})]})}),e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Approbation CCBM"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:[e.jsx("span",{className:"hidden sm:inline-block",children:U(s.validation_admin_state)}),e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:O(s.validation_admin_state)})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5",children:[e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Date commande "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:R(s.date_order)})})]})}),e.jsx("div",{className:"w-full sm:w-1/2 h-auto sm:h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:"Date de livraison"}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:R(s.commitment_date)})})]})})]}),s&&s.credit_type!=="banque"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Type crédit  "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:s.credit_type=="direct"?"Direct":"Financé"})})]})}),e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Total Payé  "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:l(S)})})]})}),e.jsx("div",{className:"flex-1 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Total Restant   "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:l(o)})})]})})]})}),s&&s.credit_type==="banque"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx("div",{className:"sm:w-1/2 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Type crédit  "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:s.credit_type=="direct"?"Direct":"Financé"})})]})}),e.jsx("div",{className:"sm:w-1/2 w-full mb-5 h-[70px]",children:e.jsxs("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0",children:[e.jsx("strong",{children:" Total à Payé  "}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2",children:e.jsx("span",{className:"mt-1 sm:mt-0 sm:ml-2 capitalize",children:l(S)})})]})})]})}),oe&&F&&e.jsxs("div",{className:"w-full mb-8 p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm bg-white",children:[e.jsx("div",{className:"flex items-center mb-4 border-b pb-2",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Informations de l'employeur"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(Z,{className:"w-5 h-5 text-gray-500 mr-3 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Nom de l'institution"}),e.jsx("div",{className:"text-gray-900",children:_.institution_name||"Non spécifié"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Email Institution"}),e.jsx("div",{className:"text-gray-900",children:F.email||"Non spécifié"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(Z,{className:"w-5 h-5 text-gray-500 mr-3 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Nom Employeur"}),e.jsx("div",{className:"text-gray-900",children:_.employer_name||"Non spécifié"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(Ee,{className:"w-5 h-5 text-gray-500 mr-3 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:"Adresse Employeur"}),e.jsx("div",{className:"text-gray-900",children:_.adresse_employeur||"Non spécifié"})]})]})]})})]}),e.jsx("h1",{className:"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center",children:"Récapitulatif de la commande"}),e.jsx("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-4",children:[e.jsx("p",{className:"text-sm font-medium text-qblack uppercase",children:"Produit"}),e.jsx("p",{className:"text-sm font-medium text-qblack uppercase",children:"Total"})]}),e.jsx("div",{className:"space-y-4",children:Array.isArray(s.order_lines)&&s.order_lines.filter(t=>{const r=(t.product_name||"").toLowerCase();return!r.includes("réduction")&&!r.includes("reduction")}).map(t=>{var r;return e.jsxs("div",{className:"border rounded-md p-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-sm sm:text-base text-qblack mb-1",children:[t.product_name,e.jsxs("sup",{className:"text-xs text-qgray ml-1",children:["x ",(r=t.product_uom_qty)!=null?r:0," ",t.product_uom_name||""]})]}),!!t.description&&e.jsx("p",{className:"text-xs sm:text-sm text-qgray",children:t.description})]}),e.jsx("span",{className:"text-sm sm:text-base text-qblack font-medium",children:l(t.price_total)})]}),e.jsxs("div",{className:`mt-2 grid gap-2 text-sm ${(s.credit_type==="banque"||s.credit_type==="finance")&&t.discount?"sm:grid-cols-5":"sm:grid-cols-4"}`,children:[e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-gray-500",children:"Prix unitaire"}),e.jsx("span",{className:"font-medium sm:block",children:l(t.price_unit)})]}),(s.credit_type==="banque"||s.credit_type==="finance")&&t.discount&&t.discount>0&&e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsxs("span",{className:"text-gray-500",children:["Remise (",t.discount,"%)"]}),e.jsxs("span",{className:"font-medium sm:block text-green-600",children:["-",l(i(t.price_unit)*i(t.discount)/100*i(t.product_uom_qty||1))]})]}),e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-gray-500",children:"Sous-total (HT)"}),e.jsx("span",{className:"font-medium sm:block",children:l(t.price_subtotal)})]}),e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-gray-500",children:"TVA"}),e.jsx("span",{className:"font-medium sm:block",children:t.price_tax==null?"—":l(t.price_tax)})]}),e.jsxs("div",{className:"flex justify-between sm:block",children:[e.jsx("span",{className:"text-gray-500",children:"Total (TTC)"}),e.jsx("span",{className:"font-semibold sm:block",children:l(t.price_total)})]})]})]},t.id)})}),s&&s.credit_type==="banque"&&e.jsx("div",{className:"w-full flex justify-center mb-4",children:e.jsx("button",{onClick:ue,className:"px-4 py-2 rounded bg-[#487a43] text-white disabled:opacity-60",disabled:H||!s,title:E||"",children:H?"Préparation du PDF...":"Télécharger la Pro-Forma"})}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Sous-total (hors TVA)"}),e.jsx("dd",{className:"text-sm text-gray-900 font-medium",children:l(me)})]}),(s.credit_type==="banque"||s.credit_type==="finance")&&G>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Remise globale"}),e.jsxs("dd",{className:"text-sm text-green-600 font-medium",children:["-",l(G)]})]}),X!==0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Réduction"}),e.jsx("dd",{className:"text-sm text-red-600 font-medium",children:l(X)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"TVA (18%)"}),e.jsx("dd",{className:"text-sm text-gray-900 font-medium",children:l(de)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Total TTC"}),e.jsx("dd",{className:"text-sm text-gray-900 font-medium",children:l(C)})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("dt",{className:"text-sm text-gray-500",children:["Mode crédit : ",i(s.creditorder_month_count,0)," paiement(s)"]}),e.jsxs("dd",{className:"text-sm text-gray-900 font-medium",children:["Total: ",l(C)]})]}),g.map((t,r)=>{var x;return e.jsxs("dl",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("dt",{className:"text-sm text-gray-500",children:[t.label||`Paiement ${r+1}`,t.due_date&&e.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:["(échéance: ",R(t.due_date),")"]})]}),e.jsxs("dd",{className:`text-sm sm:text-base font-medium ${t.state?"text-green-600":"text-gray-900"}`,children:[l(i(t.amount))," ",t.state?"✓":""]})]},(x=t.sequence)!=null?x:r)})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total à payer"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-gray-900",children:l(C)})]}),e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total Payé"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-green-600",children:l(S)})]}),s&&s.credit_type!=="banque"&&e.jsx(e.Fragment,{children:e.jsxs("dl",{className:"flex items-center justify-between gap-2",children:[e.jsx("dt",{className:"text-base sm:text-lg font-bold text-gray-900",children:"Total Restant"}),e.jsx("dd",{className:"text-base sm:text-lg font-bold text-gray-900",children:l(o)})]})})]}),q&&!M?e.jsx("div",{className:"mt-6",children:s&&s.credit_type!=="banque"&&e.jsxs(e.Fragment,{children:[e.jsx(we,{htmlFor:"montant",children:"Montant à payer"}),e.jsx(ve,{id:"montant",type:"number",value:h,disabled:!q||M,onChange:t=>{const r=Math.min(i(t.target.value,0),o);V(r),j?r<p?b(`Le montant doit être au moins l'acompte requis (${l(p)}).`):b(""):r<f?b(`Le montant doit être ≥ ${l(f)}.`):b("")},min:j?p:f,max:o,placeholder:j?`Acompte minimum: ${l(p)} (vous pouvez payer plus)`:`Minimum ${l(f)}`,className:"mt-1"}),I&&e.jsx("p",{className:"text-red-500 mt-1",children:I}),e.jsxs(Ce,{onClick:ie,className:"mt-4 w-full !bg-[#487a43] !text-white hover:!bg-[#3f6d3b]  disabled:!bg-[#487a43]/50 disabled:!text-white/70 disabled:cursor-not-allowed",disabled:ce||T,children:[(y||T)&&e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),T?"Mise à jour...":`Passer à la caisse (${l(i(h))})`]}),j?e.jsxs("p",{className:"mt-2 text-xs text-gray-500 text-center",children:["Acompte requis :"," ",e.jsx("strong",{children:l(i(p))})," minimum. Vous pouvez payer ",e.jsx("em",{children:"au moins"})," l'acompte (et plus si vous voulez), sans dépasser le restant."]}):e.jsxs("p",{className:"mt-2 text-xs text-gray-500 text-center",children:["Paiement libre : choisissez le montant que vous souhaitez (minimum"," ",e.jsx("strong",{children:l(f)}),"), jusqu'à"," ",e.jsx("strong",{children:l(o)})," restant."]})]})}):e.jsxs(e.Fragment,{children:[!q&&e.jsx("p",{className:"text-yellow-500 mt-4 text-center text-base sm:text-xl",children:"Merci d'attendre la validation de la commande à crédit par la RH et CCBM"}),M&&e.jsx("p",{className:"text-green-600 mt-4 text-center text-base sm:text-xl",children:"Votre paiement est déjà réglé"})]})]})}),re&&s&&e.jsx(Le,{handlePay:le,totalAmount:i(h),onClose:()=>P(!1),order:s,idOrder:s.id,onSuccess:v})]})})}),!y&&!s&&e.jsx("div",{className:"flex justify-center items-center py-10",children:"Commande à Crédit non trouvée"})]})})]})}export{Oe as default};

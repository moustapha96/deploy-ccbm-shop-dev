import{u as F,G as k,B as N,f as n,j as e,l as D,m as B,A as $,n as M,D as z,T as I,t as q}from"./index-CX-qx_4j.js";import{m as O,b as l}from"./vendor-DZBautpX.js";import{f as R}from"./date-format-qL-o8H-f.js";import{P as V}from"./paimentService-B2Rdaeza.js";import{W}from"./wave-orange-payment-service-Dni99ATk.js";function Y(){const{id:t}=O(),{user:i}=F(),[a,g]=l.useState(null),[w,p]=l.useState(!0),[P,x]=l.useState(!1),[f,d]=l.useState(0),[j,s]=l.useState(""),[S,o]=l.useState(!0),L=l.useCallback(async()=>{try{p(!0);const r=await k.getCommandeById(i.id,t);g(r)}catch(r){console.error("Erreur lors de la récupération des données de la commande",r),N.error("Erreur lors de la récupération des données de la commande")}finally{p(!1)}},[i.id,t]);l.useEffect(()=>{L()},[L]);const h=l.useMemo(()=>String(a&&a.type_sale||"").toLowerCase()==="order",[a&&a.type_sale]),C=l.useMemo(()=>Array.isArray(a&&a.payment_lines)?a.payment_lines:null,[a]),v=l.useMemo(()=>C&&(C.find(r=>r.sequence===1)||C[0])||null,[C]),b=l.useMemo(()=>v?!v.state:!1,[v]),m=l.useMemo(()=>{const r=Number(a&&a.amount_residual||0);return h?r>0?50:0:(a&&a.payment_mode)==="echelonne"?b&&v?Math.max(0,Number(v.amount)||0):r<=0?0:Math.min(Math.max(1e3,0),r):1e3},[a&&a.amount_residual,a&&a.payment_mode,h,b,v]);l.useEffect(()=>{if(a){if(h){d(m),s("");return}a.payment_mode==="echelonne"?(d(m),s("")):a.payment_mode==="online"?(d(Number(a.amount_total||0)),s("")):(d(0),s(""))}},[a,m,h]);const A=(r,u)=>{r.preventDefault();const y=Number(a&&a.amount_residual||0),_=Number(u||0);if(h){if(y<=0){N.info("Aucun montant restant à payer.");return}if(_<=0){s("Le montant doit être > 0.");return}if(_>y){s("Le montant ne doit pas dépasser le montant restant à payer.");return}s(""),x(!0);return}if(a.payment_mode==="echelonne"){if(y<=0){N.info("Aucun montant restant à payer.");return}if(b){if(_!==Number(m)){s(`Le montant doit être exactement l'acompte requis (${n(m)}).`);return}}else if(_<Number(m)){s(`Le montant doit être ≥ ${n(m)}.`);return}if(_>y){s("Le montant à payer ne doit pas dépasser le montant restant à payer");return}s(""),x(!0);return}if(a.payment_mode==="online"){if(_<1e3){s("Le montant minimum est de 1000 FCFA");return}if(_!==Number(a.amount_total||0)){s("Le montant à payer doit correspondre au total de la commande");return}s(""),x(!0);return}if(a.payment_mode==="domicile"){N.info("Le paiement se fera à domicile.");return}},E=async r=>{p(!0);try{await V.createCommandePaiment(a.id),N.success("Paiement validé avec succès"),window.location.reload()}catch(u){console.error("Erreur lors de la création du paiement :",u),N.error("Erreur lors de la création du paiement")}finally{p(!1)}};return l.useEffect(()=>{if(!a)return;const r=Number(a&&a.amount_residual||0),u=Number(f||0);if(h){if(r<=0){o(!0);return}if(u<=0){s("Le montant doit être > 0."),o(!0);return}if(u>r){s("Le montant ne doit pas dépasser le montant restant à payer."),o(!0);return}s(""),o(!1);return}if(a.payment_mode==="echelonne"){if(r<=0){o(!0);return}if(b){const y=u===Number(m);o(!y),s(y?"":`Le montant doit être exactement l'acompte requis (${n(m)}).`);return}else{if(u<Number(m)){s(`Le montant doit être ≥ ${n(m)}.`),o(!0);return}if(u>r){s("Le montant à payer ne doit pas dépasser le montant restant à payer"),o(!0);return}s(""),o(!1);return}}if(a.payment_mode==="online"){u<1e3?(s("Le montant minimum est de 1000 FCFA"),o(!0)):u!==Number(a.amount_total||0)?(s("Le montant à payer doit correspondre au total de la commande"),o(!0)):(s(""),o(!1));return}o(!0)},[a,f,b,m,h]),e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"CCBM Shop | Détails commande",description:"Consultez les détails de votre commande sur CCBM Shop, votre destination pour l'électroménager de qualité.",keywords:"détails commande, CCBM Shop, ccbme, suivi commande, paiement électroménager"}),e.jsx(B,{childrenClasses:"pt-0 pb-0",children:e.jsxs("div",{className:"checkout-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full mb-5",children:e.jsx($,{title:"Détails Commande",breadcrumb:[{name:"Accueil",path:"/"},{name:"Commandes",path:"/profile#order"},{name:"Détails Commande"}]})}),w?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-center items-center h-screen",children:[e.jsx(M,{className:"animate-spin mr-2",size:48}),e.jsx("span",{className:"text-lg",children:"Chargement de la commande..."})]})}):e.jsx("div",{className:"checkout-main-content w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsx(G,{commande:a}),e.jsx(H,{commande:a}),e.jsx(T,{commande:a,montantAPayer:f,setMontantAPayer:d,errorMontantAPayer:j,stateButton:S,isLoading:w,validerPaiment:A,minAmountToPay:m,acompteDue:b,isTypeOrder:h}),P&&a&&e.jsx(W,{handlePay:E,totalAmount:f,onClose:()=>x(!1),order:a,idOrder:a.id})]})})]})})]})}const G=({commande:t})=>e.jsxs("div",{className:"w-full sm:mb-10 mb-5",children:[e.jsxs("div",{className:"sm:flex sm:space-x-[18px]",children:[e.jsx(c,{label:"N°Commande",value:t.name}),t.payment_mode==="domicile"&&e.jsx(c,{label:"Paiement",value:t.advance_payment_status==="not_paid"?"A domicile":"Non Payé",className:t.advance_payment_status==="not_paid"?"text-red-500":"text-green-500"}),t.payment_mode==="online"&&e.jsx(c,{label:"Paiement",value:t.advance_payment_status==="not_paid"?"Non Payé":"Payé",className:t.advance_payment_status==="not_paid"?"text-red-500":"text-green-500"}),t.payment_mode==="echelonne"&&e.jsx(c,{label:"Paiement",value:t.advance_payment_status==="not_paid"?"Non Payé":t.advance_payment_status==="paid"?"Payé":"Partiellement Payé",className:t.advance_payment_status==="not_paid"?"text-red-500":t.advance_payment_status==="paid"?"text-green-500":t.advance_payment_status==="partial"?"text-yellow-500":""}),e.jsx(c,{label:"Statut",value:t.state==="sale"?"Validée":t.state==="to_delivered"?"En cours de livraison":t.state==="delivered"?"Livrée":"Non validé",className:t.state==="sale"?"text-green-500":t.state==="to_delivered"?"text-yellow-500":t.state==="delivered"?"text-green-600":"text-gray-500"})]}),t.payment_mode==="echelonne"&&e.jsxs("div",{className:"sm:flex sm:space-x-[18px] mt-5",children:[e.jsx(c,{label:"Montant Restant",value:`${n(t.amount_residual)}`}),e.jsx(c,{label:"Montant Total",value:["not_paid","paid"].includes(t.advance_payment_status)?e.jsx("span",{className:`text-${t.advance_payment_status==="not_paid"?"red":"green"}-500`,children:n(t.amount_total)}):e.jsxs(e.Fragment,{children:[" ",n(t.amount_total)]})}),e.jsx(c,{label:"Montant Avancé",value:n(t.amount_total-t.amount_residual)})]}),e.jsxs("div",{className:"sm:flex sm:space-x-[18px] mt-5",children:[e.jsx(c,{label:"Mode de Paiement",value:t.payment_mode==="online"?"En ligne":t.payment_mode==="domicile"?"A domicile":"Echelonné"}),e.jsx(c,{label:"Date de livraison",value:R(t.commitment_date)})]})]}),H=({commande:t})=>e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"sm:text-2xl text-xl text-qblack font-medium mb-5",children:"Récapitulatif de la commande"}),e.jsxs("div",{className:"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm",children:[e.jsx("div",{className:"sub-total mb-6",children:e.jsxs("div",{className:"flex justify-between mb-5",children:[e.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Produit"}),t.type_order==="commande"&&e.jsx("p",{className:"text-[13px] font-medium text-qblack uppercase",children:"Total"})]})}),e.jsx("div",{className:"product-list w-full mb-[30px]",children:e.jsx("ul",{className:"flex flex-col space-y-5",children:t.order_lines.map((i,a)=>e.jsx("li",{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-[15px] text-qblack mb-2.5",children:[i.product_name,e.jsx("sup",{className:"text-[13px] text-qgray ml-2 mt-2",children:t.type_order==="commande"&&e.jsxs("span",{children:[" = ",i.product_uom_qty," x ",n(i.price_total)]})})]}),e.jsx("p",{className:"text-[13px] text-qgray",children:i.description})]}),e.jsx("div",{children:t.type_order==="commande"&&e.jsx("span",{className:"text-[15px] text-qblack font-medium",children:n(i.price_total)})})]})},a))})}),e.jsx("div",{className:"mt-[30px]",children:e.jsxs("div",{className:"flex justify-between mb-5",children:[e.jsx("p",{className:"text-2xl font-medium text-qblack",children:"Total"}),e.jsx("p",{className:"text-2xl font-medium",children:["not_paid","paid"].includes(t.advance_payment_status)&&e.jsx("span",{className:`text-${t.advance_payment_status==="not_paid"?"red":"green"}-500`,children:n(t.amount_total)})})]})})]})]}),T=({commande:t,montantAPayer:i,setMontantAPayer:a,errorMontantAPayer:g,stateButton:w,isLoading:p,validerPaiment:P,minAmountToPay:x,acompteDue:f,isTypeOrder:d})=>e.jsx("div",{className:"w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8",children:t.advance_payment_status==="not_paid"||t.advance_payment_status==="partial"?e.jsxs(e.Fragment,{children:[t.payment_mode==="domicile"&&e.jsx("div",{className:"flex justify-center items-center mt-2",children:e.jsx("span",{className:"text-lg font-medium text-red-500 dark:text-white",children:"Le paiement se fera à domicile"})}),(t.payment_mode==="echelonne"||d)&&e.jsxs("div",{children:[e.jsxs("div",{className:"input-item mb-5",children:[e.jsx("div",{className:"mb-2 inline-block",children:e.jsx(z,{htmlFor:"montant",value:"Montant à payer"})}),e.jsx(I,{id:"montant",placeholder:d?"Montant libre (> 0)":f?`Acompte requis: ${n(x)}`:"Minimum 1000 F CFA",label:"Montant*",name:"montantAPayer",type:"number",value:i,onChange:j=>a(j.target.value),max:t.amount_residual,min:d?1:f?Number(x):0,required:!0,className:"invalid:border-red-500 invalid:text-red-600 focus:invalid:border-red-500 focus:invalid:ring-red-500"}),g&&e.jsx("p",{className:"text-yellow-500",children:g})]}),e.jsxs(q,{type:"submit",onClick:j=>P(j,i),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:w,children:[p&&e.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",n(i),")"]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 text-center",children:d?e.jsxs(e.Fragment,{children:["Paiement libre : choisissez le montant que vous souhaitez (strictement > 0), jusqu’à ",e.jsx("strong",{children:n(t.amount_residual)})," restant."]}):f?e.jsxs(e.Fragment,{children:["Acompte requis : ",e.jsx("strong",{children:n(x)}),". Vous devrez solder l’acompte avant de pouvoir payer librement."]}):e.jsxs(e.Fragment,{children:["Paiement libre : choisissez le montant que vous souhaitez (minimum ",e.jsx("strong",{children:n(Math.max(1e3,Number(x)||0))}),"), jusqu’à ",e.jsx("strong",{children:n(t.amount_residual)})," restant."]})})]}),t.payment_mode==="online"&&!d&&e.jsxs(q,{type:"submit",onClick:j=>P(j,t.amount_total),className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",disabled:p,children:[p&&e.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}),"Passer à la caisse (",n(t.amount_total),")"]})]}):e.jsx("div",{className:"w-full h-[50px] flex justify-center items-center",children:e.jsx("span",{className:"text-green-500",children:"Le paiement a été effectué avec succès"})})}),c=({label:t,value:i,className:a=""})=>e.jsx("div",{className:"sm:w-1/3 w-full mb-5 h-[70px]",children:e.jsx("div",{className:"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center",children:e.jsxs("span",{className:"text-[15px] font-medium",children:[t,"  : ",e.jsx("span",{className:a,children:i})]})})});export{Y as default};

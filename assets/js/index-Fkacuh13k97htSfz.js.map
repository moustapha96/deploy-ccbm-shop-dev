{"version":3,"file":"index-Fkacuh13k97htSfz.js","sources":["../../../orbit-city-final-dev/src/components/CreditOrder/index.jsx"],"sourcesContent":["/* eslint-disable no-extra-boolean-cast */\r\n/* eslint-disable no-unused-vars */\r\n/* eslint-disable react/no-unescaped-entities */\r\n\"use client\";\r\nimport { useEffect, useMemo, useState, useCallback } from \"react\";\r\nimport { useParams, useLocation, useNavigate } from \"react-router-dom\";\r\nimport { toast } from \"react-toastify\";\r\nimport { useAuthContext } from \"../../contexts/useAuthContext\";\r\nimport { getCreditCommandeById } from \"../../services/creditCommandeService\";\r\nimport formatDate from \"../../utils/date-format\";\r\nimport formatPrice from \"../../utils/formatPrice\";\r\nimport SEOHeader from \"../Partials/Headers/HeaderOne/SEOHeader\";\r\nimport Layout from \"../Partials/Layout\";\r\nimport PageTitle from \"../Helpers/PageTitle\";\r\nimport { CheckCircle, Loader2, Truck, XCircle, Building2, User, Phone, Mail, MapPin, Pin } from \"lucide-react\";\r\nimport { Button, Label, TextInput } from \"flowbite-react\";\r\nimport WaveOrangePaymentService from \"../../services/Payment/wave-orange-payment-service\";\r\nimport { getProformaCommande } from \"../../services/creditCommandeService\";\r\nfunction safeNumber(n, fallback = 0) {\r\n  const v = Number(n);\r\n  return Number.isFinite(v) ? v : fallback;\r\n}\r\n\r\nexport default function CreditOrderPage() {\r\n  const { id } = useParams();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuthContext();\r\n  console.log(user)\r\n  // Données backend\r\n  const [partner, setPartner] = useState(null);\r\n  const [order, setOrder] = useState(null);\r\n  const [employer, setEmployer] = useState(null);\r\n\r\n  // UI states\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [montantAPayer, setMontantAPayer] = useState(0);\r\n  const [errorMontantAPayer, setErrorMontantAPayer] = useState(\"\");\r\n  const [showPaymentModal, setShowPaymentModal] = useState(false);\r\n\r\n  // ===== Helpers validation display =====\r\n  const getStatusTextValidation = (status) => {\r\n    if (!status) return \"En cours\";\r\n    switch (String(status).toLowerCase()) {\r\n      case \"pending\":\r\n        return \"En cours de validation\";\r\n      case \"validated\":\r\n        return \"Validé\";\r\n      case \"rejected\":\r\n        return \"Rejeté\";\r\n      default:\r\n        return \"En cours\";\r\n    }\r\n  };\r\n\r\n  const getStatusIconValidation = (status) => {\r\n    if (!status) return <Truck className=\"w-5 h-5 text-blue-500\" />;\r\n    switch (String(status).toLowerCase()) {\r\n      case \"pending\":\r\n        return <XCircle className=\"w-5 h-5 text-yellow-500\" />;\r\n      case \"validated\":\r\n        return <CheckCircle className=\"w-5 h-5 text-green-500\" />;\r\n      case \"rejected\":\r\n        return <XCircle className=\"w-5 h-5 text-red-500\" />;\r\n      default:\r\n        return <Truck className=\"w-5 h-5 text-blue-500\" />;\r\n    }\r\n  };\r\n\r\n  // ===== Fetch order (réutilisable) =====\r\n  const fetchOrder = useCallback(async () => {\r\n    if (!id) return;\r\n    try {\r\n      setIsRefreshing(true);\r\n      const data = await getCreditCommandeById((user && user.id) || null, id);\r\n      console.log(\"data order\", data)\r\n      if (!data || !data.order) {\r\n        throw new Error(\"Réponse invalide\");\r\n      }\r\n      \r\n      // Utiliser les données de l'utilisateur connecté comme valeurs par défaut pour partner\r\n      const defaultPartner = user ? {\r\n        id: user.id || user.partner_id,\r\n        name: user.name || `${user.prenom || ''} ${user.nom || ''}`.trim() || user.email,\r\n        email: user.email,\r\n        phone: user.telephone || user.partner_phone,\r\n        adresse: user.adresse,\r\n        partner_city: user.partner_city,\r\n        country_id: user.country_id,\r\n        country_name: user.country_name,\r\n        country_code: user.country_code,\r\n        country_phone_code: user.country_phone_code,\r\n        ...data.partner\r\n      } : null;\r\n      \r\n      setPartner(defaultPartner || data.partner || null);\r\n      setOrder(data.order);\r\n      \r\n      // Utiliser les données de l'utilisateur connecté comme valeurs par défaut pour employer\r\n      const defaultEmployer = user ? {\r\n        name: user.employer_name || user.employer_partner_name,\r\n        email: user.employer_partner_email,\r\n        phone: user.employer_partner_phone,\r\n        street: user.adresse_employeur || user.employer_partner_adresse,\r\n        entreprise_code: user.institution_partner_id || user.employer_partner_id,\r\n        institution_partner_id: user.institution_partner_id,\r\n        employer_partner_id: user.employer_partner_id,\r\n        ...data.employer\r\n      } : null;\r\n      \r\n      setEmployer(defaultEmployer || data.employer || null);\r\n    } catch (error) {\r\n      console.error(error);\r\n      toast.error(\"Impossible de charger les détails de la commande\");\r\n    } finally {\r\n      setIsLoading(false);\r\n      setIsRefreshing(false);\r\n    }\r\n  }, [user, id]);\r\n\r\n  // Initialiser les données par défaut avec l'utilisateur connecté\r\n  useEffect(() => {\r\n    if (user && !partner) {\r\n      const defaultPartner = {\r\n        id: user.id || user.partner_id,\r\n        name: user.name || `${user.prenom || ''} ${user.nom || ''}`.trim() || user.email,\r\n        email: user.email,\r\n        phone: user.telephone || user.partner_phone,\r\n        adresse: user.adresse,\r\n        partner_city: user.partner_city,\r\n        country_id: user.country_id,\r\n        country_name: user.country_name,\r\n        country_code: user.country_code,\r\n        country_phone_code: user.country_phone_code,\r\n      };\r\n      setPartner(defaultPartner);\r\n    }\r\n    \r\n    if (user && !employer && (user.employer_name || user.employer_partner_name)) {\r\n      const defaultEmployer = {\r\n        name: user.employer_name || user.employer_partner_name,\r\n        email: user.employer_partner_email,\r\n        phone: user.employer_partner_phone,\r\n        street: user.adresse_employeur || user.employer_partner_adresse,\r\n        entreprise_code: user.institution_partner_id || user.employer_partner_id,\r\n        institution_partner_id: user.institution_partner_id,\r\n        employer_partner_id: user.employer_partner_id,\r\n      };\r\n      setEmployer(defaultEmployer);\r\n    }\r\n  }, [user, partner, employer]);\r\n\r\n  useEffect(() => {\r\n    fetchOrder();\r\n  }, [fetchOrder]);\r\n\r\n  // ===== Détermination acompte & min à payer =====\r\n  const paymentLines = useMemo(\r\n    () => (Array.isArray(order && order.payment_lines) ? order.payment_lines : []),\r\n    [order && order.payment_lines]\r\n  );\r\n\r\n  const acompteLine = useMemo(() => {\r\n    if (!paymentLines.length) return null;\r\n    return paymentLines.find((pl) => pl.sequence === 1) || paymentLines[0] || null;\r\n  }, [paymentLines]);\r\n\r\n  const acompteAmount = useMemo(() => safeNumber((acompteLine && acompteLine.amount) || 0, 0), [acompteLine]);\r\n  const acompteDue = useMemo(() => {\r\n    if (!acompteLine) return false;\r\n    return !Boolean(acompteLine.state);\r\n  }, [acompteLine]);\r\n\r\n  const residual = useMemo(() => safeNumber((order && order.amount_residual) || 0, 0), [order && order.amount_residual]);\r\n  const minAmountToPay = useMemo(() => {\r\n    if (residual <= 0) return 0;\r\n    return Math.min(50, residual);\r\n  }, [residual]);\r\n\r\n  const [isLoadingProforma, setIsLoadingProforma] = useState(false);\r\n  const [proforma, setProforma] = useState(null); // objet retourné par l’API (/info)\r\n  const proformaUrl = useMemo(\r\n    () => (id ? `/api/creditcommandes/proforma/${id}?create_if_missing=1` : null),\r\n    [id]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const loadProforma = async () => {\r\n      if (!id) return;\r\n      try {\r\n        setIsLoadingProforma(true);\r\n        const data = await getProformaCommande(id);\r\n        console.log(data)\r\n        setProforma((data && data.proforma) || null);\r\n      } catch (err) {\r\n        console.error(err);\r\n        toast.error(\"Impossible de charger la pro-forma.\");\r\n      } finally {\r\n        setIsLoadingProforma(false);\r\n      }\r\n    };\r\n    if (order) loadProforma();\r\n  }, [id, order]);\r\n\r\n\r\n  // Pré-remplir le champ au chargement\r\n  useEffect(() => {\r\n    if (!isLoading && order) {\r\n      setMontantAPayer(acompteDue ? acompteAmount : minAmountToPay);\r\n      setErrorMontantAPayer(\"\");\r\n    }\r\n  }, [isLoading, order, acompteDue, acompteAmount, minAmountToPay]);\r\n\r\n  // ===== Actions paiement =====\r\n  const handlePay = () => {\r\n    if (!acompteDue && montantAPayer < 50) {\r\n      toast.warning(\"Le montant doit être supérieur à 50 F CFA\");\r\n      return;\r\n    }\r\n    setShowPaymentModal(true);\r\n  };\r\n\r\n  const validerPaimentMontant = (e) => {\r\n    e.preventDefault();\r\n    const value = safeNumber(montantAPayer, 0);\r\n    if (residual <= 0) {\r\n      toast.info(\"Aucun montant restant à payer.\");\r\n      return;\r\n    }\r\n    console\r\n    if (acompteDue) {\r\n      if (value < acompteAmount) {\r\n        toast.warning(\r\n          `Le montant doit être au moins l'acompte requis (${formatPrice(acompteAmount)}).`,\r\n          { position: \"top-center\", autoClose: 5000 }\r\n        );\r\n        return;\r\n      }\r\n      if (value > residual) {\r\n        toast.warning(\r\n          \"Le montant à payer ne doit pas dépasser le montant restant à payer.\",\r\n          { position: \"top-center\", autoClose: 5000 }\r\n        );\r\n        return;\r\n      }\r\n    } else {\r\n      if (value < minAmountToPay) {\r\n        toast.warning(`Le montant doit être ≥ ${formatPrice(minAmountToPay)}.`, {\r\n          position: \"top-center\",\r\n          autoClose: 5000,\r\n        });\r\n        return;\r\n      }\r\n      if (value > residual) {\r\n        toast.warning(\r\n          \"Le montant à payer ne doit pas dépasser le montant restant à payer.\",\r\n          { position: \"top-center\", autoClose: 5000 }\r\n        );\r\n        return;\r\n      }\r\n    }\r\n    setShowPaymentModal(true);\r\n  };\r\n\r\n  // ===== Callback succès paiement -> refetch + toast =====\r\n  const handlePaymentSuccess = useCallback(async () => {\r\n    setShowPaymentModal(false);\r\n    await fetchOrder();\r\n    toast.success(\"Paiement confirmé, page mise à jour.\");\r\n  }, [fetchOrder]);\r\n\r\n\r\n  // ===== Ecoute localStorage (autres onglets/fenêtres) =====\r\n  useEffect(() => {\r\n    const onStorage = (e) => {\r\n      if (e.key === \"statusOrderPayment\") {\r\n        const v = (e.newValue || \"\").replace(/\"/g, \"\");\r\n        if ([\"succeeded\", \"completed\", \"paid\", \"success\"].includes(v)) {\r\n          handlePaymentSuccess();\r\n        }\r\n      }\r\n    };\r\n    window.addEventListener(\"storage\", onStorage);\r\n    return () => window.removeEventListener(\"storage\", onStorage);\r\n  }, [handlePaymentSuccess]);\r\n\r\n\r\n  // ===== Retour par query string ?payment=success =====\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(location.search);\r\n    if (params.get(\"payment\") === \"success\") {\r\n      const cleanPath = location.pathname;\r\n      navigate(cleanPath, { replace: true });\r\n      handlePaymentSuccess();\r\n    }\r\n  }, [location.search, location.pathname, navigate, handlePaymentSuccess]);\r\n\r\n\r\n  // ===== États bouton / messages =====\r\n  const isFullyValidated =\r\n    String((order && order.validation_rh_state) || \"\").toLowerCase() === \"validated\" &&\r\n    String((order && order.validation_admin_state) || \"\").toLowerCase() === \"validated\";\r\n  const nothingToPay = residual <= 0;\r\n  const isPayButtonDisabled =\r\n    isLoading ||\r\n    !isFullyValidated ||\r\n    nothingToPay ||\r\n    (acompteDue\r\n      ? safeNumber(montantAPayer) < acompteAmount || safeNumber(montantAPayer) > residual\r\n      : safeNumber(montantAPayer) < minAmountToPay || safeNumber(montantAPayer) > residual);\r\n\r\n  // ===== Calcul des montants détaillés =====\r\n  const sousTotalHT = useMemo(() => safeNumber((order && order.amount_untaxed) || 0, 0), [order && order.amount_untaxed]);\r\n  const tva = useMemo(() => safeNumber((order && order.amount_tax) || 0, 0), [order && order.amount_tax]);\r\n  const totalTTC = useMemo(() => safeNumber((order && order.amount_total) || 0, 0), [order && order.amount_total]);\r\n  const totalPaye = useMemo(() => totalTTC - residual, [totalTTC, residual]);\r\n\r\n  // Calcul du total des réductions\r\n  const totalReduction = useMemo(() => {\r\n    if (!order || !Array.isArray(order.order_lines)) return 0;\r\n    return order.order_lines\r\n      .filter((line) => {\r\n        const productName = (line.product_name || \"\").toLowerCase();\r\n        return productName.includes(\"réduction\") || productName.includes(\"reduction\");\r\n      })\r\n      .reduce((sum, line) => sum + safeNumber(line.price_total || 0, 0), 0);\r\n  }, [order && order.order_lines]);\r\n\r\n  // Calcul de la marge partenaire\r\n  const margeAmount = useMemo(() => safeNumber((order && order.marge_amount) || 0, 0), [order && order.marge_amount]);\r\n  const partnerMargePercent = useMemo(() => safeNumber((order && order.partner_marge_percent) || 0, 0), [order && order.partner_marge_percent]);\r\n\r\n  // Calcul du total des discounts pour crédit banque ou finance\r\n  const totalDiscount = useMemo(() => {\r\n    if (!order || !Array.isArray(order.order_lines)) return 0;\r\n    if (order.credit_type !== 'banque' && order.credit_type !== 'finance') return 0;\r\n    return order.order_lines\r\n      .filter((line) => {\r\n        const productName = (line.product_name || \"\").toLowerCase();\r\n        return !productName.includes(\"réduction\") && !productName.includes(\"reduction\");\r\n      })\r\n      .reduce((sum, line) => {\r\n        const discount = safeNumber(line.discount || 0, 0);\r\n        if (discount > 0 && line.price_unit) {\r\n          const discountAmount = (safeNumber(line.price_unit) * discount / 100) * safeNumber(line.product_uom_qty || 1);\r\n          return sum + discountAmount;\r\n        }\r\n        return sum;\r\n      }, 0);\r\n  }, [order && order.order_lines, order && order.credit_type]);\r\n\r\n  // Vérification si c'est un crédit bancaire\r\n  const isBankCredit = useMemo(() => (order && order.credit_type) === 'banque', [order && order.credit_type]);\r\n\r\n\r\n  const base64ToBlobUrl = (b64, mime = \"application/pdf\") => {\r\n    try {\r\n      const bin = atob(b64);\r\n      const len = bin.length;\r\n      const bytes = new Uint8Array(len);\r\n      for (let i = 0; i < len; i++) bytes[i] = bin.charCodeAt(i);\r\n      const blob = new Blob([bytes], { type: mime });\r\n      return URL.createObjectURL(blob);\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n\r\n\r\n  const downloadProforma = () => {\r\n    // 1) Si on a reçu le PDF en base64 via /info?format=base64\r\n    if (proforma && proforma.pdf_base64) {\r\n      const url = base64ToBlobUrl(proforma.pdf_base64, \"application/pdf\");\r\n      if (!url) {\r\n        toast.error(\"Erreur lors de la préparation du fichier PDF.\");\r\n        return;\r\n      }\r\n      const a = document.createElement(\"a\");\r\n      a.href = url;\r\n      a.download = (proforma && proforma.pdf_filename) || `PROFORMA-${(order && order.name) || id}.pdf`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      a.remove();\r\n      URL.revokeObjectURL(url);\r\n      return;\r\n    }\r\n    // 2) Sinon, fallback vers le téléchargement serveur (endpoint binaire)\r\n    if (proformaUrl) {\r\n      window.open(proformaUrl, \"_blank\");\r\n    } else {\r\n      toast.error(\"Lien de téléchargement indisponible.\");\r\n    }\r\n  };\r\n\r\n\r\n\r\n  return (\r\n    <>\r\n      <SEOHeader\r\n        title=\"CCBM Shop | Détails Commande à Crédit\"\r\n        description=\"Détails et paiement d'une commande à crédit sur CCBM Shop.\"\r\n        keywords=\"ccbm, commande à crédit, échéancier, paiement mobile\"\r\n      />\r\n      <Layout childrenClasses=\"pt-0 pb-0\">\r\n        <div className=\"checkout-page-wrapper w-full bg-white pb-[60px]\">\r\n          <div className=\"w-full mb-5\">\r\n            <PageTitle\r\n              title=\"Détails Commande à Crédit\"\r\n              breadcrumb={[\r\n                { name: \"Accueil\", path: \"/\" },\r\n                { name: \"Commande à Crédits\", path: \"/profile#commandes-a-credit\" },\r\n                { name: \"Détails Commande à crédit\" },\r\n              ]}\r\n            />\r\n          </div>\r\n\r\n          {isLoading && (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\r\n              <span>Chargement...</span>\r\n            </div>\r\n          )}\r\n\r\n          {order && (\r\n            <div className=\"checkout-main-content w-full\">\r\n              <div className=\"container-x mx-auto\">\r\n                {/* Bandeau états */}\r\n                <div className=\"w-full sm:mb-10 mb-5\">\r\n                  <div className=\"sm:flex sm:space-x-[18px]\">\r\n                    <div className=\"sm:w-1/3 w-full mb-5 h-[70px]\">\r\n                      <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center\">\r\n                        <span className=\"text-[15px] font-medium\">\r\n                          N°Commande à Crédit <span>{order.name}</span>\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"sm:w-1/3 flex-1 h-[70px]\">\r\n                      <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex justify-center items-center\">\r\n                        <span className=\"text-[15px] font-medium\">\r\n                          Paiement :{\" \"}\r\n                          {order.advance_payment_status === \"not_paid\" && (\r\n                            <span className=\"text-red-500\">Non Payé</span>\r\n                          )}\r\n                          {order.advance_payment_status === \"paid\" && (\r\n                            <span className=\"text-green-500\"> Payé </span>\r\n                          )}\r\n                          {order.advance_payment_status === \"partial\" && (\r\n                            <span className=\"text-yellow-500\"> Partiellement Payé</span>\r\n                          )}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"sm:w-1/3 flex-1 h-[70px]\">\r\n                      <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0\">\r\n                        <strong> Statut : </strong>\r\n                        <div className=\"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2\">\r\n                          <span className=\"mt-1 sm:mt-0 sm:ml-2 capitalize\">\r\n                            {order.state === \"sale\" && (\r\n                              <span className=\"text-green-500\">Validé</span>\r\n                            )}\r\n                            {order.state === \"draft\" && (\r\n                              <span className=\"text-yellow-500\">En cours de traitement</span>\r\n                            )}\r\n                            {order.state === \"cancel\" && (\r\n                              <span className=\"text-yellow-500\">Annulée</span>\r\n                            )}\r\n                            {order.state === \"delivered\" && (\r\n                              <span className=\"text-green-600\">Livrée</span>\r\n                            )}\r\n                            {order.state === \"to_delivered\" && (\r\n                              <span className=\"text-yellow-500\">En cours de livraison</span>\r\n                            )}\r\n                            {order.state === \"validation\" && (\r\n                              <span className=\"text-yellow-500\">En cours de validation</span>\r\n                            )}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5\">\r\n                    <div className=\"w-full sm:w-1/2 h-auto sm:h-[70px]\">\r\n                      <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0\">\r\n                        <strong>Validation entreprise</strong>\r\n                        <div className=\"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2\">\r\n                          <span className=\"hidden sm:inline-block\">\r\n                            {getStatusIconValidation(order.validation_rh_state)}\r\n                          </span>\r\n                          <span className=\"mt-1 sm:mt-0 sm:ml-2 capitalize\">\r\n                            {getStatusTextValidation(order.validation_rh_state)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"w-full sm:w-1/2 h-auto sm:h-[70px]\">\r\n                      <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0\">\r\n                        <strong>Approbation CCBM</strong>\r\n                        <div className=\"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2\">\r\n                          <span className=\"hidden sm:inline-block\">\r\n                            {getStatusIconValidation(order.validation_admin_state)}\r\n                          </span>\r\n                          <span className=\"mt-1 sm:mt-0 sm:ml-2 capitalize\">\r\n                            {getStatusTextValidation(order.validation_admin_state)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"flex flex-col sm:flex-row sm:space-x-[18px] space-y-5 sm:space-y-0 mb-5\">\r\n                    <div className=\"w-full sm:w-1/2 h-auto sm:h-[70px]\">\r\n                      <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0\">\r\n                        <strong> Date commande </strong>\r\n                        <div className=\"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2\">\r\n                          <span className=\"mt-1 sm:mt-0 sm:ml-2 capitalize\">\r\n                            {formatDate(order.date_order)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"w-full sm:w-1/2 h-auto sm:h-[70px]\">\r\n                      <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0\">\r\n                        <strong>Date de livraison</strong>\r\n                        <div className=\"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2\">\r\n                          <span className=\"mt-1 sm:mt-0 sm:ml-2 capitalize\">\r\n                            {formatDate(order.commitment_date)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {order && order.credit_type !== \"banque\" && <>\r\n                    <div className=\"sm:flex sm:space-x-[18px]\">\r\n\r\n                      <div className=\"sm:w-1/3 w-full mb-5 h-[70px]\">\r\n                        <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0\">\r\n                          <strong> Type crédit &nbsp;</strong>\r\n                          <div className=\"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2\">\r\n                            <span className=\"mt-1 sm:mt-0 sm:ml-2 capitalize\">\r\n                              {order.credit_type == \"direct\" ? \"Direct\" : \"Financé\"}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"sm:w-1/3 w-full mb-5 h-[70px]\">\r\n                        <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0\">\r\n                          <strong> Total Payé &nbsp;</strong>\r\n                          <div className=\"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2\">\r\n                            <span className=\"mt-1 sm:mt-0 sm:ml-2 capitalize\">\r\n                              {formatPrice(totalPaye)}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex-1 h-[70px]\">\r\n                        <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0\">\r\n                          <strong> Total Restant &nbsp; </strong>\r\n                          <div className=\"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2\">\r\n                            <span className=\"mt-1 sm:mt-0 sm:ml-2 capitalize\">\r\n                              {formatPrice(residual)}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </>}\r\n\r\n                  {order && order.credit_type === \"banque\" && <>\r\n                    <div className=\"sm:flex sm:space-x-[18px]\">\r\n\r\n                      <div className=\"sm:w-1/2 w-full mb-5 h-[70px]\">\r\n                        <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0\">\r\n                          <strong> Type crédit &nbsp;</strong>\r\n                          <div className=\"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2\">\r\n                            <span className=\"mt-1 sm:mt-0 sm:ml-2 capitalize\">\r\n                              {order.credit_type == \"direct\" ? \"Direct\" : \"Financé\"}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"sm:w-1/2 w-full mb-5 h-[70px]\">\r\n                        <div className=\"w-full h-full bg-[#F6F6F6] text-qblack flex flex-col sm:flex-row justify-center items-center p-3 sm:p-0\">\r\n                          <strong> Total à Payé &nbsp;</strong>\r\n                          <div className=\"flex flex-col sm:flex-row items-center mt-2 sm:mt-0 sm:ml-2\">\r\n                            <span className=\"mt-1 sm:mt-0 sm:ml-2 capitalize\">\r\n                              {formatPrice(totalPaye)}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                    </div>\r\n                  </>}\r\n\r\n\r\n\r\n                  {/* Section Employeur (uniquement pour les crédits bancaires) */}\r\n                  {isBankCredit && employer && (\r\n                    <div className=\"w-full mb-8 p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm bg-white\">\r\n                      <div className=\"flex items-center mb-4 border-b pb-2\">\r\n                        <h2 className=\"text-xl font-semibold text-gray-800\">Informations de l'employeur</h2>\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <div className=\"space-y-4\">\r\n                          <div className=\"flex items-start\">\r\n                            <User className=\"w-5 h-5 text-gray-500 mr-3 mt-1\" />\r\n                            <div>\r\n                              <div className=\"font-medium text-gray-700\">Nom de l'institution</div>\r\n                              <div className=\"text-gray-900\">{partner.institution_name || 'Non spécifié'}</div>\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div className=\"flex items-center\">\r\n                            <Mail className=\"w-5 h-5 text-gray-500 mr-3\" />\r\n                            <div>\r\n                              <div className=\"font-medium text-gray-700\">Email Institution</div>\r\n                              <div className=\"text-gray-900\">{employer.email || 'Non spécifié'}</div>\r\n                            </div>\r\n                          </div>\r\n                         \r\n\r\n                          <div className=\"flex items-start\">\r\n                            <User className=\"w-5 h-5 text-gray-500 mr-3 mt-1\" />\r\n                            <div>\r\n                              <div className=\"font-medium text-gray-700\">Nom Employeur</div>\r\n                              <div className=\"text-gray-900\">{partner.employer_name || 'Non spécifié'}</div>\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div className=\"flex items-start\">\r\n                            <Pin className=\"w-5 h-5 text-gray-500 mr-3 mt-1\" />\r\n                            <div>\r\n                              <div className=\"font-medium text-gray-700\">Adresse Employeur</div>\r\n                              <div className=\"text-gray-900\">{partner.adresse_employeur || 'Non spécifié'}</div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      \r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Récapitulatif de la commande */}\r\n                  <h1 className=\"text-2xl sm:text-3xl text-qblack font-medium mb-5 text-center\">\r\n                    Récapitulatif de la commande\r\n                  </h1>\r\n\r\n                  <div className=\"w-full p-4 sm:p-6 border border-[#EDEDED] rounded-lg shadow-sm\">\r\n                    <div className=\"space-y-6\">\r\n                      {/* Produits */}\r\n                      <div className=\"flex justify-between items-center border-b pb-4\">\r\n                        <p className=\"text-sm font-medium text-qblack uppercase\">Produit</p>\r\n                        <p className=\"text-sm font-medium text-qblack uppercase\">Total</p>\r\n                      </div>\r\n                      <div className=\"space-y-4\">\r\n                        {Array.isArray(order.order_lines) &&\r\n                          order.order_lines\r\n                            .filter((line) => {\r\n                              // Exclure les lignes de réduction\r\n                              const productName = (line.product_name || \"\").toLowerCase();\r\n                              return !productName.includes(\"réduction\") && !productName.includes(\"reduction\");\r\n                            })\r\n                            .map((line) => (\r\n                              <div key={line.id} className=\"border rounded-md p-3\">\r\n                                <div className=\"flex justify-between items-start\">\r\n                                  <div className=\"flex-1\">\r\n                                    <h4 className=\"text-sm sm:text-base text-qblack mb-1\">\r\n                                      {line.product_name}\r\n                                      <sup className=\"text-xs text-qgray ml-1\">\r\n                                        x {line.product_uom_qty ?? 0} {line.product_uom_name || \"\"}\r\n                                      </sup>\r\n                                    </h4>\r\n                                    {Boolean(line.description) && (\r\n                                      <p className=\"text-xs sm:text-sm text-qgray\">\r\n                                        {line.description}\r\n                                      </p>\r\n                                    )}\r\n                                  </div>\r\n                                  <span className=\"text-sm sm:text-base text-qblack font-medium\">\r\n                                    {formatPrice(line.price_total)}\r\n                                  </span>\r\n                                </div>\r\n                                {/* Prix détaillés */}\r\n                                <div className={`mt-2 grid gap-2 text-sm ${(order.credit_type === 'banque' || order.credit_type === 'finance') && line.discount ? 'sm:grid-cols-5' : 'sm:grid-cols-4'}`}>\r\n                                  <div className=\"flex justify-between sm:block\">\r\n                                    <span className=\"text-gray-500\">Prix unitaire</span>\r\n                                    <span className=\"font-medium sm:block\">{formatPrice(line.price_unit)}</span>\r\n                                  </div>\r\n                                  {(order.credit_type === 'banque' || order.credit_type === 'finance') && line.discount && line.discount > 0 && (\r\n                                    <div className=\"flex justify-between sm:block\">\r\n                                      <span className=\"text-gray-500\">Remise ({line.discount}%)</span>\r\n                                      <span className=\"font-medium sm:block text-green-600\">\r\n                                        -{formatPrice(((safeNumber(line.price_unit) * safeNumber(line.discount) / 100) * safeNumber(line.product_uom_qty || 1)))}\r\n                                      </span>\r\n                                    </div>\r\n                                  )}\r\n                                  <div className=\"flex justify-between sm:block\">\r\n                                    <span className=\"text-gray-500\">Sous-total (HT)</span>\r\n                                    <span className=\"font-medium sm:block\">{formatPrice(line.price_subtotal)}</span>\r\n                                  </div>\r\n                                  <div className=\"flex justify-between sm:block\">\r\n                                    <span className=\"text-gray-500\">TVA</span>\r\n                                    <span className=\"font-medium sm:block\">\r\n                                      {line.price_tax == null ? \"—\" : formatPrice(line.price_tax)}\r\n                                    </span>\r\n                                  </div>\r\n                                  <div className=\"flex justify-between sm:block\">\r\n                                    <span className=\"text-gray-500\">Total (TTC)</span>\r\n                                    <span className=\"font-semibold sm:block\">{formatPrice(line.price_total)}</span>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            ))}\r\n                      </div>\r\n\r\n\r\n                      {/* {order && order.credit_type === \"banque\" && order.validation_admin_state === \"validated\" && (\r\n\r\n                        <div className=\"w-full flex justify-center mb-4\">\r\n                          <button\r\n                            onClick={downloadProforma}\r\n                            className=\"px-4 py-2 rounded bg-[#487a43] text-white disabled:opacity-60\"\r\n                            disabled={isLoadingProforma || !order}\r\n                            title={proformaUrl || \"\"}\r\n                          >\r\n                            {isLoadingProforma ? \"Préparation du PDF...\" : \"Télécharger la Pro-Forma\"}\r\n                          </button>\r\n                        </div>\r\n\r\n                      )} */}\r\n\r\n\r\n                      {order && order.credit_type === \"banque\" && (\r\n\r\n                        <div className=\"w-full flex justify-center mb-4\">\r\n                          <button\r\n                            onClick={downloadProforma}\r\n                            className=\"px-4 py-2 rounded bg-[#487a43] text-white disabled:opacity-60\"\r\n                            disabled={isLoadingProforma || !order}\r\n                            title={proformaUrl || \"\"}\r\n                          >\r\n                            {isLoadingProforma ? \"Préparation du PDF...\" : \"Télécharger la Pro-Forma\"}\r\n                          </button>\r\n                        </div>\r\n\r\n                      )}\r\n\r\n\r\n                      {/* Détail des montants */}\r\n                      <div className=\"border-t pt-4 space-y-2\">\r\n                        <div className=\"flex justify-between items-center\">\r\n                          <dt className=\"text-sm text-gray-500\">Sous-total (hors TVA)</dt>\r\n                          <dd className=\"text-sm text-gray-900 font-medium\">\r\n                            {formatPrice(sousTotalHT)}\r\n                          </dd>\r\n                        </div>\r\n                        {(order.credit_type === 'banque' || order.credit_type === 'finance') && totalDiscount > 0 && (\r\n                          <div className=\"flex justify-between items-center\">\r\n                            <dt className=\"text-sm text-gray-500\">Remise globale</dt>\r\n                            <dd className=\"text-sm text-green-600 font-medium\">\r\n                              -{formatPrice(totalDiscount)}\r\n                            </dd>\r\n                          </div>\r\n                        )}\r\n                        {totalReduction !== 0 && (\r\n                          <div className=\"flex justify-between items-center\">\r\n                            <dt className=\"text-sm text-gray-500\">Réduction</dt>\r\n                            <dd className=\"text-sm text-red-600 font-medium\">\r\n                              {formatPrice(totalReduction)}\r\n                            </dd>\r\n                          </div>\r\n                        )}\r\n                        {/* {margeAmount > 0 && (\r\n                          <div className=\"flex justify-between items-center\">\r\n                            <dt className=\"text-sm text-gray-500\">\r\n                              Marge partenaire {partnerMargePercent > 0 && `(${partnerMargePercent}%)`}\r\n                            </dt>\r\n                            <dd className=\"text-sm text-blue-600 font-medium\">\r\n                              {formatPrice(margeAmount)}\r\n                            </dd>\r\n                          </div>\r\n                        )} */}\r\n                        <div className=\"flex justify-between items-center\">\r\n                          <dt className=\"text-sm text-gray-500\">TVA (18%)</dt>\r\n                          <dd className=\"text-sm text-gray-900 font-medium\">\r\n                            {formatPrice(tva)}\r\n                          </dd>\r\n                        </div>\r\n                        <div className=\"flex justify-between items-center\">\r\n                          <dt className=\"text-sm text-gray-500\">Total TTC</dt>\r\n                          <dd className=\"text-sm text-gray-900 font-medium\">\r\n                            {formatPrice(totalTTC)}\r\n                          </dd>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Plan d'échéances dynamiques */}\r\n                      <div className=\"border-t pt-4 space-y-2\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <dt className=\"text-sm text-gray-500\">\r\n                            Mode crédit : {safeNumber(order.creditorder_month_count, 0)} paiement(s)\r\n                          </dt>\r\n                          <dd className=\"text-sm text-gray-900 font-medium\">\r\n                            Total: {formatPrice(totalTTC)}\r\n                          </dd>\r\n                        </div>\r\n                        {paymentLines.map((pl, idx) => (\r\n                          <dl\r\n                            key={pl.sequence ?? idx}\r\n                            className=\"flex flex-wrap items-center justify-between gap-2\"\r\n                          >\r\n                            <dt className=\"text-sm text-gray-500\">\r\n                              {pl.label || `Paiement ${idx + 1}`}\r\n                              {pl.due_date && (\r\n                                <span className=\"ml-2 text-xs text-gray-400\">\r\n                                  (échéance: {formatDate(pl.due_date)})\r\n                                </span>\r\n                              )}\r\n                            </dt>\r\n                            <dd\r\n                              className={`text-sm sm:text-base font-medium ${pl.state ? \"text-green-600\" : \"text-gray-900\"\r\n                                }`}\r\n                            >\r\n                              {formatPrice(safeNumber(pl.amount))} {pl.state ? \"✓\" : \"\"}\r\n                            </dd>\r\n                          </dl>\r\n                        ))}\r\n                      </div>\r\n\r\n                      {/* Totaux */}\r\n                      <div className=\"border-t pt-4 space-y-2\">\r\n                        <dl className=\"flex items-center justify-between gap-2\">\r\n                          <dt className=\"text-base sm:text-lg font-bold text-gray-900\">Total à payer</dt>\r\n                          <dd className=\"text-base sm:text-lg font-bold text-gray-900\">\r\n                            {formatPrice(totalTTC)}\r\n                          </dd>\r\n                        </dl>\r\n                        <dl className=\"flex items-center justify-between gap-2\">\r\n                          <dt className=\"text-base sm:text-lg font-bold text-gray-900\">Total Payé</dt>\r\n                          <dd className=\"text-base sm:text-lg font-bold text-green-600\">\r\n                            {formatPrice(totalPaye)}\r\n                          </dd>\r\n                        </dl>\r\n\r\n                        {order && order.credit_type !== \"banque\" && <>\r\n                          <dl className=\"flex items-center justify-between gap-2\">\r\n                            <dt className=\"text-base sm:text-lg font-bold text-gray-900\">Total Restant</dt>\r\n                            <dd className=\"text-base sm:text-lg font-bold text-gray-900\">\r\n                              {formatPrice(residual)}\r\n                            </dd>\r\n                          </dl>\r\n                        </>}\r\n\r\n                      </div>\r\n\r\n                      {/* Paiement: champs + bouton */}\r\n                      {isFullyValidated && !nothingToPay ? (\r\n                        <div className=\"mt-6\">\r\n                          {order && order.credit_type !== \"banque\" && <>\r\n                            <Label htmlFor=\"montant\">Montant à payer</Label>\r\n                            <TextInput\r\n                              id=\"montant\"\r\n                              type=\"number\"\r\n                              value={montantAPayer}\r\n                              disabled={!isFullyValidated || nothingToPay}\r\n                              onChange={(e) => {\r\n                                const capped = Math.min(safeNumber(e.target.value, 0), residual);\r\n                                setMontantAPayer(capped);\r\n                                if (acompteDue) {\r\n                                  if (capped < acompteAmount) {\r\n                                    setErrorMontantAPayer(\r\n                                      `Le montant doit être au moins l'acompte requis (${formatPrice(\r\n                                        acompteAmount\r\n                                      )}).`\r\n                                    );\r\n                                  } else {\r\n                                    setErrorMontantAPayer(\"\");\r\n                                  }\r\n                                } else {\r\n                                  if (capped < minAmountToPay) {\r\n                                    setErrorMontantAPayer(\r\n                                      `Le montant doit être ≥ ${formatPrice(minAmountToPay)}.`\r\n                                    );\r\n                                  } else {\r\n                                    setErrorMontantAPayer(\"\");\r\n                                  }\r\n                                }\r\n                              }}\r\n                              min={acompteDue ? acompteAmount : minAmountToPay}\r\n                              max={residual}\r\n                              placeholder={\r\n                                acompteDue\r\n                                  ? `Acompte minimum: ${formatPrice(\r\n                                    acompteAmount\r\n                                  )} (vous pouvez payer plus)`\r\n                                  : `Minimum ${formatPrice(minAmountToPay)}`\r\n                              }\r\n                              className=\"mt-1\"\r\n                            />\r\n                            {errorMontantAPayer && (\r\n                              <p className=\"text-red-500 mt-1\">{errorMontantAPayer}</p>\r\n                            )}\r\n\r\n                            <Button\r\n                              onClick={validerPaimentMontant}\r\n                              className=\"mt-4 w-full !bg-[#487a43] !text-white hover:!bg-[#3f6d3b]  disabled:!bg-[#487a43]/50 disabled:!text-white/70 disabled:cursor-not-allowed\"\r\n                              disabled={isPayButtonDisabled || isRefreshing}\r\n                            >\r\n                              {(isLoading || isRefreshing) && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                              {isRefreshing ? \"Mise à jour...\" : `Passer à la caisse (${formatPrice(safeNumber(montantAPayer))})`}\r\n                            </Button>\r\n\r\n                            {acompteDue ? (\r\n                              <p className=\"mt-2 text-xs text-gray-500 text-center\">\r\n                                Acompte requis :{\" \"}\r\n                                <strong>{formatPrice(safeNumber(acompteAmount))}</strong> minimum. Vous\r\n                                pouvez payer <em>au moins</em> l'acompte (et plus si vous voulez), sans\r\n                                dépasser le restant.\r\n                              </p>\r\n                            ) : (\r\n                              <p className=\"mt-2 text-xs text-gray-500 text-center\">\r\n                                Paiement libre : choisissez le montant que vous souhaitez (minimum{\" \"}\r\n                                <strong>{formatPrice(minAmountToPay)}</strong>), jusqu'à{\" \"}\r\n                                <strong>{formatPrice(residual)}</strong> restant.\r\n                              </p>\r\n                            )}\r\n\r\n                          </>}\r\n\r\n\r\n                        </div>\r\n                      ) : (\r\n                        <>\r\n                          {!isFullyValidated && (\r\n                            <p className=\"text-yellow-500 mt-4 text-center text-base sm:text-xl\">\r\n                              Merci d'attendre la validation de la commande à crédit par la RH et CCBM\r\n                            </p>\r\n                          )}\r\n                          {nothingToPay && (\r\n                            <p className=\"text-green-600 mt-4 text-center text-base sm:text-xl\">\r\n                              Votre paiement est déjà réglé\r\n                            </p>\r\n                          )}\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Modal paiement */}\r\n                  {showPaymentModal && order && (\r\n                    <WaveOrangePaymentService\r\n                      handlePay={handlePay}\r\n                      totalAmount={safeNumber(montantAPayer)}\r\n                      onClose={() => setShowPaymentModal(false)}\r\n                      order={order}\r\n                      idOrder={order.id}\r\n                      onSuccess={handlePaymentSuccess}\r\n                    />\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {!isLoading && !order && (\r\n            <div className=\"flex justify-center items-center py-10\">\r\n              Commande à Crédit non trouvée\r\n            </div>\r\n          )}\r\n        </div>\r\n      </Layout>\r\n    </>\r\n  );\r\n}\r\n"],"names":["safeNumber","n","fallback","v","CreditOrderPage","id","useParams","location","useLocation","navigate","useNavigate","user","useAuthContext","partner","setPartner","useState","order","setOrder","employer","setEmployer","isLoading","setIsLoading","isRefreshing","setIsRefreshing","montantAPayer","setMontantAPayer","errorMontantAPayer","setErrorMontantAPayer","showPaymentModal","setShowPaymentModal","getStatusTextValidation","status","getStatusIconValidation","jsx","Truck","XCircle","CheckCircle","fetchOrder","useCallback","data","getCreditCommandeById","defaultPartner","__spreadValues","defaultEmployer","error","toast","useEffect","paymentLines","useMemo","acompteLine","pl","acompteAmount","acompteDue","residual","minAmountToPay","isLoadingProforma","setIsLoadingProforma","proforma","setProforma","proformaUrl","getProformaCommande","err","handlePay","validerPaimentMontant","e","value","formatPrice","handlePaymentSuccess","onStorage","cleanPath","isFullyValidated","nothingToPay","isPayButtonDisabled","sousTotalHT","tva","totalTTC","totalPaye","totalReduction","line","productName","sum","totalDiscount","discount","discountAmount","isBankCredit","base64ToBlobUrl","b64","mime","bin","len","bytes","i","blob","downloadProforma","url","a","jsxs","Fragment","SEOHeader","Layout","PageTitle","Loader2","formatDate","User","Mail","Pin","_a","idx","Label","TextInput","capped","Button","WaveOrangePaymentService"],"mappings":"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"}
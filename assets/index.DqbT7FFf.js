import{C,j as e,f as g,O as F,u as T,h as B,i as L,o as $,A as z,s as V,k as I,B as m}from"./index.BZOJSUP9.js";import{b as n,u as R,L as H}from"./vendor.EKSpuOPe.js";import{M as Q,P as G}from"./plus.DatpvH8M.js";import{B as J}from"./BannerPub.MM_nIZSs.js";import{c as K,a as U}from"./creditCommandeService.CHA7hmv_.js";import"./truck.BJdVMW6Y.js";function W({produit:a}){const{updateCreditOrder:c}=n.useContext(C),x=o=>{o.preventDefault(),c(a,a.quantity+1)},l=o=>{console.log("produit.quantity"),console.log(a.quantity),o.preventDefault(),a.quantity>1&&c(a,a.quantity-1)};return e.jsx("div",{className:"w-[120px] h-[40px] px-[26px] flex items-center border border-qgray-border",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("button",{onClick:l,type:"button",className:"text-base text-qgray",children:e.jsx(Q,{})}),e.jsx("span",{className:"text-qblack",children:a.quantity?a.quantity:0}),e.jsx("button",{onClick:x,type:"button",className:"text-base text-qgray",children:e.jsx(G,{})})]})})}function X({className:a}){const{creditOrder:c,clearCreditOrder:x,removeFromCreditOrder:l}=n.useContext(C);console.log(c);const o=(s,u)=>{s.preventDefault(),l(u)};return e.jsxs("div",{className:`w-full ${a||""}`,children:[e.jsx("div",{className:"relative w-full overflow-x-auto border border-[#EDEDED]",children:e.jsx("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"text-[13px] font-medium text-black bg-[#F6F6F6] whitespace-nowrap px-2 border-b default-border-bottom uppercase",children:[e.jsx("td",{className:"py-4 pl-10 block whitespace-nowrap min-w-[300px]",children:"product"}),e.jsx("td",{className:"py-4 whitespace-nowrap text-center",children:"Prix"}),e.jsx("td",{className:"py-4 whitespace-nowrap  text-center",children:"Quantité"}),e.jsx("td",{className:"py-4 whitespace-nowrap  text-center",children:"total"}),e.jsx("td",{className:"py-4 whitespace-nowrap text-right w-[114px]"})]}),c&&c.map((s,u)=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50",children:[e.jsx("td",{className:"pl-10  py-4  w-[380px]",children:e.jsxs("div",{className:"flex space-x-6 items-center",children:[e.jsx("div",{className:"w-[80px] h-[80px] overflow-hidden flex justify-center items-center border border-[#EDEDED]",children:e.jsx("img",{src:`${s.image_256?"data:image/png;base64,"+s.image_256:"https://readymadeui.com/images/coffee1.webp"}`,alt:"product",className:"w-full h-full object-contain"})}),e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx("p",{className:"font-medium text-[15px] text-qblack",children:s.name})})]})}),e.jsx("td",{className:"text-center py-4 px-2",children:e.jsx("div",{className:"flex space-x-1 items-center justify-center",children:e.jsxs("span",{className:"text-[15px] font-normal",children:[" ",g(s.creditorder_price)]})})}),e.jsx("td",{className:" py-4",children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(W,{produit:s})})}),e.jsx("td",{className:"text-right py-4",children:e.jsx("div",{className:"flex space-x-1 items-center justify-center",children:e.jsxs("span",{className:"text-[15px] font-normal",children:[" ",g(s.creditorder_price*s.quantity)]})})}),e.jsx("td",{className:"text-right py-4",children:e.jsx("div",{className:"flex space-x-1 items-center justify-center",children:e.jsx("button",{onClick:i=>o(i,s),className:"duration-200 hover:scale-150",children:e.jsx(F,{className:"hover:text-red-500"})})})})]},u))]})})}),e.jsx("div",{className:" mt-3 transition-all duration-300 ease-in-out bg-gray-200 text-[15px]  rounded-lg font-medium text-black  text-center py-2",children:"Livraison gratuite sur Dakar"})]})}function ne({cartt:a=!0}){const c=R(),{creditOrder:x,getCreditOrderTotal:l,clearCreditOrder:o}=n.useContext(C),{user:s,parent:u}=T(),[i,P]=n.useState(50),[f,M]=n.useState(4),q=[30,40,50,60,70,80,90,100],[N,D]=n.useState(!1),[Y,E]=n.useState({});n.useEffect(()=>{i===100&&M(1)},[i]),n.useEffect(()=>{(async()=>{try{if(s?.id){const r=await K(s.id);E(r||{})}}catch(r){console.warn("checkExistingCreditCommande error:",r)}})()},[s?.id]);const A=n.useMemo(()=>{const t=l()||0,r=Math.min(100,Math.max(30,i||30)),j=Math.min(5,Math.max(1,f||1));if(!t)return[];if(r===100||j===1)return[{label:"Paiement unique",amount:t,dueAt:new Date}];const p=t*r/100,d=Math.max(0,t-p),b=j-1,O=d/b,S=Math.round(O*100)/100,y=[];y.push({label:`Acompte (${r}%)`,amount:Math.round(p*100)/100,dueAt:new Date});let v=0;for(let h=1;h<=b;h++){const w=new Date;w.setMonth(w.getMonth()+h);const k=h<b?S:Math.round((d-v)*100)/100;v=Math.round((v+k)*100)/100,y.push({label:`Mensualité ${h}/${b}`,amount:k,dueAt:w})}return y},[l,i,f]),_=async()=>{D(!0);try{if(!s){m.dismiss(),m.warning("Merci de vous connecter",{position:"top-center",autoClose:5e3}),c("/login");return}if(!x?.length){m.dismiss(),m.error("Veuillez ajouter au moins un article dans votre panier",{position:"top-center",autoClose:5e3});return}const t=Math.min(100,Math.max(30,i)),r=t===100?1:Math.min(5,Math.max(1,f)),j={partner_id:s.id,parent_id:u?.id,type_sale:"creditorder",payment_mode:"online",state:"draft",commitment_date:new Date,acomptePercentage:t,nombreMois:r,order_lines:x.map(d=>({id:d.id,quantity:d.quantity,list_price:d.creditorder_price}))},p=await U(j);m.success("Votre commande a été créée avec succès",{position:"top-center",autoClose:5e3}),setTimeout(()=>{c(`/credit-commandes/${p.id}/détails`,{state:{commande:p}})},1200),o()}catch(t){console.log(t?.response?.data||t),m.error(t?.response?.data||"Commande crédit non validée",{position:"top-center",autoClose:5e3})}finally{D(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"CCBM Shop | Panier crédit",description:"Découvrez les meilleures offres sur CCBM Shop, votre destination privilégiée pour l'électroménager de qualité. Explorez nos produits allant des réfrigérateurs aux téléviseurs intelligents, et profitez de promotions exclusives !",keywords:"électroménager, boutique en ligne d'électroménager, CCBM Shop, ccbme, appareils électroménagers à prix réduits, smart TV, réfrigérateurs modernes, climatiseurs efficaces, promotions électroménager"}),e.jsxs(L,{childrenClasses:a?"pt-0 pb-0":"",children:[a===!1?e.jsx("div",{className:"cart-page-wrapper w-full",children:e.jsx("div",{className:"container-x mx-auto",children:e.jsx($,{paths:[{name:"Accueil",path:"/"},{name:"Panier crédit",path:"/credit-cart"}]})})}):e.jsxs("div",{className:"cart-page-wrapper w-full bg-white pb-[60px]",children:[e.jsx("div",{className:"w-full",children:e.jsx(z,{title:"Panier crédit",breadcrumb:[{name:"Accueil",path:"/"},{name:"Panier crédit",path:"/credit-cart"}]})}),e.jsx("div",{className:"w-full mt-[23px]",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsx(X,{className:"mb-[30px]"}),e.jsx("div",{className:"w-full sm:flex justify-between",children:e.jsx("div",{className:"flex space-x-2.5 items-center",children:e.jsx(H,{to:"/boutique",children:e.jsx("div",{className:"w-[220px] h-[50px] bg-[#F6F6F6] flex justify-center items-center",children:e.jsx("span",{className:"text-sm font-semibold",children:"Continuer vos achats"})})})})}),e.jsx("div",{className:"w-full mt-[30px] flex sm:justify-end",children:e.jsx("div",{className:"sm:w-[420px] w-full border border-[#EDEDED] px-[20px] sm:px-[30px] py-[20px] sm:py-[26px] rounded-md",children:l()!==0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Acompte"}),e.jsx("select",{className:"w-full border rounded p-2",value:i,onChange:t=>P(Number(t.target.value)),children:q.map(t=>e.jsxs("option",{value:t,children:[t,"%"]},t))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum 30%. 100% = paiement en une fois."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Nombre de paiements (mois)"}),e.jsx("select",{className:"w-full border rounded p-2",value:f,onChange:t=>M(Number(t.target.value)),disabled:i===100,children:[1,2,3,4,5].map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum 5 mensualités."})]})]}),e.jsx("div",{className:"border-t pt-4 space-y-2",children:A.map((t,r)=>e.jsxs("dl",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("dt",{className:"text-sm text-gray-500",children:[t.label,t.dueAt&&e.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:["(échéance: ",new Date(t.dueAt).toLocaleDateString(),")"]})]}),e.jsx("dd",{className:"text-sm sm:text-base font-medium text-gray-900",children:g(t.amount)})]},`${t.label}-${r}`))}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("span",{className:"text-[15px] text-gray-600",children:"Total commande"}),e.jsx("span",{className:"text-[16px] font-semibold",children:g(l())})]}),e.jsx("br",{}),e.jsxs(V,{type:"submit",className:"hover:bg-red-500 w-full bg-bleu-logo",onClick:_,disabled:N,children:[N&&e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),N?"Veuillez patientez...":"Valider le panier"]})]})})})]})})]}),e.jsx(J,{})]})]})}export{ne as default};

import{c as z,u as U,j as e,m as E,L as $,p as O,f as l,t as h,E as T,a0 as D,$ as F,U as q,a3 as N,B as i}from"./index-BY5VJ1ij.js";import{m as G,u as H,b as d,L as y}from"./vendor-Bb8_f6lk.js";import{f as v}from"./date-format-qL-o8H-f.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=z("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);function Q(){const{id:c}=G(),o=H(),{user:g}=U(),[s,w]=d.useState(null),[I,_]=d.useState(!0),[V,S]=d.useState(!1),[m,p]=d.useState(""),[B,C]=d.useState("");d.useEffect(()=>{(async()=>{if(!c){o("/vente-en-cher");return}_(!0);try{const a=await N.getVenteCherById(c);if(w(a),a.current_price){const u=Math.max(1e3,Math.floor(a.current_price*.05));p((a.current_price+u).toString())}}catch(a){console.error("Erreur lors de la récupération de la vente en cher",a),i.error("Impossible de charger la vente en cher"),o("/vente-en-cher")}finally{_(!1)}})()},[c,o]);const L=async t=>{var A,M;if(t.preventDefault(),!g){i.info("Vous devez être connecté pour miser"),o("/login");return}if(!m||parseFloat(m)<=0){i.error("Veuillez entrer un montant valide");return}const a=parseFloat(m),u=(s==null?void 0:s.current_price)||(s==null?void 0:s.start_price)||0;if(a<=u){i.error(`Votre mise doit être supérieure au prix actuel (${l(u)})`);return}S(!0);try{await N.createBid(c,{partner_id:g.id,amount:a,note:B||""}),i.success("Votre mise a été enregistrée avec succès !"),C("");const n=await N.getVenteCherById(c);if(w(n),n.current_price){const b=Math.max(1e3,Math.floor(n.current_price*.05));p((n.current_price+b).toString())}}catch(n){console.error("Erreur lors de la création de la mise",n);const b=((M=(A=n.response)==null?void 0:A.data)==null?void 0:M.error)||n.message||"Impossible de créer la mise";i.error(b)}finally{S(!1)}};if(I)return e.jsx(E,{children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx($,{className:"animate-spin h-8 w-8"})})});if(!s)return null;const r=s.product||{},j=s.bids||[],k=s.state==="open",P=s.state==="closed"||s.state==="cancelled",x=s.current_price||s.start_price||0,f=x+Math.max(1e3,Math.floor(x*.05));return e.jsx(E,{children:e.jsx("div",{className:"vente-cher-detail-wrapper w-full",children:e.jsxs("div",{className:"container-x mx-auto",children:[e.jsx(O,{paths:[{name:"Accueil",path:"/"},{name:"Vente en cher",path:"/vente-en-cher"},{name:s.name||"Détail",path:`/vente-cher/${c}`}]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:r.image_256?e.jsx("img",{src:`data:image/png;base64,${r.image_256}`,alt:r.name||"Produit",className:"w-full md:w-64 h-64 object-contain bg-gray-50 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>r.id&&o(`/produits/${r.id}/details`)}):e.jsx("div",{className:"w-full md:w-64 h-64 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400",children:"Pas d'image"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:r.name||r.display_name}),r.categ_id&&e.jsxs("p",{className:"text-gray-600 mb-2",children:["Catégorie: ",r.categ_id]}),r.tags&&Array.isArray(r.tags)&&r.tags.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map(t=>e.jsx("span",{className:"inline-block px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full",children:t.name},t.id))})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 my-4 p-4 bg-gray-50 rounded-lg",children:r.list_price>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Prix catalogue"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[l(r.list_price)," XOF"]})]})}),r.description&&e.jsx("p",{className:"text-gray-700 mt-4 mb-4 line-clamp-3",children:r.description}),r.id&&e.jsx(y,{to:`/produits/${r.id}/details`,children:e.jsxs(h,{className:"bg-bleu-logo hover:bg-blue-700 flex items-center gap-2 mt-4",children:[e.jsx(T,{className:"w-4 h-4"}),"Voir les détails complets du produit"]})})]})]})}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Informations de la vente"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Prix de départ"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[l(s.start_price||0)," ",s.currency]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Prix actuel"}),e.jsxs("p",{className:"text-2xl font-bold text-bleu-logo",children:[l(x)," ",s.currency]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nombre de mises"}),e.jsx("p",{className:"text-lg font-semibold",children:s.bid_count||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"État"}),e.jsxs("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-semibold ${k?"bg-green-100 text-green-800":P?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[s.state==="open"&&"Ouverte",s.state==="closed"&&"Fermée",s.state==="cancelled"&&"Annulée",s.state==="draft"&&"Brouillon"]})]}),s.start_datetime&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(F,{className:"w-4 h-4"}),"Début"]}),e.jsx("p",{className:"text-sm font-semibold",children:v(s.start_datetime)})]}),s.end_datetime&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(F,{className:"w-4 h-4"}),"Fin"]}),e.jsx("p",{className:"text-sm font-semibold",children:v(s.end_datetime)})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Historique des mises (",j.length,")"]}),j.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aucune mise pour le moment. Soyez le premier à miser !"}):e.jsx("div",{className:"space-y-3",children:j.sort((t,a)=>a.amount!==t.amount?a.amount-t.amount:new Date(a.create_date)-new Date(t.create_date)).map((t,a)=>e.jsx("div",{className:`p-4 rounded-lg border ${a===0?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"font-semibold",children:t.partner_name||"Anonyme"}),a===0&&e.jsx("span",{className:"text-xs bg-green-500 text-white px-2 py-1 rounded",children:"Meilleure offre"})]}),t.note&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.note}),t.create_date&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:v(t.create_date)})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-lg font-bold text-bleu-logo",children:[l(t.amount)," ",t.currency||s.currency]})})]})},t.id))})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md sticky top-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Faire une mise"}),k?g?e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Montant de votre mise (minimum: ",l(f)," ",s.currency,")"]}),e.jsx("input",{type:"number",min:f,step:"1000",value:m,onChange:t=>p(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-bleu-logo focus:border-transparent",placeholder:`Minimum: ${l(f)}`,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Prix actuel: ",l(x)," ",s.currency]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note (optionnel)"}),e.jsx("textarea",{value:B,onChange:t=>C(t.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-bleu-logo focus:border-transparent",placeholder:"Ajoutez une note à votre mise..."})]}),e.jsx(h,{type:"submit",className:"w-full bg-bleu-logo hover:bg-blue-700",disabled:V,children:V?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"animate-spin mr-2 h-4 w-4"}),"Envoi en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Placer ma mise"]})}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"En plaçant une mise, vous acceptez les conditions de la vente en cher."})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Vous devez être connecté pour miser."}),e.jsx(y,{to:"/login",children:e.jsx(h,{className:"w-full bg-bleu-logo",children:"Se connecter"})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("p",{className:"text-gray-600 mb-4",children:["Cette vente en cher est ",P?"fermée":"non disponible","."]}),e.jsx(y,{to:"/vente-en-cher",children:e.jsx(h,{className:"w-full bg-bleu-logo",children:"Voir les autres ventes"})})]})]})})]})]})})})}export{Q as default};

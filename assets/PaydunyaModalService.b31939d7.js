import{G as Et,u as kt,j as $,M as ot,A as Ct,f as J,t as ft,l as Rt,I as Ft,B as X}from"./index.7602c8fa.js";import{c as at,g as Tt,e as St,u as At,r as K}from"./vendor.af94f9e3.js";import"./UserContext.6e3313f9.js";import{P as Ot}from"./paimentService.11c19bca.js";var Y={};function q(r,f){if(!(r&&f&&r.config["PAYDUNYA-MASTER-KEY"]&&r.config["PAYDUNYA-PRIVATE-KEY"]&&r.config["PAYDUNYA-TOKEN"]&&f.name))throw new Error("Invalid parameters;");this.baseURL=r.baseURL,this.config=r.config,f.return_url&&(this.returnURL=f.return_url),f.cancel_url&&(this.cancelURL=f.cancel_url),f.callback_url&&(this.callbackURL=f.callback_url),this.store=f,this.description="",this.items={},this.customData={},this.taxes={},this.channels=[],this.totalAmount=0}q.prototype.addItem=function(r,f,i,n,F){if(!r)throw new Error("Invalid parameters; name is required.");var t=Object.keys(this.items).length+1;this.items["item_"+t]={name:r,quantity:f||0,unit_price:i||0,total_price:n||0},F&&(this.items["item_"+t].description=F)};q.prototype.addTax=function(r,f){if(!(r&&typeof r=="string"&&typeof Number(f)=="number"))throw new Error("Invalid parameters.");var i=Object.keys(this.taxes).length+1;this.taxes["tax_"+i]={name:r,amount:Number(f)}};q.prototype.addChannel=function(r){if(!(r&&typeof r=="string"))throw new Error("Invalid parameters.");this.channels.push(r)};q.prototype.addChannels=function(r){if(!(r&&r instanceof Array))throw new Error("Invalid parameters.");this.channels=[];for(var f=0;f<r.length;f++)this.channels.push(r[f])};q.prototype.addCustomData=function(r,f){if(!(r&&f))throw new Error("Invalid parameters.");this.customData[r]=f};q.prototype.generateRequestBody=function(){if(!(this.store&&this.store.name&&this.baseURL&&this.totalAmount>0))throw new Error(`Invalid parameters. Initialize Invoice with valid instances of Setup and Store. Total amount must also be set.
eg: var invoice = new Invoice; invoice.init(setup, store); invoice.setTotalAmount(40)`);var r={invoice:{total_amount:this.totalAmount},store:this.store};return this.description&&(r.invoice.description=this.description),Object.keys(this.channels).length>0&&(r.invoice.channels=this.channels),Object.keys(this.items).length>0&&(r.invoice.items=this.items),(this.returnURL||this.cancelURL||this.callbackURL)&&(r.actions={},this.returnURL&&(r.actions.return_url=this.returnURL),this.cancelURL&&(r.actions.cancel_url=this.cancelURL),this.callbackURL&&(r.actions.callback_url=this.callbackURL)),Object.keys(this.taxes).length>0&&(r.invoice.taxes=this.taxes),Object.keys(this.customData).length>0&&(r.custom_data=this.customData),r};var pt=q,Dt=Q;function Q(r){if(r)return Ut(r)}function Ut(r){for(var f in Q.prototype)r[f]=Q.prototype[f];return r}Q.prototype.on=Q.prototype.addEventListener=function(r,f){return this._callbacks=this._callbacks||{},(this._callbacks[r]=this._callbacks[r]||[]).push(f),this};Q.prototype.once=function(r,f){var i=this;this._callbacks=this._callbacks||{};function n(){i.off(r,n),f.apply(this,arguments)}return n.fn=f,this.on(r,n),this};Q.prototype.off=Q.prototype.removeListener=Q.prototype.removeAllListeners=Q.prototype.removeEventListener=function(r,f){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks[r];if(!i)return this;if(arguments.length==1)return delete this._callbacks[r],this;for(var n,F=0;F<i.length;F++)if(n=i[F],n===f||n.fn===f){i.splice(F,1);break}return this};Q.prototype.emit=function(r){this._callbacks=this._callbacks||{};var f=[].slice.call(arguments,1),i=this._callbacks[r];if(i){i=i.slice(0);for(var n=0,F=i.length;n<F;++n)i[n].apply(this,f)}return this};Q.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks[r]||[]};Q.prototype.hasListeners=function(r){return!!this.listeners(r).length};var Lt=function(r,f,i){for(var n=0,F=r.length,t=arguments.length==3?i:r[n++];n<F;)t=f.call(null,t,r[n],++n,r);return t},ht=Dt,It=Lt,st=typeof window>"u"?at:window;function $t(){}function Pt(r){var f={}.toString.call(r);switch(f){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function Ht(){if(st.XMLHttpRequest&&(st.location.protocol!="file:"||!st.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch{}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch{}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch{}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch{}return!1}var Nt="".trim?function(r){return r.trim()}:function(r){return r.replace(/(^\s*|\s*$)/g,"")};function rt(r){return r===Object(r)}function ut(r){if(!rt(r))return r;var f=[];for(var i in r)r[i]!=null&&f.push(encodeURIComponent(i)+"="+encodeURIComponent(r[i]));return f.join("&")}M.serializeObject=ut;function dt(r){for(var f={},i=r.split("&"),n,F,t=0,y=i.length;t<y;++t)F=i[t],n=F.split("="),f[decodeURIComponent(n[0])]=decodeURIComponent(n[1]);return f}M.parseString=dt;M.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};M.serialize={"application/x-www-form-urlencoded":ut,"application/json":JSON.stringify};M.parse={"application/x-www-form-urlencoded":dt,"application/json":JSON.parse};function Mt(r){var f=r.split(/\r?\n/),i={},n,F,t,y;f.pop();for(var p=0,_=f.length;p<_;++p)F=f[p],n=F.indexOf(":"),t=F.slice(0,n).toLowerCase(),y=Nt(F.slice(n+1)),i[t]=y;return i}function Vt(r){return r.split(/ *; */).shift()}function Bt(r){return It(r.split(/ *; */),function(f,i){var n=i.split(/ *= */),F=n.shift(),t=n.shift();return F&&t&&(f[F]=t),f},{})}function W(r,f){this.req=r,this.xhr=this.req.xhr,this.text=this.xhr.responseText,this.setStatusProperties(this.xhr.status),this.header=this.headers=Mt(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body=this.req.method!="HEAD"?this.parseBody(this.text):null}W.prototype.get=function(r){return this.header[r.toLowerCase()]};W.prototype.setHeaderProperties=function(r){var f=this.header["content-type"]||"";this.type=Vt(f);var i=Bt(f);for(var n in i)this[n]=i[n]};W.prototype.parseBody=function(r){var f=M.parse[this.type];return f?f(r):null};W.prototype.setStatusProperties=function(r){var f=r/100|0;this.status=r,this.statusType=f,this.info=f==1,this.ok=f==2,this.clientError=f==4,this.serverError=f==5,this.error=f==4||f==5?this.toError():!1,this.accepted=r==202,this.noContent=r==204||r==1223,this.badRequest=r==400,this.unauthorized=r==401,this.notAcceptable=r==406,this.notFound=r==404,this.forbidden=r==403};W.prototype.toError=function(){var r=this.req,f=r.method,i=r.url,n="cannot "+f+" "+i+" ("+this.status+")",F=new Error(n);return F.status=this.status,F.method=f,F.url=i,F};M.Response=W;function V(r,f){var i=this;ht.call(this),this._query=this._query||[],this.method=r,this.url=f,this.header={},this._header={},this.on("end",function(){var n=new W(i);r=="HEAD"&&(n.text=null),i.callback(null,n)})}ht(V.prototype);V.prototype.use=function(r){return r(this),this};V.prototype.timeout=function(r){return this._timeout=r,this};V.prototype.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this};V.prototype.abort=function(){if(!this.aborted)return this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this};V.prototype.set=function(r,f){if(rt(r)){for(var i in r)this.set(i,r[i]);return this}return this._header[r.toLowerCase()]=f,this.header[r]=f,this};V.prototype.getHeader=function(r){return this._header[r.toLowerCase()]};V.prototype.type=function(r){return this.set("Content-Type",M.types[r]||r),this};V.prototype.accept=function(r){return this.set("Accept",M.types[r]||r),this};V.prototype.auth=function(r,f){var i=btoa(r+":"+f);return this.set("Authorization","Basic "+i),this};V.prototype.query=function(r){return typeof r!="string"&&(r=ut(r)),r&&this._query.push(r),this};V.prototype.field=function(r,f){return this._formData||(this._formData=new FormData),this._formData.append(r,f),this};V.prototype.attach=function(r,f,i){return this._formData||(this._formData=new FormData),this._formData.append(r,f,i),this};V.prototype.send=function(r){var f=rt(r),i=this.getHeader("Content-Type");if(f&&rt(this._data))for(var n in r)this._data[n]=r[n];else typeof r=="string"?(i||this.type("form"),i=this.getHeader("Content-Type"),i=="application/x-www-form-urlencoded"?this._data=this._data?this._data+"&"+r:r:this._data=(this._data||"")+r):this._data=r;return f?(i||this.type("json"),this):this};V.prototype.callback=function(r,f){var i=this._callback;if(i.length==2)return i(r,f);if(r)return this.emit("error",r);i(f)};V.prototype.crossDomainError=function(){var r=new Error("Origin is not allowed by Access-Control-Allow-Origin");r.crossDomain=!0,this.callback(r)};V.prototype.timeoutError=function(){var r=this._timeout,f=new Error("timeout of "+r+"ms exceeded");f.timeout=r,this.callback(f)};V.prototype.withCredentials=function(){return this._withCredentials=!0,this};V.prototype.end=function(r){var f=this,i=this.xhr=Ht(),n=this._query.join("&"),F=this._timeout,t=this._formData||this._data;if(this._callback=r||$t,i.onreadystatechange=function(){if(i.readyState==4){if(i.status==0)return f.aborted?f.timeoutError():f.crossDomainError();f.emit("end")}},i.upload&&(i.upload.onprogress=function(_){_.percent=_.loaded/_.total*100,f.emit("progress",_)}),F&&!this._timer&&(this._timer=setTimeout(function(){f.abort()},F)),n&&(n=M.serializeObject(n),this.url+=~this.url.indexOf("?")?"&"+n:"?"+n),i.open(this.method,this.url,!0),this._withCredentials&&(i.withCredentials=!0),this.method!="GET"&&this.method!="HEAD"&&typeof t!="string"&&!Pt(t)){var y=M.serialize[this.getHeader("Content-Type")];y&&(t=y(t))}for(var p in this.header)this.header[p]!=null&&i.setRequestHeader(p,this.header[p]);return this.emit("request",this),i.send(t),this};M.Request=V;function M(r,f){return typeof f=="function"?new V("GET",r).end(f):arguments.length==1?new V("GET",r):new V(r,f)}M.get=function(r,f,i){var n=M("GET",r);return typeof f=="function"&&(i=f,f=null),f&&n.query(f),i&&n.end(i),n};M.head=function(r,f,i){var n=M("HEAD",r);return typeof f=="function"&&(i=f,f=null),f&&n.send(f),i&&n.end(i),n};M.del=function(r,f){var i=M("DELETE",r);return f&&i.end(f),i};M.patch=function(r,f,i){var n=M("PATCH",r);return typeof f=="function"&&(i=f,f=null),f&&n.send(f),i&&n.end(i),n};M.post=function(r,f,i){var n=M("POST",r);return typeof f=="function"&&(i=f,f=null),f&&n.send(f),i&&n.end(i),n};M.put=function(r,f,i){var n=M("PUT",r);return typeof f=="function"&&(i=f,f=null),f&&n.send(f),i&&n.end(i),n};var ct=M,_t={exports:{}};/* @preserve
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013-2015 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */(function(r,f){(function(i){r.exports=i()})(function(){return function i(n,F,t){function y(v,E){if(!F[v]){if(!n[v]){var g=typeof _dereq_=="function"&&_dereq_;if(!E&&g)return g(v,!0);if(p)return p(v,!0);var h=new Error("Cannot find module '"+v+"'");throw h.code="MODULE_NOT_FOUND",h}var d=F[v]={exports:{}};n[v][0].call(d.exports,function(s){var u=n[v][1][s];return y(u||s)},d,d.exports,i,n,F,t)}return F[v].exports}for(var p=typeof _dereq_=="function"&&_dereq_,_=0;_<t.length;_++)y(t[_]);return y}({1:[function(i,n,F){n.exports=function(t){var y=t._SomePromiseArray;function p(_){var v=new y(_),E=v.promise();return v.setHowMany(1),v.setUnwrap(),v.init(),E}t.any=function(_){return p(_)},t.prototype.any=function(){return p(this)}}},{}],2:[function(i,n,F){var t;try{throw new Error}catch(d){t=d}var y=i("./schedule.js"),p=i("./queue.js"),_=i("./util.js");function v(){this._isTickUsed=!1,this._lateQueue=new p(16),this._normalQueue=new p(16),this._trampolineEnabled=!0;var d=this;this.drainQueues=function(){d._drainQueues()},this._schedule=y.isStatic?y(this.drainQueues):y}v.prototype.disableTrampolineIfNecessary=function(){_.hasDevTools&&(this._trampolineEnabled=!1)},v.prototype.enableTrampoline=function(){this._trampolineEnabled||(this._trampolineEnabled=!0,this._schedule=function(d){setTimeout(d,0)})},v.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},v.prototype.throwLater=function(d,s){if(arguments.length===1&&(s=d,d=function(){throw s}),typeof setTimeout<"u")setTimeout(function(){d(s)},0);else try{this._schedule(function(){d(s)})}catch{throw new Error(`No async scheduler available

    See http://goo.gl/m3OTXk
`)}};function E(d,s,u){this._lateQueue.push(d,s,u),this._queueTick()}function g(d,s,u){this._normalQueue.push(d,s,u),this._queueTick()}function h(d){this._normalQueue._pushOne(d),this._queueTick()}_.hasDevTools?(y.isStatic&&(y=function(d){setTimeout(d,0)}),v.prototype.invokeLater=function(d,s,u){this._trampolineEnabled?E.call(this,d,s,u):this._schedule(function(){setTimeout(function(){d.call(s,u)},100)})},v.prototype.invoke=function(d,s,u){this._trampolineEnabled?g.call(this,d,s,u):this._schedule(function(){d.call(s,u)})},v.prototype.settlePromises=function(d){this._trampolineEnabled?h.call(this,d):this._schedule(function(){d._settlePromises()})}):(v.prototype.invokeLater=E,v.prototype.invoke=g,v.prototype.settlePromises=h),v.prototype.invokeFirst=function(d,s,u){this._normalQueue.unshift(d,s,u),this._queueTick()},v.prototype._drainQueue=function(d){for(;d.length()>0;){var s=d.shift();if(typeof s!="function"){s._settlePromises();continue}var u=d.shift(),l=d.shift();s.call(u,l)}},v.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},v.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},v.prototype._reset=function(){this._isTickUsed=!1},n.exports=new v,n.exports.firstLineError=t},{"./queue.js":28,"./schedule.js":31,"./util.js":38}],3:[function(i,n,F){n.exports=function(t,y,p){var _=function(h,d){this._reject(d)},v=function(h,d){d.promiseRejectionQueued=!0,d.bindingPromise._then(_,_,null,this,h)},E=function(h,d){this._isPending()&&this._resolveCallback(d.target)},g=function(h,d){d.promiseRejectionQueued||this._reject(h)};t.prototype.bind=function(h){var d=p(h),s=new t(y);s._propagateFrom(this,1);var u=this._target();if(s._setBoundTo(d),d instanceof t){var l={promiseRejectionQueued:!1,promise:s,target:u,bindingPromise:d};u._then(y,v,s._progress,s,l),d._then(E,g,s._progress,s,l)}else s._resolveCallback(u);return s},t.prototype._setBoundTo=function(h){h!==void 0?(this._bitField=this._bitField|131072,this._boundTo=h):this._bitField=this._bitField&-131073},t.prototype._isBound=function(){return(this._bitField&131072)===131072},t.bind=function(h,d){var s=p(h),u=new t(y);return u._setBoundTo(s),s instanceof t?s._then(function(){u._resolveCallback(d)},u._reject,u._progress,u,null):u._resolveCallback(d),u}}},{}],4:[function(i,n,F){var t;typeof Promise<"u"&&(t=Promise);function y(){try{Promise===p&&(Promise=t)}catch{}return p}var p=i("./promise.js")();p.noConflict=y,n.exports=p},{"./promise.js":23}],5:[function(i,n,F){var t=Object.create;if(t){var y=t(null),p=t(null);y[" size"]=p[" size"]=0}n.exports=function(_){var v=i("./util.js"),E=v.canEvaluate;v.isIdentifier;var g;function h(l,m){var c;if(l!=null&&(c=l[m]),typeof c!="function"){var R="Object "+v.classString(l)+" has no method '"+v.toString(m)+"'";throw new _.TypeError(R)}return c}function d(l){var m=this.pop(),c=h(l,m);return c.apply(l,this)}_.prototype.call=function(l){for(var m=arguments.length,c=new Array(m-1),R=1;R<m;++R)c[R-1]=arguments[R];return c.push(l),this._then(d,void 0,void 0,c,void 0)};function s(l){return l[this]}function u(l){var m=+this;return m<0&&(m=Math.max(0,m+l.length)),l[m]}_.prototype.get=function(l){var m=typeof l=="number",c;if(m)c=u;else if(E){var R=g(l);c=R!==null?R:s}else c=s;return this._then(c,void 0,void 0,l,void 0)}}},{"./util.js":38}],6:[function(i,n,F){n.exports=function(t){var y=i("./errors.js"),p=i("./async.js"),_=y.CancellationError;t.prototype._cancel=function(v){if(!this.isCancellable())return this;for(var E,g=this;(E=g._cancellationParent)!==void 0&&E.isCancellable();)g=E;this._unsetCancellable(),g._target()._rejectCallback(v,!1,!0)},t.prototype.cancel=function(v){return this.isCancellable()?(v===void 0&&(v=new _),p.invokeLater(this._cancel,this,v),this):this},t.prototype.cancellable=function(){return this._cancellable()?this:(p.enableTrampoline(),this._setCancellable(),this._cancellationParent=void 0,this)},t.prototype.uncancellable=function(){var v=this.then();return v._unsetCancellable(),v},t.prototype.fork=function(v,E,g){var h=this._then(v,E,g,void 0,void 0);return h._setCancellable(),h._cancellationParent=void 0,h}}},{"./async.js":2,"./errors.js":13}],7:[function(i,n,F){n.exports=function(){var t=i("./async.js"),y=i("./util.js"),p=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/,_=null,v=null,E=!1,g;function h(x){this._parent=x;var e=this._length=1+(x===void 0?0:x._length);U(this,h),e>32&&this.uncycle()}y.inherits(h,Error),h.prototype.uncycle=function(){var x=this._length;if(!(x<2)){for(var e=[],A={},o=0,a=this;a!==void 0;++o)e.push(a),a=a._parent;x=this._length=o;for(var o=x-1;o>=0;--o){var k=e[o].stack;A[k]===void 0&&(A[k]=o)}for(var o=0;o<x;++o){var T=e[o].stack,C=A[T];if(C!==void 0&&C!==o){C>0&&(e[C-1]._parent=void 0,e[C-1]._length=1),e[o]._parent=void 0,e[o]._length=1;var D=o>0?e[o-1]:this;C<x-1?(D._parent=e[C+1],D._parent.uncycle(),D._length=D._parent._length+1):(D._parent=void 0,D._length=1);for(var b=D._length+1,I=o-2;I>=0;--I)e[I]._length=b,b++;return}}}},h.prototype.parent=function(){return this._parent},h.prototype.hasParent=function(){return this._parent!==void 0},h.prototype.attachExtraTrace=function(x){if(!x.__stackCleaned__){this.uncycle();for(var e=h.parseStackAndMessage(x),A=e.message,o=[e.stack],a=this;a!==void 0;)o.push(l(a.stack.split(`
`))),a=a._parent;u(o),s(o),y.notEnumerableProp(x,"stack",d(A,o)),y.notEnumerableProp(x,"__stackCleaned__",!0)}};function d(x,e){for(var A=0;A<e.length-1;++A)e[A].push("From previous event:"),e[A]=e[A].join(`
`);return A<e.length&&(e[A]=e[A].join(`
`)),x+`
`+e.join(`
`)}function s(x){for(var e=0;e<x.length;++e)(x[e].length===0||e+1<x.length&&x[e][0]===x[e+1][0])&&(x.splice(e,1),e--)}function u(x){for(var e=x[0],A=1;A<x.length;++A){for(var o=x[A],a=e.length-1,k=e[a],T=-1,C=o.length-1;C>=0;--C)if(o[C]===k){T=C;break}for(var C=T;C>=0;--C){var D=o[C];if(e[a]===D)e.pop(),a--;else break}e=o}}function l(x){for(var e=[],A=0;A<x.length;++A){var o=x[A],a=_.test(o)||o==="    (No stack trace)",k=a&&S(o);a&&!k&&(E&&o.charAt(0)!==" "&&(o="    "+o),e.push(o))}return e}function m(x){for(var e=x.stack.replace(/\s+$/g,"").split(`
`),A=0;A<e.length;++A){var o=e[A];if(o==="    (No stack trace)"||_.test(o))break}return A>0&&(e=e.slice(A)),e}h.parseStackAndMessage=function(x){var e=x.stack,A=x.toString();return e=typeof e=="string"&&e.length>0?m(x):["    (No stack trace)"],{message:A,stack:l(e)}},h.formatAndLogError=function(x,e){if(typeof console<"u"){var A;if(typeof x=="object"||typeof x=="function"){var o=x.stack;A=e+v(o,x)}else A=e+String(x);typeof g=="function"?g(A):(typeof console.log=="function"||typeof console.log=="object")&&console.log(A)}},h.unhandledRejection=function(x){h.formatAndLogError(x,"^--- With additional stack trace: ")},h.isSupported=function(){return typeof U=="function"},h.fireRejectionEvent=function(x,e,A,o){var a=!1;try{typeof e=="function"&&(a=!0,x==="rejectionHandled"?e(o):e(A,o))}catch(C){t.throwLater(C)}var k=!1;try{k=O(x,A,o)}catch(C){k=!0,t.throwLater(C)}var T=!1;if(L)try{T=L(x.toLowerCase(),{reason:A,promise:o})}catch(C){T=!0,t.throwLater(C)}!k&&!a&&!T&&x==="unhandledRejection"&&h.formatAndLogError(A,"Unhandled rejection ")};function c(x){var e;if(typeof x=="function")e="[function "+(x.name||"anonymous")+"]";else{e=x.toString();var A=/\[object [a-zA-Z0-9$_]+\]/;if(A.test(e))try{var o=JSON.stringify(x);e=o}catch{}e.length===0&&(e="(empty array)")}return"(<"+R(e)+">, no stack trace)"}function R(x){var e=41;return x.length<e?x:x.substr(0,e-3)+"..."}var S=function(){return!1},j=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function w(x){var e=x.match(j);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}h.setBounds=function(x,e){if(h.isSupported()){for(var A=x.stack.split(`
`),o=e.stack.split(`
`),a=-1,k=-1,T,C,D=0;D<A.length;++D){var b=w(A[D]);if(b){T=b.fileName,a=b.line;break}}for(var D=0;D<o.length;++D){var b=w(o[D]);if(b){C=b.fileName,k=b.line;break}}a<0||k<0||!T||!C||T!==C||a>=k||(S=function(I){if(p.test(I))return!0;var N=w(I);return!!(N&&N.fileName===T&&a<=N.line&&N.line<=k)})}};var U=function(){var e=/^\s*at\s*/,A=function(T,C){return typeof T=="string"?T:C.name!==void 0&&C.message!==void 0?C.toString():c(C)};if(typeof Error.stackTraceLimit=="number"&&typeof Error.captureStackTrace=="function"){Error.stackTraceLimit=Error.stackTraceLimit+6,_=e,v=A;var o=Error.captureStackTrace;return S=function(T){return p.test(T)},function(T,C){Error.stackTraceLimit=Error.stackTraceLimit+6,o(T,C),Error.stackTraceLimit=Error.stackTraceLimit-6}}var a=new Error;if(typeof a.stack=="string"&&a.stack.split(`
`)[0].indexOf("stackDetection@")>=0)return _=/@/,v=A,E=!0,function(C){C.stack=new Error().stack};var k;try{throw new Error}catch(T){k="stack"in T}return!("stack"in a)&&k&&typeof Error.stackTraceLimit=="number"?(_=e,v=A,function(C){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(D){C.stack=D.stack}Error.stackTraceLimit=Error.stackTraceLimit-6}):(v=function(T,C){return typeof T=="string"?T:(typeof C=="object"||typeof C=="function")&&C.name!==void 0&&C.message!==void 0?C.toString():c(C)},null)}(),L,O=function(){if(y.isNode)return function(k,T,C){return k==="rejectionHandled"?process.emit(k,C):process.emit(k,T,C)};var x=!1,e=!0;try{var A=new self.CustomEvent("test");x=A instanceof CustomEvent}catch{}if(!x)try{var o=document.createEvent("CustomEvent");o.initCustomEvent("testingtheevent",!1,!0,{}),self.dispatchEvent(o)}catch{e=!1}e&&(L=function(k,T){var C;return x?C=new self.CustomEvent(k,{detail:T,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(C=document.createEvent("CustomEvent"),C.initCustomEvent(k,!1,!0,T)),C?!self.dispatchEvent(C):!1});var a={};return a.unhandledRejection="onunhandledRejection".toLowerCase(),a.rejectionHandled="onrejectionHandled".toLowerCase(),function(k,T,C){var D=a[k],b=self[D];return b?(k==="rejectionHandled"?b.call(self,C):b.call(self,T,C),!0):!1}}();return typeof console<"u"&&typeof console.warn<"u"&&(g=function(x){console.warn(x)},y.isNode&&process.stderr.isTTY?g=function(x){process.stderr.write("\x1B[31m"+x+`\x1B[39m
`)}:!y.isNode&&typeof new Error().stack=="string"&&(g=function(x){console.warn("%c"+x,"color: red")})),h}},{"./async.js":2,"./util.js":38}],8:[function(i,n,F){n.exports=function(t){var y=i("./util.js"),p=i("./errors.js"),_=y.tryCatch,v=y.errorObj,E=i("./es5.js").keys,g=p.TypeError;function h(s,u,l){this._instances=s,this._callback=u,this._promise=l}function d(s,u){var l={},m=_(s).call(l,u);if(m===v)return m;var c=E(l);return c.length?(v.e=new g(`Catch filter must inherit from Error or be a simple predicate function

    See http://goo.gl/o84o68
`),v):m}return h.prototype.doFilter=function(s){for(var u=this._callback,l=this._promise,m=l._boundValue(),c=0,R=this._instances.length;c<R;++c){var S=this._instances[c],j=S===Error||S!=null&&S.prototype instanceof Error;if(j&&s instanceof S){var w=_(u).call(m,s);return w===v?(t.e=w.e,t):w}else if(typeof S=="function"&&!j){var U=d(S,s);if(U===v){s=v.e;break}else if(U){var w=_(u).call(m,s);return w===v?(t.e=w.e,t):w}}}return t.e=s,t},h}},{"./errors.js":13,"./es5.js":14,"./util.js":38}],9:[function(i,n,F){n.exports=function(t,y,p){var _=[];function v(){this._trace=new y(g())}v.prototype._pushContext=function(){p()&&this._trace!==void 0&&_.push(this._trace)},v.prototype._popContext=function(){p()&&this._trace!==void 0&&_.pop()};function E(){if(p())return new v}function g(){var h=_.length-1;if(h>=0)return _[h]}return t.prototype._peekContext=g,t.prototype._pushContext=v.prototype._pushContext,t.prototype._popContext=v.prototype._popContext,E}},{}],10:[function(i,n,F){n.exports=function(t,y){var p=t._getDomain,_=i("./async.js"),v=i("./errors.js").Warning,E=i("./util.js"),g=E.canAttachTrace,h,d,s=E.isNode&&(!!process.env.BLUEBIRD_DEBUG||process.env.NODE_ENV==="development");return E.isNode&&process.env.BLUEBIRD_DEBUG==0&&(s=!1),s&&_.disableTrampolineIfNecessary(),t.prototype._ignoreRejections=function(){this._unsetRejectionIsUnhandled(),this._bitField=this._bitField|16777216},t.prototype._ensurePossibleRejectionHandled=function(){this._bitField&16777216||(this._setRejectionIsUnhandled(),_.invokeLater(this._notifyUnhandledRejection,this,void 0))},t.prototype._notifyUnhandledRejectionIsHandled=function(){y.fireRejectionEvent("rejectionHandled",h,void 0,this)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var u=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),y.fireRejectionEvent("unhandledRejection",d,u,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|524288},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-524289},t.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&524288)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|2097152},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-2097153,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(this._bitField&2097152)>0},t.prototype._setCarriedStackTrace=function(u){this._bitField=this._bitField|1048576,this._fulfillmentHandler0=u},t.prototype._isCarryingStackTrace=function(){return(this._bitField&1048576)>0},t.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},t.prototype._captureStackTrace=function(){return s&&(this._trace=new y(this._peekContext())),this},t.prototype._attachExtraTrace=function(u,l){if(s&&g(u)){var m=this._trace;if(m!==void 0&&l&&(m=m._parent),m!==void 0)m.attachExtraTrace(u);else if(!u.__stackCleaned__){var c=y.parseStackAndMessage(u);E.notEnumerableProp(u,"stack",c.message+`
`+c.stack.join(`
`)),E.notEnumerableProp(u,"__stackCleaned__",!0)}}},t.prototype._warn=function(u){var l=new v(u),m=this._peekContext();if(m)m.attachExtraTrace(l);else{var c=y.parseStackAndMessage(l);l.stack=c.message+`
`+c.stack.join(`
`)}y.formatAndLogError(l,"")},t.onPossiblyUnhandledRejection=function(u){var l=p();d=typeof u=="function"?l===null?u:l.bind(u):void 0},t.onUnhandledRejectionHandled=function(u){var l=p();h=typeof u=="function"?l===null?u:l.bind(u):void 0},t.longStackTraces=function(){if(_.haveItemsQueued()&&s===!1)throw new Error(`cannot enable long stack traces after promises have been created

    See http://goo.gl/DT1qyG
`);s=y.isSupported(),s&&_.disableTrampolineIfNecessary()},t.hasLongStackTraces=function(){return s&&y.isSupported()},y.isSupported()||(t.longStackTraces=function(){},s=!1),function(){return s}}},{"./async.js":2,"./errors.js":13,"./util.js":38}],11:[function(i,n,F){var t=i("./util.js"),y=t.isPrimitive;n.exports=function(p){var _=function(){return this},v=function(){throw this},E=function(){},g=function(){throw void 0},h=function(d,s){if(s===1)return function(){throw d};if(s===2)return function(){return d}};p.prototype.return=p.prototype.thenReturn=function(d){return d===void 0?this.then(E):y(d)?this._then(h(d,2),void 0,void 0,void 0,void 0):(d instanceof p&&d._ignoreRejections(),this._then(_,void 0,void 0,d,void 0))},p.prototype.throw=p.prototype.thenThrow=function(d){return d===void 0?this.then(g):y(d)?this._then(h(d,1),void 0,void 0,void 0,void 0):this._then(v,void 0,void 0,d,void 0)}}},{"./util.js":38}],12:[function(i,n,F){n.exports=function(t,y){var p=t.reduce;t.prototype.each=function(_){return p(this,_,null,y)},t.each=function(_,v){return p(_,v,null,y)}}},{}],13:[function(i,n,F){var t=i("./es5.js"),y=t.freeze,p=i("./util.js"),_=p.inherits,v=p.notEnumerableProp;function E(w,U){function L(O){if(!(this instanceof L))return new L(O);v(this,"message",typeof O=="string"?O:U),v(this,"name",w),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return _(L,Error),L}var g,h,d=E("Warning","warning"),s=E("CancellationError","cancellation error"),u=E("TimeoutError","timeout error"),l=E("AggregateError","aggregate error");try{g=TypeError,h=RangeError}catch{g=E("TypeError","type error"),h=E("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),c=0;c<m.length;++c)typeof Array.prototype[m[c]]=="function"&&(l.prototype[m[c]]=Array.prototype[m[c]]);t.defineProperty(l.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),l.prototype.isOperational=!0;var R=0;l.prototype.toString=function(){var w=Array(R*4+1).join(" "),U=`
`+w+`AggregateError of:
`;R++,w=Array(R*4+1).join(" ");for(var L=0;L<this.length;++L){for(var O=this[L]===this?"[Circular AggregateError]":this[L]+"",x=O.split(`
`),e=0;e<x.length;++e)x[e]=w+x[e];O=x.join(`
`),U+=O+`
`}return R--,U};function S(w){if(!(this instanceof S))return new S(w);v(this,"name","OperationalError"),v(this,"message",w),this.cause=w,this.isOperational=!0,w instanceof Error?(v(this,"message",w.message),v(this,"stack",w.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}_(S,Error);var j=Error.__BluebirdErrorTypes__;j||(j=y({CancellationError:s,TimeoutError:u,OperationalError:S,RejectionError:S,AggregateError:l}),v(Error,"__BluebirdErrorTypes__",j)),n.exports={Error,TypeError:g,RangeError:h,CancellationError:j.CancellationError,OperationalError:j.OperationalError,TimeoutError:j.TimeoutError,AggregateError:j.AggregateError,Warning:d}},{"./es5.js":14,"./util.js":38}],14:[function(i,n,F){var t=function(){return this===void 0}();if(t)n.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:t,propertyIsWritable:function(u,l){var m=Object.getOwnPropertyDescriptor(u,l);return!!(!m||m.writable||m.set)}};else{var y={}.hasOwnProperty,p={}.toString,_={}.constructor.prototype,v=function(u){var l=[];for(var m in u)y.call(u,m)&&l.push(m);return l},E=function(u,l){return{value:u[l]}},g=function(u,l,m){return u[l]=m.value,u},h=function(u){return u},d=function(u){try{return Object(u).constructor.prototype}catch{return _}},s=function(u){try{return p.call(u)==="[object Array]"}catch{return!1}};n.exports={isArray:s,keys:v,names:v,defineProperty:g,getDescriptor:E,freeze:h,getPrototypeOf:d,isES5:t,propertyIsWritable:function(){return!0}}}},{}],15:[function(i,n,F){n.exports=function(t,y){var p=t.map;t.prototype.filter=function(_,v){return p(this,_,v,y)},t.filter=function(_,v,E){return p(_,v,E,y)}}},{}],16:[function(i,n,F){n.exports=function(t,y,p){var _=i("./util.js"),v=_.isPrimitive,E=_.thrower;function g(){return this}function h(){throw this}function d(c){return function(){return c}}function s(c){return function(){throw c}}function u(c,R,S){var j;return v(R)?j=S?d(R):s(R):j=S?g:h,c._then(j,E,void 0,R,void 0)}function l(c){var R=this.promise,S=this.handler,j=R._isBound()?S.call(R._boundValue()):S();if(j!==void 0){var w=p(j,R);if(w instanceof t)return w=w._target(),u(w,c,R.isFulfilled())}return R.isRejected()?(y.e=c,y):c}function m(c){var R=this.promise,S=this.handler,j=R._isBound()?S.call(R._boundValue(),c):S(c);if(j!==void 0){var w=p(j,R);if(w instanceof t)return w=w._target(),u(w,c,!0)}return c}t.prototype._passThroughHandler=function(c,R){if(typeof c!="function")return this.then();var S={promise:this,handler:c};return this._then(R?l:m,R?l:void 0,void 0,S,void 0)},t.prototype.lastly=t.prototype.finally=function(c){return this._passThroughHandler(c,!0)},t.prototype.tap=function(c){return this._passThroughHandler(c,!1)}}},{"./util.js":38}],17:[function(i,n,F){n.exports=function(t,y,p,_){var v=i("./errors.js"),E=v.TypeError,g=i("./util.js"),h=g.errorObj,d=g.tryCatch,s=[];function u(m,c,R){for(var S=0;S<c.length;++S){R._pushContext();var j=d(c[S])(m);if(R._popContext(),j===h){R._pushContext();var w=t.reject(h.e);return R._popContext(),w}var U=_(j,R);if(U instanceof t)return U}return null}function l(m,c,R,S){var j=this._promise=new t(p);j._captureStackTrace(),this._stack=S,this._generatorFunction=m,this._receiver=c,this._generator=void 0,this._yieldHandlers=typeof R=="function"?[R].concat(s):s}l.prototype.promise=function(){return this._promise},l.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},l.prototype._continue=function(m){if(m===h)return this._promise._rejectCallback(m.e,!1,!0);var c=m.value;if(m.done===!0)this._promise._resolveCallback(c);else{var R=_(c,this._promise);if(!(R instanceof t)&&(R=u(R,this._yieldHandlers,this._promise),R===null)){this._throw(new E(`A value %s was yielded that could not be treated as a promise

    See http://goo.gl/4Y4pDk

`.replace("%s",c)+`From coroutine:
`+this._stack.split(`
`).slice(1,-7).join(`
`)));return}R._then(this._next,this._throw,void 0,this,null)}},l.prototype._throw=function(m){this._promise._attachExtraTrace(m),this._promise._pushContext();var c=d(this._generator.throw).call(this._generator,m);this._promise._popContext(),this._continue(c)},l.prototype._next=function(m){this._promise._pushContext();var c=d(this._generator.next).call(this._generator,m);this._promise._popContext(),this._continue(c)},t.coroutine=function(m,c){if(typeof m!="function")throw new E(`generatorFunction must be a function

    See http://goo.gl/6Vqhm0
`);var R=Object(c).yieldHandler,S=l,j=new Error().stack;return function(){var w=m.apply(this,arguments),U=new S(void 0,void 0,R,j);return U._generator=w,U._next(void 0),U.promise()}},t.coroutine.addYieldHandler=function(m){if(typeof m!="function")throw new E(`fn must be a function

    See http://goo.gl/916lJJ
`);s.push(m)},t.spawn=function(m){if(typeof m!="function")return y(`generatorFunction must be a function

    See http://goo.gl/6Vqhm0
`);var c=new l(m,this),R=c.promise();return c._run(t.spawn),R}}},{"./errors.js":13,"./util.js":38}],18:[function(i,n,F){n.exports=function(t,y,p,_){var v=i("./util.js");v.canEvaluate,v.tryCatch,v.errorObj,t.join=function(){var E=arguments.length-1,g;if(E>0&&typeof arguments[E]=="function"){g=arguments[E];var u}for(var h=arguments.length,d=new Array(h),s=0;s<h;++s)d[s]=arguments[s];g&&d.pop();var u=new y(d).promise();return g!==void 0?u.spread(g):u}}},{"./util.js":38}],19:[function(i,n,F){n.exports=function(t,y,p,_,v){var E=t._getDomain,g=i("./async.js"),h=i("./util.js"),d=h.tryCatch,s=h.errorObj,u={},l=[];function m(S,j,w,U){this.constructor$(S),this._promise._captureStackTrace();var L=E();this._callback=L===null?j:L.bind(j),this._preservedValues=U===v?new Array(this.length()):null,this._limit=w,this._inFlight=0,this._queue=w>=1?[]:l,g.invoke(c,this,void 0)}h.inherits(m,y);function c(){this._init$(void 0,-2)}m.prototype._init=function(){},m.prototype._promiseFulfilled=function(S,j){var w=this._values,U=this.length(),L=this._preservedValues,O=this._limit;if(w[j]===u){if(w[j]=S,O>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(O>=1&&this._inFlight>=O){w[j]=S,this._queue.push(j);return}L!==null&&(L[j]=S);var x=this._callback,e=this._promise._boundValue();this._promise._pushContext();var A=d(x).call(e,S,j,U);if(this._promise._popContext(),A===s)return this._reject(A.e);var o=_(A,this._promise);if(o instanceof t){if(o=o._target(),o._isPending())return O>=1&&this._inFlight++,w[j]=u,o._proxyPromiseArray(this,j);if(o._isFulfilled())A=o._value();else return this._reject(o._reason())}w[j]=A}var a=++this._totalResolved;a>=U&&(L!==null?this._filter(w,L):this._resolve(w))},m.prototype._drainQueue=function(){for(var S=this._queue,j=this._limit,w=this._values;S.length>0&&this._inFlight<j;){if(this._isResolved())return;var U=S.pop();this._promiseFulfilled(w[U],U)}},m.prototype._filter=function(S,j){for(var w=j.length,U=new Array(w),L=0,O=0;O<w;++O)S[O]&&(U[L++]=j[O]);U.length=L,this._resolve(U)},m.prototype.preservedValues=function(){return this._preservedValues};function R(S,j,w,U){var L=typeof w=="object"&&w!==null?w.concurrency:0;return L=typeof L=="number"&&isFinite(L)&&L>=1?L:0,new m(S,j,L,U)}t.prototype.map=function(S,j){return typeof S!="function"?p(`fn must be a function

    See http://goo.gl/916lJJ
`):R(this,S,j,null).promise()},t.map=function(S,j,w,U){return typeof j!="function"?p(`fn must be a function

    See http://goo.gl/916lJJ
`):R(S,j,w,U).promise()}}},{"./async.js":2,"./util.js":38}],20:[function(i,n,F){n.exports=function(t,y,p,_){var v=i("./util.js"),E=v.tryCatch;t.method=function(g){if(typeof g!="function")throw new t.TypeError(`fn must be a function

    See http://goo.gl/916lJJ
`);return function(){var h=new t(y);h._captureStackTrace(),h._pushContext();var d=E(g).apply(this,arguments);return h._popContext(),h._resolveFromSyncValue(d),h}},t.attempt=t.try=function(g,h,d){if(typeof g!="function")return _(`fn must be a function

    See http://goo.gl/916lJJ
`);var s=new t(y);s._captureStackTrace(),s._pushContext();var u=v.isArray(h)?E(g).apply(d,h):E(g).call(d,h);return s._popContext(),s._resolveFromSyncValue(u),s},t.prototype._resolveFromSyncValue=function(g){g===v.errorObj?this._rejectCallback(g.e,!1,!0):this._resolveCallback(g,!0)}}},{"./util.js":38}],21:[function(i,n,F){n.exports=function(t){var y=i("./util.js"),p=i("./async.js"),_=y.tryCatch,v=y.errorObj;function E(d,s){var u=this;if(!y.isArray(d))return g.call(u,d,s);var l=_(s).apply(u._boundValue(),[null].concat(d));l===v&&p.throwLater(l.e)}function g(d,s){var u=this,l=u._boundValue(),m=d===void 0?_(s).call(l,null):_(s).call(l,null,d);m===v&&p.throwLater(m.e)}function h(d,s){var u=this;if(!d){var l=u._target(),m=l._getCarriedStackTrace();m.cause=d,d=m}var c=_(s).call(u._boundValue(),d);c===v&&p.throwLater(c.e)}t.prototype.asCallback=t.prototype.nodeify=function(d,s){if(typeof d=="function"){var u=g;s!==void 0&&Object(s).spread&&(u=E),this._then(u,h,void 0,this,d)}return this}}},{"./async.js":2,"./util.js":38}],22:[function(i,n,F){n.exports=function(t,y){var p=i("./util.js"),_=i("./async.js"),v=p.tryCatch,E=p.errorObj;t.prototype.progressed=function(g){return this._then(void 0,void 0,g,void 0,void 0)},t.prototype._progress=function(g){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(g)},t.prototype._progressHandlerAt=function(g){return g===0?this._progressHandler0:this[(g<<2)+g-5+2]},t.prototype._doProgressWith=function(g){var h=g.value,d=g.handler,s=g.promise,u=g.receiver,l=v(d).call(u,h);if(l===E){if(l.e!=null&&l.e.name!=="StopProgressPropagation"){var m=p.canAttachTrace(l.e)?l.e:new Error(p.toString(l.e));s._attachExtraTrace(m),s._progress(l.e)}}else l instanceof t?l._then(s._progress,null,null,s,void 0):s._progress(l)},t.prototype._progressUnchecked=function(g){for(var h=this._length(),d=this._progress,s=0;s<h;s++){var u=this._progressHandlerAt(s),l=this._promiseAt(s);if(!(l instanceof t)){var m=this._receiverAt(s);typeof u=="function"?u.call(m,g,l):m instanceof y&&!m._isResolved()&&m._promiseProgressed(g,l);continue}typeof u=="function"?_.invoke(this._doProgressWith,this,{handler:u,promise:l,receiver:this._receiverAt(s),value:g}):_.invoke(d,l,g)}}}},{"./async.js":2,"./util.js":38}],23:[function(i,n,F){n.exports=function(){var t=function(){return new d(`circular promise resolution chain

    See http://goo.gl/LhFpo0
`)},y=function(){return new e.PromiseInspection(this._target())},p=function(o){return e.reject(new d(o))},_=i("./util.js"),v;_.isNode?v=function(){var o=process.domain;return o===void 0&&(o=null),o}:v=function(){return null},_.notEnumerableProp(e,"_getDomain",v);var E={},g=i("./async.js"),h=i("./errors.js"),d=e.TypeError=h.TypeError;e.RangeError=h.RangeError,e.CancellationError=h.CancellationError,e.TimeoutError=h.TimeoutError,e.OperationalError=h.OperationalError,e.RejectionError=h.OperationalError,e.AggregateError=h.AggregateError;var s=function(){},u={},l={e:null},m=i("./thenables.js")(e,s),c=i("./promise_array.js")(e,s,m,p),R=i("./captured_trace.js")(),S=i("./debuggability.js")(e,R),j=i("./context.js")(e,R,S),w=i("./catch_filter.js")(l),U=i("./promise_resolver.js"),L=U._nodebackForPromise,O=_.errorObj,x=_.tryCatch;function e(o){if(typeof o!="function")throw new d(`the promise constructor requires a resolver function

    See http://goo.gl/EC22Yn
`);if(this.constructor!==e)throw new d(`the promise constructor cannot be invoked directly

    See http://goo.gl/KsIlge
`);this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,o!==s&&this._resolveFromResolver(o)}e.prototype.toString=function(){return"[object Promise]"},e.prototype.caught=e.prototype.catch=function(o){var a=arguments.length;if(a>1){var k=new Array(a-1),T=0,C;for(C=0;C<a-1;++C){var D=arguments[C];if(typeof D=="function")k[T++]=D;else return e.reject(new d(`Catch filter must inherit from Error or be a simple predicate function

    See http://goo.gl/o84o68
`))}k.length=T,o=arguments[C];var b=new w(k,o,this);return this._then(void 0,b.doFilter,void 0,b,void 0)}return this._then(void 0,o,void 0,void 0,void 0)},e.prototype.reflect=function(){return this._then(y,y,void 0,this,void 0)},e.prototype.then=function(o,a,k){if(S()&&arguments.length>0&&typeof o!="function"&&typeof a!="function"){var T=".then() only accepts functions but was passed: "+_.classString(o);arguments.length>1&&(T+=", "+_.classString(a)),this._warn(T)}return this._then(o,a,k,void 0,void 0)},e.prototype.done=function(o,a,k){var T=this._then(o,a,k,void 0,void 0);T._setIsFinal()},e.prototype.spread=function(o,a){return this.all()._then(o,a,void 0,u,void 0)},e.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},e.prototype.toJSON=function(){var o={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(o.fulfillmentValue=this.value(),o.isFulfilled=!0):this.isRejected()&&(o.rejectionReason=this.reason(),o.isRejected=!0),o},e.prototype.all=function(){return new c(this).promise()},e.prototype.error=function(o){return this.caught(_.originatesFromRejection,o)},e.getNewLibraryCopy=n.exports,e.is=function(o){return o instanceof e},e.fromNode=function(o){var a=new e(s),k=x(o)(L(a));return k===O&&a._rejectCallback(k.e,!0,!0),a},e.all=function(o){return new c(o).promise()},e.defer=e.pending=function(){var o=new e(s);return new U(o)},e.cast=function(o){var a=m(o);if(!(a instanceof e)){var k=a;a=new e(s),a._fulfillUnchecked(k)}return a},e.resolve=e.fulfilled=e.cast,e.reject=e.rejected=function(o){var a=new e(s);return a._captureStackTrace(),a._rejectCallback(o,!0),a},e.setScheduler=function(o){if(typeof o!="function")throw new d(`fn must be a function

    See http://goo.gl/916lJJ
`);var a=g._schedule;return g._schedule=o,a},e.prototype._then=function(o,a,k,T,C){var D=C!==void 0,b=D?C:new e(s);D||(b._propagateFrom(this,5),b._captureStackTrace());var I=this._target();I!==this&&(T===void 0&&(T=this._boundTo),D||b._setIsMigrated());var N=I._addCallbacks(o,a,k,b,T,v());return I._isResolved()&&!I._isSettlePromisesQueued()&&g.invoke(I._settlePromiseAtPostResolution,I,N),b},e.prototype._settlePromiseAtPostResolution=function(o){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(o)},e.prototype._length=function(){return this._bitField&131071},e.prototype._isFollowingOrFulfilledOrRejected=function(){return(this._bitField&939524096)>0},e.prototype._isFollowing=function(){return(this._bitField&536870912)===536870912},e.prototype._setLength=function(o){this._bitField=this._bitField&-131072|o&131071},e.prototype._setFulfilled=function(){this._bitField=this._bitField|268435456},e.prototype._setRejected=function(){this._bitField=this._bitField|134217728},e.prototype._setFollowing=function(){this._bitField=this._bitField|536870912},e.prototype._setIsFinal=function(){this._bitField=this._bitField|33554432},e.prototype._isFinal=function(){return(this._bitField&33554432)>0},e.prototype._cancellable=function(){return(this._bitField&67108864)>0},e.prototype._setCancellable=function(){this._bitField=this._bitField|67108864},e.prototype._unsetCancellable=function(){this._bitField=this._bitField&-67108865},e.prototype._setIsMigrated=function(){this._bitField=this._bitField|4194304},e.prototype._unsetIsMigrated=function(){this._bitField=this._bitField&-4194305},e.prototype._isMigrated=function(){return(this._bitField&4194304)>0},e.prototype._receiverAt=function(o){var a=o===0?this._receiver0:this[o*5-5+4];if(a!==E)return a===void 0&&this._isBound()?this._boundValue():a},e.prototype._promiseAt=function(o){return o===0?this._promise0:this[o*5-5+3]},e.prototype._fulfillmentHandlerAt=function(o){return o===0?this._fulfillmentHandler0:this[o*5-5+0]},e.prototype._rejectionHandlerAt=function(o){return o===0?this._rejectionHandler0:this[o*5-5+1]},e.prototype._boundValue=function(){var o=this._boundTo;return o!==void 0&&o instanceof e?o.isFulfilled()?o.value():void 0:o},e.prototype._migrateCallbacks=function(o,a){var k=o._fulfillmentHandlerAt(a),T=o._rejectionHandlerAt(a),C=o._progressHandlerAt(a),D=o._promiseAt(a),b=o._receiverAt(a);D instanceof e&&D._setIsMigrated(),b===void 0&&(b=E),this._addCallbacks(k,T,C,D,b,null)},e.prototype._addCallbacks=function(o,a,k,T,C,D){var b=this._length();if(b>=131071-5&&(b=0,this._setLength(0)),b===0)this._promise0=T,C!==void 0&&(this._receiver0=C),typeof o=="function"&&!this._isCarryingStackTrace()&&(this._fulfillmentHandler0=D===null?o:D.bind(o)),typeof a=="function"&&(this._rejectionHandler0=D===null?a:D.bind(a)),typeof k=="function"&&(this._progressHandler0=D===null?k:D.bind(k));else{var I=b*5-5;this[I+3]=T,this[I+4]=C,typeof o=="function"&&(this[I+0]=D===null?o:D.bind(o)),typeof a=="function"&&(this[I+1]=D===null?a:D.bind(a)),typeof k=="function"&&(this[I+2]=D===null?k:D.bind(k))}return this._setLength(b+1),b},e.prototype._setProxyHandlers=function(o,a){var k=this._length();if(k>=131071-5&&(k=0,this._setLength(0)),k===0)this._promise0=a,this._receiver0=o;else{var T=k*5-5;this[T+3]=a,this[T+4]=o}this._setLength(k+1)},e.prototype._proxyPromiseArray=function(o,a){this._setProxyHandlers(o,a)},e.prototype._resolveCallback=function(o,a){if(!this._isFollowingOrFulfilledOrRejected()){if(o===this)return this._rejectCallback(t(),!1,!0);var k=m(o,this);if(!(k instanceof e))return this._fulfill(o);var T=1|(a?4:0);this._propagateFrom(k,T);var C=k._target();if(C._isPending()){for(var D=this._length(),b=0;b<D;++b)C._migrateCallbacks(this,b);this._setFollowing(),this._setLength(0),this._setFollowee(C)}else C._isFulfilled()?this._fulfillUnchecked(C._value()):this._rejectUnchecked(C._reason(),C._getCarriedStackTrace())}},e.prototype._rejectCallback=function(o,a,k){k||_.markAsOriginatingFromRejection(o);var T=_.ensureErrorObject(o),C=T===o;this._attachExtraTrace(T,a?C:!1),this._reject(o,C?void 0:T)},e.prototype._resolveFromResolver=function(o){var a=this;this._captureStackTrace(),this._pushContext();var k=!0,T=x(o)(function(C){a!==null&&(a._resolveCallback(C),a=null)},function(C){a!==null&&(a._rejectCallback(C,k),a=null)});k=!1,this._popContext(),T!==void 0&&T===O&&a!==null&&(a._rejectCallback(T.e,!0,!0),a=null)},e.prototype._settlePromiseFromHandler=function(o,a,k,T){if(!T._isRejected()){T._pushContext();var C;if(a===u&&!this._isRejected()?C=x(o).apply(this._boundValue(),k):C=x(o).call(a,k),T._popContext(),C===O||C===T||C===l){var D=C===T?t():C.e;T._rejectCallback(D,!1,!0)}else T._resolveCallback(C)}},e.prototype._target=function(){for(var o=this;o._isFollowing();)o=o._followee();return o},e.prototype._followee=function(){return this._rejectionHandler0},e.prototype._setFollowee=function(o){this._rejectionHandler0=o},e.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},e.prototype._propagateFrom=function(o,a){(a&1)>0&&o._cancellable()&&(this._setCancellable(),this._cancellationParent=o),(a&4)>0&&o._isBound()&&this._setBoundTo(o._boundTo)},e.prototype._fulfill=function(o){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(o)},e.prototype._reject=function(o,a){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(o,a)},e.prototype._settlePromiseAt=function(o){var a=this._promiseAt(o),k=a instanceof e;if(k&&a._isMigrated())return a._unsetIsMigrated(),g.invoke(this._settlePromiseAt,this,o);var T=this._isFulfilled()?this._fulfillmentHandlerAt(o):this._rejectionHandlerAt(o),C=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,D=this._settledValue,b=this._receiverAt(o);this._clearCallbackDataAtIndex(o),typeof T=="function"?k?this._settlePromiseFromHandler(T,b,D,a):T.call(b,D,a):b instanceof c?b._isResolved()||(this._isFulfilled()?b._promiseFulfilled(D,a):b._promiseRejected(D,a)):k&&(this._isFulfilled()?a._fulfill(D):a._reject(D,C)),o>=4&&(o&31)===4&&g.invokeLater(this._setLength,this,0)},e.prototype._clearCallbackDataAtIndex=function(o){if(o===0)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var a=o*5-5;this[a+3]=this[a+4]=this[a+0]=this[a+1]=this[a+2]=void 0}},e.prototype._isSettlePromisesQueued=function(){return(this._bitField&-1073741824)===-1073741824},e.prototype._setSettlePromisesQueued=function(){this._bitField=this._bitField|-1073741824},e.prototype._unsetSettlePromisesQueued=function(){this._bitField=this._bitField&1073741823},e.prototype._queueSettlePromises=function(){g.settlePromises(this),this._setSettlePromisesQueued()},e.prototype._fulfillUnchecked=function(o){if(o===this){var a=t();return this._attachExtraTrace(a),this._rejectUnchecked(a,void 0)}this._setFulfilled(),this._settledValue=o,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},e.prototype._rejectUncheckedCheckError=function(o){var a=_.ensureErrorObject(o);this._rejectUnchecked(o,a===o?void 0:a)},e.prototype._rejectUnchecked=function(o,a){if(o===this){var k=t();return this._attachExtraTrace(k),this._rejectUnchecked(k)}if(this._setRejected(),this._settledValue=o,this._cleanValues(),this._isFinal()){g.throwLater(function(T){throw"stack"in T&&g.invokeFirst(R.unhandledRejection,void 0,T),T},a===void 0?o:a);return}a!==void 0&&a!==o&&this._setCarriedStackTrace(a),this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()},e.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var o=this._length(),a=0;a<o;a++)this._settlePromiseAt(a)},_.notEnumerableProp(e,"_makeSelfResolutionError",t),i("./progress.js")(e,c),i("./method.js")(e,s,m,p),i("./bind.js")(e,s,m),i("./finally.js")(e,l,m),i("./direct_resolve.js")(e),i("./synchronous_inspection.js")(e),i("./join.js")(e,c,m,s),e.version="2.11.0",e.Promise=e,i("./map.js")(e,c,p,m,s),i("./cancel.js")(e),i("./using.js")(e,p,m,j),i("./generators.js")(e,p,s,m),i("./nodeify.js")(e),i("./call_get.js")(e),i("./props.js")(e,c,m,p),i("./race.js")(e,s,m,p),i("./reduce.js")(e,c,p,m,s),i("./settle.js")(e,c),i("./some.js")(e,c,p),i("./promisify.js")(e,s),i("./any.js")(e),i("./each.js")(e,s),i("./timers.js")(e,s),i("./filter.js")(e,s),_.toFastProperties(e),_.toFastProperties(e.prototype);function A(o){var a=new e(s);a._fulfillmentHandler0=o,a._rejectionHandler0=o,a._progressHandler0=o,a._promise0=o,a._receiver0=o,a._settledValue=o}return A({a:1}),A({b:2}),A({c:3}),A(1),A(function(){}),A(void 0),A(!1),A(new e(s)),R.setBounds(g.firstLineError,_.lastLineError),e}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./context.js":9,"./debuggability.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./filter.js":15,"./finally.js":16,"./generators.js":17,"./join.js":18,"./map.js":19,"./method.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38}],24:[function(i,n,F){n.exports=function(t,y,p,_){var v=i("./util.js"),E=v.isArray;function g(d){switch(d){case-2:return[];case-3:return{}}}function h(d){var s=this._promise=new t(y),u;d instanceof t&&(u=d,s._propagateFrom(u,5)),this._values=d,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return h.prototype.length=function(){return this._length},h.prototype.promise=function(){return this._promise},h.prototype._init=function d(s,u){var l=p(this._values,this._promise);if(l instanceof t)if(l=l._target(),this._values=l,l._isFulfilled()){if(l=l._value(),!E(l)){var m=new t.TypeError(`expecting an array, a promise or a thenable

    See http://goo.gl/s8MMhc
`);this.__hardReject__(m);return}}else if(l._isPending()){l._then(d,this._reject,void 0,this,u);return}else{this._reject(l._reason());return}else if(!E(l)){this._promise._reject(_(`expecting an array, a promise or a thenable

    See http://goo.gl/s8MMhc
`)._reason());return}if(l.length===0){u===-5?this._resolveEmptyArray():this._resolve(g(u));return}var c=this.getActualLength(l.length);this._length=c,this._values=this.shouldCopyValues()?new Array(c):this._values;for(var R=this._promise,S=0;S<c;++S){var j=this._isResolved(),w=p(l[S],R);w instanceof t?(w=w._target(),j?w._ignoreRejections():w._isPending()?w._proxyPromiseArray(this,S):w._isFulfilled()?this._promiseFulfilled(w._value(),S):this._promiseRejected(w._reason(),S)):j||this._promiseFulfilled(w,S)}},h.prototype._isResolved=function(){return this._values===null},h.prototype._resolve=function(d){this._values=null,this._promise._fulfill(d)},h.prototype.__hardReject__=h.prototype._reject=function(d){this._values=null,this._promise._rejectCallback(d,!1,!0)},h.prototype._promiseProgressed=function(d,s){this._promise._progress({index:s,value:d})},h.prototype._promiseFulfilled=function(d,s){this._values[s]=d;var u=++this._totalResolved;u>=this._length&&this._resolve(this._values)},h.prototype._promiseRejected=function(d,s){this._totalResolved++,this._reject(d)},h.prototype.shouldCopyValues=function(){return!0},h.prototype.getActualLength=function(d){return d},h}},{"./util.js":38}],25:[function(i,n,F){var t=i("./util.js"),y=t.maybeWrapAsError,p=i("./errors.js"),_=p.TimeoutError,v=p.OperationalError,E=t.haveGetters,g=i("./es5.js");function h(c){return c instanceof Error&&g.getPrototypeOf(c)===Error.prototype}var d=/^(?:name|message|stack|cause)$/;function s(c){var R;if(h(c)){R=new v(c),R.name=c.name,R.message=c.message,R.stack=c.stack;for(var S=g.keys(c),j=0;j<S.length;++j){var w=S[j];d.test(w)||(R[w]=c[w])}return R}return t.markAsOriginatingFromRejection(c),c}function u(c){return function(R,S){if(c!==null){if(R){var j=s(y(R));c._attachExtraTrace(j),c._reject(j)}else if(arguments.length>2){for(var w=arguments.length,U=new Array(w-1),L=1;L<w;++L)U[L-1]=arguments[L];c._fulfill(U)}else c._fulfill(S);c=null}}}var l;if(E?l=function(c){this.promise=c}:l=function(c){this.promise=c,this.asCallback=u(c),this.callback=this.asCallback},E){var m={get:function(){return u(this.promise)}};g.defineProperty(l.prototype,"asCallback",m),g.defineProperty(l.prototype,"callback",m)}l._nodebackForPromise=u,l.prototype.toString=function(){return"[object PromiseResolver]"},l.prototype.resolve=l.prototype.fulfill=function(c){if(!(this instanceof l))throw new TypeError(`Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.

    See http://goo.gl/sdkXL9
`);this.promise._resolveCallback(c)},l.prototype.reject=function(c){if(!(this instanceof l))throw new TypeError(`Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.

    See http://goo.gl/sdkXL9
`);this.promise._rejectCallback(c)},l.prototype.progress=function(c){if(!(this instanceof l))throw new TypeError(`Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.

    See http://goo.gl/sdkXL9
`);this.promise._progress(c)},l.prototype.cancel=function(c){this.promise.cancel(c)},l.prototype.timeout=function(){this.reject(new _("timeout"))},l.prototype.isResolved=function(){return this.promise.isResolved()},l.prototype.toJSON=function(){return this.promise.toJSON()},n.exports=l},{"./errors.js":13,"./es5.js":14,"./util.js":38}],26:[function(i,n,F){n.exports=function(t,y){var p={},_=i("./util.js"),v=i("./promise_resolver.js")._nodebackForPromise,E=_.withAppended,g=_.maybeWrapAsError,h=_.canEvaluate,d=i("./errors").TypeError,s="Async",u={__isPromisified__:!0},l=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],m=new RegExp("^(?:"+l.join("|")+")$"),c=function(a){return _.isIdentifier(a)&&a.charAt(0)!=="_"&&a!=="constructor"};function R(a){return!m.test(a)}function S(a){try{return a.__isPromisified__===!0}catch{return!1}}function j(a,k,T){var C=_.getDataPropertyOrDefault(a,k+T,u);return C?S(C):!1}function w(a,k,T){for(var C=0;C<a.length;C+=2){var D=a[C];if(T.test(D)){for(var b=D.replace(T,""),I=0;I<a.length;I+=2)if(a[I]===b)throw new d(`Cannot promisify an API that has normal methods with '%s'-suffix

    See http://goo.gl/iWrZbw
`.replace("%s",k))}}}function U(a,k,T,C){for(var D=_.inheritedDataKeys(a),b=[],I=0;I<D.length;++I){var N=D[I],H=a[N],P=C===c?!0:c(N);typeof H=="function"&&!S(H)&&!j(a,N,k)&&C(N,H,a,P)&&b.push(N,H)}return w(b,k,T),b}var L=function(a){return a.replace(/([$])/,"\\$")},O;function x(a,k,T,C){var D=function(){return this}(),b=a;typeof b=="string"&&(a=C);function I(){var N=k;k===p&&(N=this);var H=new t(y);H._captureStackTrace();var P=typeof b=="string"&&this!==D?this[b]:a,B=v(H);try{P.apply(N,E(arguments,B))}catch(z){H._rejectCallback(g(z),!0,!0)}return H}return _.notEnumerableProp(I,"__isPromisified__",!0),I}var e=h?O:x;function A(a,k,T,C){for(var D=new RegExp(L(k)+"$"),b=U(a,k,D,T),I=0,N=b.length;I<N;I+=2){var H=b[I],P=b[I+1],B=H+k;if(C===e)a[B]=e(H,p,H,P,k);else{var z=C(P,function(){return e(H,p,H,P,k)});_.notEnumerableProp(z,"__isPromisified__",!0),a[B]=z}}return _.toFastProperties(a),a}function o(a,k){return e(a,k,void 0,a)}t.promisify=function(a,k){if(typeof a!="function")throw new d(`fn must be a function

    See http://goo.gl/916lJJ
`);if(S(a))return a;var T=o(a,arguments.length<2?p:k);return _.copyDescriptors(a,T,R),T},t.promisifyAll=function(a,k){if(typeof a!="function"&&typeof a!="object")throw new d(`the target of promisifyAll must be an object or a function

    See http://goo.gl/9ITlV0
`);k=Object(k);var T=k.suffix;typeof T!="string"&&(T=s);var C=k.filter;typeof C!="function"&&(C=c);var D=k.promisifier;if(typeof D!="function"&&(D=e),!_.isIdentifier(T))throw new RangeError(`suffix must be a valid identifier

    See http://goo.gl/8FZo5V
`);for(var b=_.inheritedDataKeys(a),I=0;I<b.length;++I){var N=a[b[I]];b[I]!=="constructor"&&_.isClass(N)&&(A(N.prototype,T,C,D),A(N,T,C,D))}return A(a,T,C,D)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(i,n,F){n.exports=function(t,y,p,_){var v=i("./util.js"),E=v.isObject,g=i("./es5.js");function h(s){for(var u=g.keys(s),l=u.length,m=new Array(l*2),c=0;c<l;++c){var R=u[c];m[c]=s[R],m[c+l]=R}this.constructor$(m)}v.inherits(h,y),h.prototype._init=function(){this._init$(void 0,-3)},h.prototype._promiseFulfilled=function(s,u){this._values[u]=s;var l=++this._totalResolved;if(l>=this._length){for(var m={},c=this.length(),R=0,S=this.length();R<S;++R)m[this._values[R+c]]=this._values[R];this._resolve(m)}},h.prototype._promiseProgressed=function(s,u){this._promise._progress({key:this._values[u+this.length()],value:s})},h.prototype.shouldCopyValues=function(){return!1},h.prototype.getActualLength=function(s){return s>>1};function d(s){var u,l=p(s);if(E(l))l instanceof t?u=l._then(t.props,void 0,void 0,void 0,void 0):u=new h(l).promise();else return _(`cannot await properties of a non-object

    See http://goo.gl/OsFKC8
`);return l instanceof t&&u._propagateFrom(l,4),u}t.prototype.props=function(){return d(this)},t.props=function(s){return d(s)}}},{"./es5.js":14,"./util.js":38}],28:[function(i,n,F){function t(p,_,v,E,g){for(var h=0;h<g;++h)v[h+E]=p[h+_],p[h+_]=void 0}function y(p){this._capacity=p,this._length=0,this._front=0}y.prototype._willBeOverCapacity=function(p){return this._capacity<p},y.prototype._pushOne=function(p){var _=this.length();this._checkCapacity(_+1);var v=this._front+_&this._capacity-1;this[v]=p,this._length=_+1},y.prototype._unshiftOne=function(p){var _=this._capacity;this._checkCapacity(this.length()+1);var v=this._front,E=(v-1&_-1^_)-_;this[E]=p,this._front=E,this._length=this.length()+1},y.prototype.unshift=function(p,_,v){this._unshiftOne(v),this._unshiftOne(_),this._unshiftOne(p)},y.prototype.push=function(p,_,v){var E=this.length()+3;if(this._willBeOverCapacity(E)){this._pushOne(p),this._pushOne(_),this._pushOne(v);return}var g=this._front+E-3;this._checkCapacity(E);var h=this._capacity-1;this[g+0&h]=p,this[g+1&h]=_,this[g+2&h]=v,this._length=E},y.prototype.shift=function(){var p=this._front,_=this[p];return this[p]=void 0,this._front=p+1&this._capacity-1,this._length--,_},y.prototype.length=function(){return this._length},y.prototype._checkCapacity=function(p){this._capacity<p&&this._resizeTo(this._capacity<<1)},y.prototype._resizeTo=function(p){var _=this._capacity;this._capacity=p;var v=this._front,E=this._length,g=v+E&_-1;t(this,0,this,_,g)},n.exports=y},{}],29:[function(i,n,F){n.exports=function(t,y,p,_){var v=i("./util.js").isArray,E=function(h){return h.then(function(d){return g(d,h)})};function g(h,d){var s=p(h);if(s instanceof t)return E(s);if(!v(h))return _(`expecting an array, a promise or a thenable

    See http://goo.gl/s8MMhc
`);var u=new t(y);d!==void 0&&u._propagateFrom(d,5);for(var l=u._fulfill,m=u._reject,c=0,R=h.length;c<R;++c){var S=h[c];S===void 0&&!(c in h)||t.cast(S)._then(l,m,void 0,u,null)}return u}t.race=function(h){return g(h,void 0)},t.prototype.race=function(){return g(this,void 0)}}},{"./util.js":38}],30:[function(i,n,F){n.exports=function(t,y,p,_,v){var E=t._getDomain,g=i("./async.js"),h=i("./util.js"),d=h.tryCatch,s=h.errorObj;function u(c,R,S,j){this.constructor$(c),this._promise._captureStackTrace(),this._preservedValues=j===v?[]:null,this._zerothIsAccum=S===void 0,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var w=_(S,this._promise),U=!1,L=w instanceof t;L&&(w=w._target(),w._isPending()?w._proxyPromiseArray(this,-1):w._isFulfilled()?(S=w._value(),this._gotAccum=!0):(this._reject(w._reason()),U=!0)),L||this._zerothIsAccum||(this._gotAccum=!0);var O=E();this._callback=O===null?R:O.bind(R),this._accum=S,U||g.invoke(l,this,void 0)}function l(){this._init$(void 0,-5)}h.inherits(u,y),u.prototype._init=function(){},u.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(this._preservedValues!==null?[]:this._accum)},u.prototype._promiseFulfilled=function(c,R){var S=this._values;S[R]=c;var j=this.length(),w=this._preservedValues,U=w!==null,L=this._gotAccum,O=this._valuesPhase,x;if(!O)for(O=this._valuesPhase=new Array(j),x=0;x<j;++x)O[x]=0;if(x=O[R],R===0&&this._zerothIsAccum?(this._accum=c,this._gotAccum=L=!0,O[R]=x===0?1:2):R===-1?(this._accum=c,this._gotAccum=L=!0):x===0?O[R]=1:(O[R]=2,this._accum=c),!!L){for(var e=this._callback,A=this._promise._boundValue(),o,a=this._reducingIndex;a<j;++a){if(x=O[a],x===2){this._reducingIndex=a+1;continue}if(x!==1)return;if(c=S[a],this._promise._pushContext(),U?(w.push(c),o=d(e).call(A,c,a,j)):o=d(e).call(A,this._accum,c,a,j),this._promise._popContext(),o===s)return this._reject(o.e);var k=_(o,this._promise);if(k instanceof t){if(k=k._target(),k._isPending())return O[a]=4,k._proxyPromiseArray(this,a);if(k._isFulfilled())o=k._value();else return this._reject(k._reason())}this._reducingIndex=a+1,this._accum=o}this._resolve(U?w:this._accum)}};function m(c,R,S,j){if(typeof R!="function")return p(`fn must be a function

    See http://goo.gl/916lJJ
`);var w=new u(c,R,S,j);return w.promise()}t.prototype.reduce=function(c,R){return m(this,c,R,null)},t.reduce=function(c,R,S,j){return m(c,R,S,j)}}},{"./async.js":2,"./util.js":38}],31:[function(i,n,F){var t,y=i("./util"),p=function(){throw new Error(`No async scheduler available

    See http://goo.gl/m3OTXk
`)};if(y.isNode&&typeof MutationObserver>"u"){var _=at.setImmediate,v=process.nextTick;t=y.isRecentNode?function(E){_.call(at,E)}:function(E){v.call(process,E)}}else typeof MutationObserver<"u"&&!(typeof window<"u"&&window.navigator&&window.navigator.standalone)?(t=function(E){var g=document.createElement("div"),h=new MutationObserver(E);return h.observe(g,{attributes:!0}),function(){g.classList.toggle("foo")}},t.isStatic=!0):typeof setImmediate<"u"?t=function(E){setImmediate(E)}:typeof setTimeout<"u"?t=function(E){setTimeout(E,0)}:t=p;n.exports=t},{"./util":38}],32:[function(i,n,F){n.exports=function(t,y){var p=t.PromiseInspection,_=i("./util.js");function v(E){this.constructor$(E)}_.inherits(v,y),v.prototype._promiseResolved=function(E,g){this._values[E]=g;var h=++this._totalResolved;h>=this._length&&this._resolve(this._values)},v.prototype._promiseFulfilled=function(E,g){var h=new p;h._bitField=268435456,h._settledValue=E,this._promiseResolved(g,h)},v.prototype._promiseRejected=function(E,g){var h=new p;h._bitField=134217728,h._settledValue=E,this._promiseResolved(g,h)},t.settle=function(E){return new v(E).promise()},t.prototype.settle=function(){return new v(this).promise()}}},{"./util.js":38}],33:[function(i,n,F){n.exports=function(t,y,p){var _=i("./util.js"),v=i("./errors.js").RangeError,E=i("./errors.js").AggregateError,g=_.isArray;function h(s){this.constructor$(s),this._howMany=0,this._unwrap=!1,this._initialized=!1}_.inherits(h,y),h.prototype._init=function(){if(this._initialized){if(this._howMany===0){this._resolve([]);return}this._init$(void 0,-5);var s=g(this._values);!this._isResolved()&&s&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},h.prototype.init=function(){this._initialized=!0,this._init()},h.prototype.setUnwrap=function(){this._unwrap=!0},h.prototype.howMany=function(){return this._howMany},h.prototype.setHowMany=function(s){this._howMany=s},h.prototype._promiseFulfilled=function(s){this._addFulfilled(s),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this.howMany()===1&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},h.prototype._promiseRejected=function(s){if(this._addRejected(s),this.howMany()>this._canPossiblyFulfill()){for(var u=new E,l=this.length();l<this._values.length;++l)u.push(this._values[l]);this._reject(u)}},h.prototype._fulfilled=function(){return this._totalResolved},h.prototype._rejected=function(){return this._values.length-this.length()},h.prototype._addRejected=function(s){this._values.push(s)},h.prototype._addFulfilled=function(s){this._values[this._totalResolved++]=s},h.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},h.prototype._getRangeError=function(s){var u="Input array must contain at least "+this._howMany+" items but contains only "+s+" items";return new v(u)},h.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};function d(s,u){if((u|0)!==u||u<0)return p(`expecting a positive integer

    See http://goo.gl/1wAmHx
`);var l=new h(s),m=l.promise();return l.setHowMany(u),l.init(),m}t.some=function(s,u){return d(s,u)},t.prototype.some=function(s){return d(this,s)},t._SomePromiseArray=h}},{"./errors.js":13,"./util.js":38}],34:[function(i,n,F){n.exports=function(t){function y(p){p!==void 0?(p=p._target(),this._bitField=p._bitField,this._settledValue=p._settledValue):(this._bitField=0,this._settledValue=void 0)}y.prototype.value=function(){if(!this.isFulfilled())throw new TypeError(`cannot get fulfillment value of a non-fulfilled promise

    See http://goo.gl/hc1DLj
`);return this._settledValue},y.prototype.error=y.prototype.reason=function(){if(!this.isRejected())throw new TypeError(`cannot get rejection reason of a non-rejected promise

    See http://goo.gl/hPuiwB
`);return this._settledValue},y.prototype.isFulfilled=t.prototype._isFulfilled=function(){return(this._bitField&268435456)>0},y.prototype.isRejected=t.prototype._isRejected=function(){return(this._bitField&134217728)>0},y.prototype.isPending=t.prototype._isPending=function(){return(this._bitField&402653184)===0},y.prototype.isResolved=t.prototype._isResolved=function(){return(this._bitField&402653184)>0},t.prototype.isPending=function(){return this._target()._isPending()},t.prototype.isRejected=function(){return this._target()._isRejected()},t.prototype.isFulfilled=function(){return this._target()._isFulfilled()},t.prototype.isResolved=function(){return this._target()._isResolved()},t.prototype._value=function(){return this._settledValue},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},t.prototype.value=function(){var p=this._target();if(!p.isFulfilled())throw new TypeError(`cannot get fulfillment value of a non-fulfilled promise

    See http://goo.gl/hc1DLj
`);return p._settledValue},t.prototype.reason=function(){var p=this._target();if(!p.isRejected())throw new TypeError(`cannot get rejection reason of a non-rejected promise

    See http://goo.gl/hPuiwB
`);return p._unsetRejectionIsUnhandled(),p._settledValue},t.PromiseInspection=y}},{}],35:[function(i,n,F){n.exports=function(t,y){var p=i("./util.js"),_=p.errorObj,v=p.isObject;function E(u,l){if(v(u)){if(u instanceof t)return u;if(d(u)){var m=new t(y);return u._then(m._fulfillUnchecked,m._rejectUncheckedCheckError,m._progressUnchecked,m,null),m}var c=p.tryCatch(g)(u);if(c===_){l&&l._pushContext();var m=t.reject(c.e);return l&&l._popContext(),m}else if(typeof c=="function")return s(u,c,l)}return u}function g(u){return u.then}var h={}.hasOwnProperty;function d(u){return h.call(u,"_promise0")}function s(u,l,m){var c=new t(y),R=c;m&&m._pushContext(),c._captureStackTrace(),m&&m._popContext();var S=!0,j=p.tryCatch(l).call(u,w,U,L);S=!1,c&&j===_&&(c._rejectCallback(j.e,!0,!0),c=null);function w(O){c&&(c._resolveCallback(O),c=null)}function U(O){c&&(c._rejectCallback(O,S,!0),c=null)}function L(O){c&&typeof c._progress=="function"&&c._progress(O)}return R}return E}},{"./util.js":38}],36:[function(i,n,F){n.exports=function(t,y){var p=i("./util.js"),_=t.TimeoutError,v=function(s,u){if(s.isPending()){var l;!p.isPrimitive(u)&&u instanceof Error?l=u:(typeof u!="string"&&(u="operation timed out"),l=new _(u)),p.markAsOriginatingFromRejection(l),s._attachExtraTrace(l),s._cancel(l)}},E=function(s){return g(+this).thenReturn(s)},g=t.delay=function(s,u){if(u===void 0){u=s,s=void 0;var l=new t(y);return setTimeout(function(){l._fulfill()},u),l}return u=+u,t.resolve(s)._then(E,null,null,u,void 0)};t.prototype.delay=function(s){return g(this,s)};function h(s){var u=this;return u instanceof Number&&(u=+u),clearTimeout(u),s}function d(s){var u=this;throw u instanceof Number&&(u=+u),clearTimeout(u),s}t.prototype.timeout=function(s,u){s=+s;var l=this.then().cancellable();l._cancellationParent=this;var m=setTimeout(function(){v(l,u)},s);return l._then(h,d,void 0,m,void 0)}}},{"./util.js":38}],37:[function(i,n,F){n.exports=function(t,y,p,_){var v=i("./errors.js").TypeError,E=i("./util.js").inherits,g=t.PromiseInspection;function h(j){for(var w=j.length,U=0;U<w;++U){var L=j[U];if(L.isRejected())return t.reject(L.error());j[U]=L._settledValue}return j}function d(j){setTimeout(function(){throw j},0)}function s(j){var w=p(j);return w!==j&&typeof j._isDisposable=="function"&&typeof j._getDisposer=="function"&&j._isDisposable()&&w._setDisposable(j._getDisposer()),w}function u(j,w){var U=0,L=j.length,O=t.defer();function x(){if(U>=L)return O.resolve();var e=s(j[U++]);if(e instanceof t&&e._isDisposable()){try{e=p(e._getDisposer().tryDispose(w),j.promise)}catch(A){return d(A)}if(e instanceof t)return e._then(x,d,null,null,null)}x()}return x(),O.promise}function l(j){var w=new g;return w._settledValue=j,w._bitField=268435456,u(this,w).thenReturn(j)}function m(j){var w=new g;return w._settledValue=j,w._bitField=134217728,u(this,w).thenThrow(j)}function c(j,w,U){this._data=j,this._promise=w,this._context=U}c.prototype.data=function(){return this._data},c.prototype.promise=function(){return this._promise},c.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},c.prototype.tryDispose=function(j){var w=this.resource(),U=this._context;U!==void 0&&U._pushContext();var L=w!==null?this.doDispose(w,j):null;return U!==void 0&&U._popContext(),this._promise._unsetDisposable(),this._data=null,L},c.isDisposer=function(j){return j!=null&&typeof j.resource=="function"&&typeof j.tryDispose=="function"};function R(j,w,U){this.constructor$(j,w,U)}E(R,c),R.prototype.doDispose=function(j,w){var U=this.data();return U.call(j,j,w)};function S(j){return c.isDisposer(j)?(this.resources[this.index]._setDisposable(j),j.promise()):j}t.using=function(){var j=arguments.length;if(j<2)return y("you must pass at least 2 arguments to Promise.using");var w=arguments[j-1];if(typeof w!="function")return y(`fn must be a function

    See http://goo.gl/916lJJ
`);var U,L=!0;j===2&&Array.isArray(arguments[0])?(U=arguments[0],j=U.length,L=!1):(U=arguments,j--);for(var O=new Array(j),x=0;x<j;++x){var e=U[x];if(c.isDisposer(e)){var A=e;e=e.promise(),e._setDisposable(A)}else{var o=p(e);o instanceof t&&(e=o._then(S,null,null,{resources:O,index:x},void 0))}O[x]=e}var a=t.settle(O).then(h).then(function(k){a._pushContext();var T;try{T=L?w.apply(void 0,k):w.call(void 0,k)}finally{a._popContext()}return T})._then(l,m,void 0,O,void 0);return O.promise=a,a},t.prototype._setDisposable=function(j){this._bitField=this._bitField|262144,this._disposer=j},t.prototype._isDisposable=function(){return(this._bitField&262144)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=this._bitField&-262145,this._disposer=void 0},t.prototype.disposer=function(j){if(typeof j=="function")return new R(j,this,_());throw new v}}},{"./errors.js":13,"./util.js":38}],38:[function(i,n,F){var t=i("./es5.js"),y=typeof navigator>"u",p=function(){try{var b={};return t.defineProperty(b,"f",{get:function(){return 3}}),b.f===3}catch{return!1}}(),_={e:{}},v;function E(){try{var b=v;return v=null,b.apply(this,arguments)}catch(I){return _.e=I,_}}function g(b){return v=b,E}var h=function(b,I){var N={}.hasOwnProperty;function H(){this.constructor=b,this.constructor$=I;for(var P in I.prototype)N.call(I.prototype,P)&&P.charAt(P.length-1)!=="$"&&(this[P+"$"]=I.prototype[P])}return H.prototype=I.prototype,b.prototype=new H,b.prototype};function d(b){return b==null||b===!0||b===!1||typeof b=="string"||typeof b=="number"}function s(b){return!d(b)}function u(b){return d(b)?new Error(e(b)):b}function l(b,I){var N=b.length,H=new Array(N+1),P;for(P=0;P<N;++P)H[P]=b[P];return H[P]=I,H}function m(b,I,N){if(t.isES5){var H=Object.getOwnPropertyDescriptor(b,I);if(H!=null)return H.get==null&&H.set==null?H.value:N}else return{}.hasOwnProperty.call(b,I)?b[I]:void 0}function c(b,I,N){if(d(b))return b;var H={value:N,configurable:!0,enumerable:!1,writable:!0};return t.defineProperty(b,I,H),b}function R(b){throw b}var S=function(){var b=[Array.prototype,Object.prototype,Function.prototype],I=function(P){for(var B=0;B<b.length;++B)if(b[B]===P)return!0;return!1};if(t.isES5){var N=Object.getOwnPropertyNames;return function(P){for(var B=[],z=Object.create(null);P!=null&&!I(P);){var G;try{G=N(P)}catch{return B}for(var nt=0;nt<G.length;++nt){var et=G[nt];if(!z[et]){z[et]=!0;var it=Object.getOwnPropertyDescriptor(P,et);it!=null&&it.get==null&&it.set==null&&B.push(et)}}P=t.getPrototypeOf(P)}return B}}else{var H={}.hasOwnProperty;return function(P){if(I(P))return[];var B=[];t:for(var z in P)if(H.call(P,z))B.push(z);else{for(var G=0;G<b.length;++G)if(H.call(b[G],z))continue t;B.push(z)}return B}}}(),j=/this\s*\.\s*\S+\s*=/;function w(b){try{if(typeof b=="function"){var I=t.names(b.prototype),N=t.isES5&&I.length>1,H=I.length>0&&!(I.length===1&&I[0]==="constructor"),P=j.test(b+"")&&t.names(b).length>0;if(N||H||P)return!0}return!1}catch{return!1}}function U(b){return b}var L=/^[a-z$_][a-z$_0-9]*$/i;function O(b){return L.test(b)}function x(b,I,N){for(var H=new Array(b),P=0;P<b;++P)H[P]=I+P+N;return H}function e(b){try{return b+""}catch{return"[no string representation]"}}function A(b){try{c(b,"isOperational",!0)}catch{}}function o(b){return b==null?!1:b instanceof Error.__BluebirdErrorTypes__.OperationalError||b.isOperational===!0}function a(b){return b instanceof Error&&t.propertyIsWritable(b,"stack")}var k=function(){return"stack"in new Error?function(b){return a(b)?b:new Error(e(b))}:function(b){if(a(b))return b;try{throw new Error(e(b))}catch(I){return I}}}();function T(b){return{}.toString.call(b)}function C(b,I,N){for(var H=t.names(b),P=0;P<H.length;++P){var B=H[P];if(N(B))try{t.defineProperty(I,B,t.getDescriptor(b,B))}catch{}}}var D={isClass:w,isIdentifier:O,inheritedDataKeys:S,getDataPropertyOrDefault:m,thrower:R,isArray:t.isArray,haveGetters:p,notEnumerableProp:c,isPrimitive:d,isObject:s,canEvaluate:y,errorObj:_,tryCatch:g,inherits:h,withAppended:l,maybeWrapAsError:u,toFastProperties:U,filledRange:x,toString:e,canAttachTrace:a,ensureErrorObject:k,originatesFromRejection:o,markAsOriginatingFromRejection:A,classString:T,copyDescriptors:C,hasDevTools:typeof chrome<"u"&&chrome&&typeof chrome.loadTimes=="function",isNode:typeof process<"u"&&T(process).toLowerCase()==="[object process]"};D.isRecentNode=D.isNode&&function(){var b=process.versions.node.split(".").map(Number);return b[0]===0&&b[1]>10||b[0]>0}(),D.isNode&&D.toFastProperties(process);try{throw new Error}catch(b){D.lastLineError=b}n.exports=D},{"./es5.js":14}]},{},[4])(4)}),typeof window<"u"&&window!==null?window.P=window.Promise:typeof self<"u"&&self!==null&&(self.P=self.Promise)})(_t);var lt=_t.exports,vt=pt,yt=ct,gt=lt;Z.prototype=Object.create(vt.prototype);Z.prototype.constructor=Z;function Z(r,f){vt.call(this,r,f),this.baseURL=this.baseURL+"/checkout-invoice"}Z.prototype.create=function(){var r=this,f=r.generateRequestBody();return new gt(function(i,n){yt.post(r.baseURL+"/create").set(r.config).send(f).end(function(F,t){if(F)return n(F);if(t.body.response_code==="00")r.token=t.body.token,r.url=t.body.response_text,i(r.confirm());else{var y=new Error("Failed to create invoice.");y.data=t.body,n(y)}})})};Z.prototype.confirm=function(r){var f=this,i=r||f.token;return new gt(function(n,F){yt.get(f.baseURL+"/confirm/"+i).set(f.config).end(function(t,y){if(t)return F(t);var p=y.body;if(p.response_code==="00")f.status=p.status,f.responseText=p.response_text,f.status==="completed"&&(f.customer=p.customer,f.receiptURL=p.receipt_url,f.receipt_identifier=p.receipt_identifier,f.provider_reference=p.provider_reference,p.custom_data&&Object.keys(p.custom_data).length>0&&(f.customData=p.custom_data)),f.totalAmount=p.invoice.total_amount,n();else{var _=new Error("Could not confirm invoice status.");_.data=p,F(_)}})})};var mt=Z;const zt=Tt(mt);var bt=pt,jt=ct,wt=lt;tt.prototype=Object.create(bt.prototype);tt.prototype.constructor=tt;function tt(r,f){bt.call(this,r,f),this.baseURL=this.baseURL+"/opr"}tt.prototype.create=function(r){var f=this,i={invoice_data:f.generateRequestBody(),opr_data:{account_alias:String(r)}};return new wt(function(n,F){jt.post(f.baseURL+"/create").set(f.config).send(i).end(function(t,y){if(t)return F(t);if(y.body.response_code==="00")f.token=y.body.invoice_token,f.oprToken=y.body.token,f.responseText=y.body.description,n();else{var p=new Error("Failed to create invoice");p.data=y.body,F(p)}})})};tt.prototype.charge=function(r,f){var i=this,n={token:r+"",confirm_token:f+""};return new wt(function(F,t){jt.post(i.baseURL+"/charge").set(i.config).send(n).end(function(y,p){if(y)return t(y);if(p.body.response_code==="00")i.responseText=p.body.response_text,i.status=p.body.invoice_data.status,i.receiptURL=p.body.invoice_data.receipt_url,i.customer=p.body.invoice_data.customer,F();else{var _=new Error("Failed to charge invoice. Check OPR/confirm token and try again.");_.data=p.body,t(_)}})})};var Qt=tt;const Yt={},Jt=Object.freeze(Object.defineProperty({__proto__:null,default:Yt},Symbol.toStringTag,{value:"Module"})),Gt=St(Jt);var Kt=ct,qt=lt,Wt=Gt;function xt(r){if(!(r&&r.config))throw new Error("Must be initialized with instance of paydunya.Setup");this.config=r.config,this.baseURL=r.baseURL+"/direct-pay"}xt.prototype.creditAccount=function(r,f){var i=this,n={account_alias:r,amount:Number(f)};return new qt(function(F,t){Kt.post(i.baseURL+"/credit-account").set(i.config).send(n).end(function(y,p){if(y)return t(y);if(p.body.response_code==="00")i.responseText=p.body.response_text,i.description=p.body.description,i.transactionID=p.body.transaction_id,F();else{var _=new Error(new Error(Wt.format("Failed to credit account. Please ensure %s and %s are valid OR check your account balance.",r,f)));_.data=p.body,t(_)}})})};var Xt=xt;Y.Setup=Y.setup=Zt;Y.Store=Y.store=te;Y.CheckoutInvoice=Y.checkoutInvoice=mt;Y.OnsiteInvoice=Y.onsiteInvoice=Qt;Y.DirectPay=Y.directPay=Xt;function Zt(r){this.config={},this.config["PAYDUNYA-MASTER-KEY"]=r&&r.masterKey||{}.PAYDUNYA_MASTER_KEY,this.config["PAYDUNYA-PRIVATE-KEY"]=r&&r.privateKey||{}.PAYDUNYA_PRIVATE_KEY,this.config["PAYDUNYA-TOKEN"]=r&&r.token||{}.PAYDUNYA_TOKEN,this.config["Content-Type"]="application/json",r&&r.mode&&r.mode.toLowerCase()==="test"?this.baseURL="https://app.paydunya.com/sandbox-api/v1":this.baseURL="https://app.paydunya.com/api/v1"}function te(r){if(!(r&&r.name))throw new Error("Invalid parameters.");this.name=r.name,r.tagline&&(this.tagline=r.tagline),r.phoneNumber&&(this.phone_number=r.phoneNumber),r.postalAddress&&(this.postal_address=r.postalAddress),r.logoURL&&(this.logo_url=r.logoURL),r.websiteURL&&(this.website_url=r.websiteURL),r.cancelURL&&(this.cancel_url=r.cancelURL),r.returnURL&&(this.return_url=r.returnURL),r.callbackURL&&(this.callback_url=r.callbackURL)}const ee=({handlePay:r,totalAmount:f,onClose:i,order:n,idOrder:F})=>{console.log(n),localStorage.setItem("idOrderPayment",null),localStorage.setItem("montant",null),localStorage.setItem("tokenOrderPayment",null),localStorage.setItem("statusOrderPayment",null);const t=At(),{payment:y,setUserPayment:p,setOrder:_,setPaymentDetails:v,setTotalAmount:E}=K.useContext(Et),{user:g}=kt(),[h,d]=K.useState(!1),[s,u]=K.useState(!0),[l,m]=K.useState(null),[c,R]=K.useState(null),[S,j]=K.useState(null);K.useEffect(()=>{p(g),_(n),console.log("order "+F),console.log("motant "+f),console.log("user"),console.log(g);const L=new Y.Setup({masterKey:"voFGVcul-uCsd-1sw5-wfGz-ukqScIQoOyDu",privateKey:"test_private_A4sJMbHe94bU4ueGEDdfkcmVorE",publicKey:"test_public_1sPEH8M2FaqF7B15zi39mxrpSZd",token:"gCUWIfjZUXPzmoxnnIrD",mode:"test"});m(L);const O=new Y.Store({name:"CCBM SHOP",email:"shop@ccbm.sn",tagline:"Votre boutique pour vos matériels électroménéger",phoneNumber:"+221 70 922 17 75",postalAddress:"Avenue Lamine Gueye,x Rue Marchand,Dakar-Senegal",logoURL:"https://www.ccbmshop.sn/logo_192.png",websiteURL:"https://dev.ccbmshop.com/"});R(O)},[]);const w=L=>{if(console.log("arrivé"),d(!0),L.preventDefault(),l&&c&&f>0){const O=new zt(l,c);console.log(O),n.order_lines.forEach(x=>{O.addItem(x.product_name,x.product_uom_qty,x.price_unit,x.price_subtotal)}),console.log(O),O.totalAmount=Math.ceil(f),n.type_sale==="order"?n.payment_mode=="echelonne"?O.description=`Paiement d'avance de ${J(Math.ceil(f))} pour la commande ${n.name}`:n.payment_mode=="online"&&(O.description=`Paiement de ${J(Math.ceil(f))} pour la commande ${n.name}`):n.type_sale==="preorder"?n.amount_residual>0?O.description=`Paiement de ${J(Math.ceil(f))} pour la précommande ${n.name} avec un montant total restant de ${n.amount_total-f}`:O.description=`Paiement de ${J(Math.ceil(f))} pour la précommande ${n.name}`:n.type_sale==="creditorder"&&(n.amount_residual>0?O.description=`Paiement de ${J(Math.ceil(f))} pour le crédit ${n.name} avec un montant total restant de ${n.amount_total-f}`:O.description=`Paiement de ${J(Math.ceil(f))} pour le crédit ${n.name}`),O.callbackURL="https://orbitcity.odoo.com/api/facture/paydunya",n.type_sale==="order"?O.returnURL=`http://localhost:5173/commandes/${F}/détails`:n.type_sale==="creditorder"?O.returnURL=`http://localhost:5173/credit-commandes/${F}/détails`:n.type_sale==="preorder"&&(O.returnURL=`http://localhost:5173/pre-commandes/${F}/détails`),O.returnURL="http://localhost:5173/payment-state",console.log("invoice",O),console.log(n),v(O),E(O.totalAmount),console.log(O),O.create().then(async function(){j(O),console.log(O),Ft(F,f,n.order_lines.map(A=>({name:A.product_name,price:A.price_unit,quantity:A.product_uom_qty})));let x=null;n.type_sale==="order"?n.payment_mode=="echelonne"?x=`${g.id}-${F}-${f}-${n.name}-${n.type_sale}-${new Date().getTime().toString()}`:x=`${g.id}-${F}-${f}-${n.name}-${n.type_sale}`:n.type_sale==="preorder"?!n.first_payment_state&&!n.second_payment_state&&!n.third_payment_state?x=`${g.id}-${F}-${f}-${n.name}-${n.type_sale}-1`:n.first_payment_state&&!n.second_payment_state&&!n.third_payment_state?x=`${g.id}-${F}-${f}-${n.name}-${n.type_sale}-2`:x=`${g.id}-${F}-${f}-${n.name}-${n.type_sale}-3`:n.type_sale==="creditorder"?!n.first_payment_state&&!n.second_payment_state&&!n.third_payment_state&&!n.fourth_payment_state?x=`${g.id}-${F}-${f}-${n.name}-${n.type_sale}-1`:n.first_payment_state&&!n.second_payment_state&&!n.third_payment_state&&!n.fourth_payment_state?x=`${g.id}-${F}-${f}-${n.name}-${n.type_sale}-2`:n.first_payment_state&&n.second_payment_state&&n.third_payment_state&&!n.fourth_payment_state?x=`${g.id}-${F}-${f}-${n.name}-${n.type_sale}-3`:x=`${g.id}-${F}-${f}-${n.name}-${n.type_sale}-4`:x=`${g.id}-${F}-${f}-${n.name}-${n.type_sale}`;const e={transaction_id:x,amount:f,order_id:F,order_type:n.type_sale,order_name:n.name,partner_id:g.id,payment_token:O.token,payment_state:O.status};console.log("data payment",e),console.log(e);try{const A=await Ot.setPaymentDetails(e);A.order_type==="order"?(X.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),t(`/commandes/${F}/détails`)):A.order_type==="preorder"?(console.log("precommande"),X.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),t(`/pre-commandes/${F}/détails`)):A.order_type==="creditorder"?(console.log("commande"),X.success("Merci de passer au paiement sur paydunya",{position:"top-center",autoClose:2e3}),t(`/credit-commandes/${F}/détails`)):A.payment_state==="completed"&&(X.success("Paiement effectif",{position:"top-center",autoClose:2e3}),t(`/commandes/${F}/détails`)),localStorage.setItem("urlOrderPayment",O.url),localStorage.setItem("statusOrderPayment",O.status),localStorage.setItem("tokenOrderPayment",O.token),localStorage.setItem("idDataPayment",A.id),localStorage.setItem("idOrderPayment",F),localStorage.setItem("montant",f),localStorage.setItem("responseTextOrderPayment",O.responseText)}catch(A){console.error("erreur lors de l'enregistrement details payment"),console.error(A),X.error("Payment non effectif "+A.message,{position:"top-center",autoClose:5e3})}}).catch(function(x){console.log(x),X.error("Payment non effectif "+x,{position:"top-center",autoClose:5e3})}).finally(()=>{d(!1)})}},U=L=>{L.preventDefault(),re(S.url),u(!1),n.type_sale==="order"?(t(`/commandes/${F}/détails`),t("/profile#order")):n.type_sale==="preorder"?t("/profile#preorder"):n.type_sale==="creditorder"&&t("/profile#commandes-a-credit")};return $.jsxs(ot,{size:"xl",className:"h-auto",show:s,popup:!0,onClose:i,children:[$.jsx(ot.Header,{}),$.jsx(ot.Body,{children:$.jsx("div",{className:"fixed inset-0 p-4 flex flex-wrap justify-center items-center w-full h-full z-[1000] before:fixed before:inset-0 before:w-full before:h-full before:bg-[rgba(0,0,0,0.5)] overflow-auto font-[sans-serif]",children:$.jsxs("div",{className:"w-full max-w-lg bg-white shadow-lg rounded-lg p-8 relative",children:[$.jsxs("div",{className:"flex items-start border-b border-gray-300 pb-4",children:[$.jsxs("div",{className:"flex-1",children:[$.jsxs("h3",{className:"text-gray-800 text-xl font-bold",children:["Paiement"," ",n.type_sale=="order"?"Commande":n.type_sale=="preorder"?"Pré Commande":"Commande à crédit"," "]}),$.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Résumé détaillé de votre commande."})]}),$.jsx("p",{children:$.jsx(Ct,{onClick:i,className:"cursor-pointer hover:text-red-500 hover:scale-150 duration-300"})})]}),n&&$.jsx($.Fragment,{children:$.jsxs("div",{className:"my-8",children:[$.jsx("table",{className:"w-full",children:$.jsx("thead",{children:$.jsxs("tr",{children:[$.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Nom de la commande :"}),$.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:n.name})]})})}),$.jsxs("table",{className:"w-full",children:[$.jsx("thead",{children:$.jsxs("tr",{children:[$.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Nom produit"}),$.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:"Prix total"})]})}),$.jsx("tbody",{children:n&&n.order_lines.map((L,O)=>$.jsxs("tr",{children:[$.jsxs("td",{className:"text-left text-gray-800 text-sm py-2",children:[L.product_name," (",L.product_uom_qty,")  "]}),$.jsx("td",{className:"text-right text-gray-800 text-sm py-2 font-medium",children:J(L.price_total)})]},O))})]}),$.jsx("table",{className:"w-full",children:$.jsxs("thead",{children:[$.jsxs("tr",{children:[$.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Total Commande (en FCFA) :"}),$.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:J(Math.ceil(n.amount_total))})]}),n.payment_mode=="echelonne"&&$.jsx($.Fragment,{children:$.jsxs("tr",{children:[$.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Total à payer  (en FCFA) :"}),$.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:J(Math.ceil(f))})]})})]})}),$.jsx("br",{}),$.jsxs("div",{className:"flex max-sm:flex-col items-center gap-4 mt-8",children:[l&&c&&!S&&$.jsxs(ft,{onClick:w,disabled:h,pill:!0,className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",children:[" ",h&&$.jsxs($.Fragment,{children:[$.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}),$.jsx("p",{children:"Validation"})]}),!h&&"Valider"]}),l&&c&&S&&$.jsx(ft,{disabled:!S,onClick:L=>U(L),color:"success",pill:!0,className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",children:"Passer au paiement"})]})]})})]})})})]})};function re(r){const f=window.open(r,"_blank","noopener,noreferrer");f&&(f.opener=null)}const ue=ee;export{ue as P};
